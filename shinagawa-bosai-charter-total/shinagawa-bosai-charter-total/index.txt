1:"$Sreact.fragment"
2:I[8708,["315","static/chunks/315-19ca0205aa2fdd55.js","458","static/chunks/458-4db2abcd82f4c9c6.js","124","static/chunks/124-8b6d8ff5759d10e8.js","48","static/chunks/48-3a76f8478d544215.js","177","static/chunks/app/layout-4ee75bbda26c9e8d.js"],"Provider"]
3:I[87555,[],""]
4:I[31295,[],""]
5:I[32176,["315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","335","static/chunks/app/%5Bslug%5D/error-b85ff2b7d7b78a5a.js"],"default"]
6:I[6874,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],""]
7:I[38567,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Button"]
9:I[59665,[],"OutletBoundary"]
c:I[59665,[],"ViewportBoundary"]
e:I[59665,[],"MetadataBoundary"]
10:I[26614,[],""]
:HL["/_next/static/css/a63443551c7d7d9f.css","style"]
0:{"P":null,"b":"jo3gapz5rOWz9xFqccbrq","p":"","c":["","shinagawa-bosai-charter-total",""],"i":false,"f":[[["",{"children":[["slug","shinagawa-bosai-charter-total","d"],{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/a63443551c7d7d9f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"suppressHydrationWarning":true,"lang":"ja","children":[["$","head",null,{"children":[["$","link",null,{"rel":"preconnect","href":"https://fonts.googleapis.com"}],["$","link",null,{"rel":"preconnect","href":"https://fonts.gstatic.com","crossOrigin":"anonymous"}],["$","link",null,{"href":"https://fonts.googleapis.com/css2?family=BIZ+UDPGothic&display=swap","rel":"stylesheet"}],["$","link",null,{"rel":"icon","href":"/meta/icon.png","sizes":"any"}],false]}],["$","body",null,{"children":["$","$L2",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}]]}],{"children":[["slug","shinagawa-bosai-charter-total","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$5","errorStyles":[],"errorScripts":[],"template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","p",null,{"children":"ページが見つかりませんでした"}],["$","$L6",null,{"href":"/","children":["$","$L7",null,{"children":"トップに戻る"}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L8","$undefined",null,["$","$L9",null,{"children":["$La","$Lb",null]}]]}],{},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","8Uh0rv2F366bDprx7lbeY",{"children":[["$","$Lc",null,{"children":"$Ld"}],null]}],["$","$Le",null,{"children":"$Lf"}]]}],false]],"m":"$undefined","G":["$10","$undefined"],"s":false,"S":true}
d:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
a:null
11:I[6091,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Header"]
12:I[81068,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Box"]
13:I[17921,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Heading"]
14:I[90310,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Text"]
15:I[7684,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Icon"]
16:I[4618,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"ClientContainer"]
32:I[17264,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Analysis"]
33:I[91548,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Separator"]
35:I[18607,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Footer"]
17:T194c,import concurrent.futures
import json
import logging
import os
import re

import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai
from services.parse_json_list import parse_extraction_response
from utils import update_progress

COMMA_AND_SPACE_AND_RIGHT_BRACKET = re.compile(r",\s*(\])")


class ExtractionResponse(BaseModel):
    extractedOpinionList: list[str] = Field(..., description="抽出した意見のリスト")


def _validate_property_columns(property_columns: list[str], comments: pd.DataFrame) -> None:
    if not all(property in comments.columns for property in property_columns):
        raise ValueError(f"Properties {property_columns} not found in comments. Columns are {comments.columns}")


def extraction(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/args.csv"
    model = config["extraction"]["model"]
    prompt = config["extraction"]["prompt"]
    workers = config["extraction"]["workers"]
    limit = config["extraction"]["limit"]
    property_columns = config["extraction"]["properties"]

    if "provider" not in config:
        raise RuntimeError("provider is not set")
    provider = config["provider"]

    # カラム名だけを読み込み、必要なカラムが含まれているか確認する
    comments = pd.read_csv(f"inputs/{config['input']}.csv", nrows=0)
    _validate_property_columns(property_columns, comments)
    # エラーが出なかった場合、すべての行を読み込む
    comments = pd.read_csv(
        f"inputs/{config['input']}.csv", usecols=["comment-id", "comment-body"] + config["extraction"]["properties"]
    )
    comment_ids = (comments["comment-id"].values)[:limit]
    comments.set_index("comment-id", inplace=True)
    results = pd.DataFrame()
    update_progress(config, total=len(comment_ids))

    argument_map = {}
    relation_rows = []

    for i in tqdm(range(0, len(comment_ids), workers)):
        batch = comment_ids[i : i + workers]
        batch_inputs = [comments.loc[id]["comment-body"] for id in batch]
        batch_results = extract_batch(
            batch_inputs, prompt, model, workers, provider, config.get("local_llm_address"), config
        )

        for comment_id, extracted_args in zip(batch, batch_results, strict=False):
            for j, arg in enumerate(extracted_args):
                if arg not in argument_map:
                    # argumentテーブルに追加
                    arg_id = f"A{comment_id}_{j}"
                    argument = arg
                    argument_map[arg] = {
                        "arg-id": arg_id,
                        "argument": argument,
                    }
                else:
                    arg_id = argument_map[arg]["arg-id"]

                # relationテーブルにcommentとargの関係を追加
                relation_row = {
                    "arg-id": arg_id,
                    "comment-id": comment_id,
                }
                relation_rows.append(relation_row)

        update_progress(config, incr=len(batch))

    # DataFrame化
    results = pd.DataFrame(argument_map.values())
    relation_df = pd.DataFrame(relation_rows)

    if results.empty:
        raise RuntimeError("result is empty, maybe bad prompt")

    results.to_csv(path, index=False)
    # comment-idとarg-idの関係を保存
    relation_df.to_csv(f"outputs/{dataset}/relations.csv", index=False)


logging.basicConfig(level=logging.DEBUG)


def extract_batch(batch, prompt, model, workers, provider="openai", local_llm_address=None, config=None):
    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:
        futures_with_index = [
            (i, executor.submit(extract_arguments, input, prompt, model, provider, local_llm_address))
            for i, input in enumerate(batch)
        ]

        done, not_done = concurrent.futures.wait([f for _, f in futures_with_index], timeout=30)
        results = [[] for _ in range(len(batch))]
        total_token_input = 0
        total_token_output = 0
        total_token_usage = 0

        for _, future in futures_with_index:
            if future in not_done and not future.cancelled():
                future.cancel()

        for i, future in futures_with_index:
            if future in done:
                try:
                    result = future.result()
                    if isinstance(result, tuple) and len(result) == 4:
                        items, token_input, token_output, token_total = result
                        results[i] = items
                        total_token_input += token_input
                        total_token_output += token_output
                        total_token_usage += token_total
                    else:
                        results[i] = result
                except Exception as e:
                    logging.error(f"Task {future} failed with error: {e}")
                    results[i] = []

        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + total_token_usage
            config["token_usage_input"] = config.get("token_usage_input", 0) + total_token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + total_token_output
            print(
                f"Extraction batch: input={total_token_input}, output={total_token_output}, total={total_token_usage} tokens"
            )

        return results


def extract_arguments(input, prompt, model, provider="openai", local_llm_address=None):
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            is_json=False,
            json_schema=ExtractionResponse,
            provider=provider,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )
        items = parse_extraction_response(response)
        items = list(filter(None, items))  # omit empty strings
        return items, token_input, token_output, token_total
    except json.decoder.JSONDecodeError as e:
        print("JSON error:", e)
        print("Input was:", input)
        print("Response was:", response)
        print("Silently giving up on trying to generate valid list.")
        return []
18:T1149,"""Cluster the arguments using UMAP + HDBSCAN and GPT-4."""

from importlib import import_module

import numpy as np
import pandas as pd
import scipy.cluster.hierarchy as sch
from sklearn.cluster import KMeans


def hierarchical_clustering(config):
    UMAP = import_module("umap").UMAP

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_clusters.csv"
    arguments_df = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings_df = pd.read_pickle(f"outputs/{dataset}/embeddings.pkl")
    embeddings_array = np.asarray(embeddings_df["embedding"].values.tolist())
    cluster_nums = config["hierarchical_clustering"]["cluster_nums"]

    n_samples = embeddings_array.shape[0]
    # デフォルト設定は15
    default_n_neighbors = 15

    # テスト等サンプルが少なすぎる場合、n_neighborsの設定値を下げる
    if n_samples <= default_n_neighbors:
        n_neighbors = max(2, n_samples - 1)  # 最低2以上
    else:
        n_neighbors = default_n_neighbors

    umap_model = UMAP(random_state=42, n_components=2, n_neighbors=n_neighbors)
    # TODO 詳細エラーメッセージを加える
    # 以下のエラーの場合、おそらく元の意見件数が少なすぎることが原因
    # TypeError: Cannot use scipy.linalg.eigh for sparse A with k >= N. Use scipy.linalg.eigh(A.toarray()) or reduce k.
    umap_embeds = umap_model.fit_transform(embeddings_array)

    cluster_results = hierarchical_clustering_embeddings(
        umap_embeds=umap_embeds,
        cluster_nums=cluster_nums,
    )
    result_df = pd.DataFrame(
        {
            "arg-id": arguments_df["arg-id"],
            "argument": arguments_df["argument"],
            "x": umap_embeds[:, 0],
            "y": umap_embeds[:, 1],
        }
    )

    for cluster_level, final_labels in enumerate(cluster_results.values(), start=1):
        result_df[f"cluster-level-{cluster_level}-id"] = [f"{cluster_level}_{label}" for label in final_labels]

    result_df.to_csv(path, index=False)


def generate_cluster_count_list(min_clusters: int, max_clusters: int):
    cluster_counts = []
    current = min_clusters
    cluster_counts.append(current)

    if min_clusters == max_clusters:
        return cluster_counts

    while True:
        next_double = current * 2
        next_triple = current * 3

        if next_double >= max_clusters:
            if cluster_counts[-1] != max_clusters:
                cluster_counts.append(max_clusters)
            break

        # 次の倍はまだ max_clusters に収まるが、3倍だと超える
        # -> (次の倍は細かすぎるので)スキップして max_clusters に飛ぶ
        if next_triple > max_clusters:
            cluster_counts.append(max_clusters)
            break

        cluster_counts.append(next_double)
        current = next_double

    return cluster_counts


def merge_clusters_with_hierarchy(
    cluster_centers: np.ndarray,
    kmeans_labels: np.ndarray,
    umap_array: np.ndarray,
    n_cluster_cut: int,
):
    Z = sch.linkage(cluster_centers, method="ward")
    cluster_labels_merged = sch.fcluster(Z, t=n_cluster_cut, criterion="maxclust")

    n_samples = umap_array.shape[0]
    final_labels = np.zeros(n_samples, dtype=int)

    for i in range(n_samples):
        original_label = kmeans_labels[i]
        final_labels[i] = cluster_labels_merged[original_label]

    return final_labels


def hierarchical_clustering_embeddings(
    umap_embeds,
    cluster_nums,
):
    # 最大分割数でクラスタリングを実施
    print("start initial clustering")
    initial_cluster_num = cluster_nums[-1]
    kmeans_model = KMeans(n_clusters=initial_cluster_num, random_state=42)
    kmeans_model.fit(umap_embeds)
    print("end initial clustering")

    results = {}
    print("start hierarchical clustering")
    cluster_nums.sort()
    print(cluster_nums)
    for n_cluster_cut in cluster_nums[:-1]:
        print("n_cluster_cut: ", n_cluster_cut)
        final_labels = merge_clusters_with_hierarchy(
            cluster_centers=kmeans_model.cluster_centers_,
            kmeans_labels=kmeans_model.labels_,
            umap_array=umap_embeds,
            n_cluster_cut=n_cluster_cut,
        )
        results[n_cluster_cut] = final_labels

    results[initial_cluster_num] = kmeans_model.labels_
    print("end hierarchical clustering")

    return results
19:T1c36,import json
import os
from concurrent.futures import ThreadPoolExecutor
from functools import partial
from typing import TypedDict

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class LabellingResult(TypedDict):
    """各クラスタのラベリング結果を表す型"""

    cluster_id: str  # クラスタのID
    label: str  # クラスタのラベル名
    description: str  # クラスタの説明文


def hierarchical_initial_labelling(config: dict) -> None:
    """階層的クラスタリングの初期ラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_initial_labelling: 初期ラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_initial_labels.csv"
    clusters_argument_df = pd.read_csv(f"outputs/{dataset}/hierarchical_clusters.csv")

    cluster_id_columns = [col for col in clusters_argument_df.columns if col.startswith("cluster-level-")]
    initial_cluster_id_column = cluster_id_columns[-1]
    sampling_num = config["hierarchical_initial_labelling"]["sampling_num"]
    initial_labelling_prompt = config["hierarchical_initial_labelling"]["prompt"]
    model = config["hierarchical_initial_labelling"]["model"]
    workers = config["hierarchical_initial_labelling"]["workers"]

    # トークン使用量を追跡するための変数を初期化
    config["total_token_usage"] = config.get("total_token_usage", 0)

    initial_label_df = initial_labelling(
        initial_labelling_prompt,
        clusters_argument_df,
        sampling_num,
        model,
        workers,
        config["provider"],
        config.get("local_llm_address"),
        config,  # configを渡して、トークン使用量を累積できるようにする
    )
    print("start initial labelling")
    initial_clusters_argument_df = clusters_argument_df.merge(
        initial_label_df,
        left_on=initial_cluster_id_column,
        right_on="cluster_id",
        how="left",
    ).rename(
        columns={
            "label": f"{initial_cluster_id_column.replace('-id', '')}-label",
            "description": f"{initial_cluster_id_column.replace('-id', '')}-description",
        }
    )
    print("end initial labelling")
    initial_clusters_argument_df.to_csv(path, index=False)


def initial_labelling(
    prompt: str,
    clusters_df: pd.DataFrame,
    sampling_num: int,
    model: str,
    workers: int,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> pd.DataFrame:
    """各クラスタに対して初期ラベリングを実行する

    Args:
        prompt: LLMへのプロンプト
        clusters_df: クラスタリング結果のDataFrame
        sampling_num: 各クラスタからサンプリングする意見の数
        model: 使用するLLMモデル名
        workers: 並列処理のワーカー数
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        各クラスタのラベリング結果を含むDataFrame
    """
    cluster_columns = [col for col in clusters_df.columns if col.startswith("cluster-level-")]
    initial_cluster_column = cluster_columns[-1]
    cluster_ids = clusters_df[initial_cluster_column].unique()
    process_func = partial(
        process_initial_labelling,
        df=clusters_df,
        prompt=prompt,
        sampling_num=sampling_num,
        target_column=initial_cluster_column,
        model=model,
        provider=provider,
        local_llm_address=local_llm_address,
        config=config,  # configを渡す
    )
    with ThreadPoolExecutor(max_workers=workers) as executor:
        results = list(executor.map(process_func, cluster_ids))
    return pd.DataFrame(results)


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_initial_labelling(
    cluster_id: str,
    df: pd.DataFrame,
    prompt: str,
    sampling_num: int,
    target_column: str,
    model: str,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> LabellingResult:
    """個別のクラスタに対してラベリングを実行する

    Args:
        cluster_id: 処理対象のクラスタID
        df: クラスタリング結果のDataFrame
        prompt: LLMへのプロンプト
        sampling_num: サンプリングする意見の数
        target_column: クラスタIDが格納されている列名
        model: 使用するLLMモデル名
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        クラスタのラベリング結果
    """
    cluster_data = df[df[target_column] == cluster_id]
    sampling_num = min(sampling_num, len(cluster_data))
    cluster = cluster_data.sample(sampling_num)
    input = "\n".join(cluster["argument"].values)
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            provider=provider,
            json_schema=LabellingFromat,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )

        # トークン使用量を累積（configが渡されている場合）
        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
            config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + token_output

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return LabellingResult(
            cluster_id=cluster_id,
            label=response_json.get("label", "エラーでラベル名が取得できませんでした"),
            description=response_json.get("description", "エラーで解説が取得できませんでした"),
        )
    except Exception as e:
        print(e)
        return LabellingResult(
            cluster_id=cluster_id,
            label="エラーでラベル名が取得できませんでした",
            description="エラーで解説が取得できませんでした",
        )
1a:T337b,import json
import os
from concurrent.futures import ThreadPoolExecutor
from dataclasses import dataclass
from functools import partial

import numpy as np
import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai


@dataclass
class ClusterColumns:
    """同一階層のクラスター関連のカラム名を管理するクラス"""

    id: str
    label: str
    description: str

    @classmethod
    def from_id_column(cls, id_column: str) -> "ClusterColumns":
        """ID列名から関連するカラム名を生成"""
        return cls(
            id=id_column,
            label=id_column.replace("-id", "-label"),
            description=id_column.replace("-id", "-description"),
        )


@dataclass
class ClusterValues:
    """対象クラスタのlabel/descriptionを管理するクラス"""

    label: str
    description: str

    def to_prompt_text(self) -> str:
        return f"- {self.label}: {self.description}"


def hierarchical_merge_labelling(config: dict) -> None:
    """階層的クラスタリングの結果に対してマージラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_merge_labelling: マージラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    merge_path = f"outputs/{dataset}/hierarchical_merge_labels.csv"
    clusters_df = pd.read_csv(f"outputs/{dataset}/hierarchical_initial_labels.csv")

    cluster_id_columns: list[str] = _filter_id_columns(clusters_df.columns)
    # ボトムクラスタのラベル・説明とクラスタid付きの各argumentを入力し、各階層のクラスタラベル・説明を生成し、argumentに付けたdfを作成
    merge_result_df = merge_labelling(
        clusters_df=clusters_df,
        cluster_id_columns=sorted(cluster_id_columns, reverse=True),
        config=config,
    )
    # 上記のdfから各クラスタのlevel, id, label, description, valueを取得してdfを作成
    melted_df = melt_cluster_data(merge_result_df)
    # 上記のdfに親子関係を追加
    parent_child_df = _build_parent_child_mapping(merge_result_df, cluster_id_columns)
    melted_df = melted_df.merge(parent_child_df, on=["level", "id"], how="left")
    density_df = calculate_cluster_density(melted_df, config)
    density_df.to_csv(merge_path, index=False)


def _build_parent_child_mapping(df: pd.DataFrame, cluster_id_columns: list[str]):
    """クラスタ間の親子関係をマッピングする

    Args:
        df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト

    Returns:
        親子関係のマッピング情報を含むDataFrame
    """
    results = []
    top_cluster_column = cluster_id_columns[0]
    top_cluster_values = df[top_cluster_column].unique()
    for c in top_cluster_values:
        results.append(
            {
                "level": 1,
                "id": c,
                "parent": "0",  # aggregationで追加する全体クラスタのid
            }
        )

    for idx in range(len(cluster_id_columns) - 1):
        current_column = cluster_id_columns[idx]
        children_column = cluster_id_columns[idx + 1]
        current_level = current_column.replace("-id", "").replace("cluster-level-", "")
        # 現在のレベルのクラスタid
        current_cluster_values = df[current_column].unique()
        for current_id in current_cluster_values:
            children_ids = df.loc[df[current_column] == current_id, children_column].unique()
            for child_id in children_ids:
                results.append(
                    {
                        "level": int(current_level) + 1,
                        "id": child_id,
                        "parent": current_id,
                    }
                )
    return pd.DataFrame(results)


def _filter_id_columns(columns: list[str]) -> list[str]:
    """クラスタIDのカラム名をフィルタリングする

    Args:
        columns: 全カラム名のリスト

    Returns:
        クラスタIDのカラム名のリスト
    """
    return [col for col in columns if col.startswith("cluster-level-") and col.endswith("-id")]


def melt_cluster_data(df: pd.DataFrame) -> pd.DataFrame:
    """クラスタデータを行形式に変換する

    cluster-level-n-(id|label|description) を行形式 (level, id, label, description, value) にまとめる。
    [cluster-level-n-id, cluster-level-n-label, cluster-level-n-description] を [level, id, label, description, value(件数)] に変換する。

    Args:
        df: クラスタリング結果のDataFrame

    Returns:
        行形式に変換されたDataFrame
    """
    id_columns: list[str] = _filter_id_columns(df.columns)
    levels: set[int] = {int(col.replace("cluster-level-", "").replace("-id", "")) for col in id_columns}
    all_rows: list[dict] = []

    # levelごとに各クラスタの出現件数を集計・縦持ちにする
    for level in levels:
        cluster_columns = ClusterColumns.from_id_column(f"cluster-level-{level}-id")
        # クラスタidごとの件数集計
        level_count_df = df.groupby(cluster_columns.id).size().reset_index(name="value")

        level_unique_val_df = df[
            [cluster_columns.id, cluster_columns.label, cluster_columns.description]
        ].drop_duplicates()
        level_unique_val_df = level_unique_val_df.merge(level_count_df, on=cluster_columns.id, how="left")
        level_unique_vals = [
            {
                "level": level,
                "id": row[cluster_columns.id],
                "label": row[cluster_columns.label],
                "description": row[cluster_columns.description],
                "value": row["value"],
            }
            for _, row in level_unique_val_df.iterrows()
        ]
        all_rows.extend(level_unique_vals)
    return pd.DataFrame(all_rows)


def merge_labelling(clusters_df: pd.DataFrame, cluster_id_columns: list[str], config) -> pd.DataFrame:
    """階層的なクラスタのマージラベリングを実行する

    Args:
        clusters_df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含むDataFrame
    """
    for idx in tqdm(range(len(cluster_id_columns) - 1)):
        previous_columns = ClusterColumns.from_id_column(cluster_id_columns[idx])
        current_columns = ClusterColumns.from_id_column(cluster_id_columns[idx + 1])

        process_fn = partial(
            process_merge_labelling,
            result_df=clusters_df,
            current_columns=current_columns,
            previous_columns=previous_columns,
            config=config,
        )

        current_cluster_ids = sorted(clusters_df[current_columns.id].unique())
        with ThreadPoolExecutor(max_workers=config["hierarchical_merge_labelling"]["workers"]) as executor:
            responses = list(
                tqdm(
                    executor.map(process_fn, current_cluster_ids),
                    total=len(current_cluster_ids),
                )
            )

        current_result_df = pd.DataFrame(responses)
        clusters_df = clusters_df.merge(current_result_df, on=[current_columns.id])
    return clusters_df


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_merge_labelling(
    target_cluster_id: str,
    result_df: pd.DataFrame,
    current_columns: ClusterColumns,
    previous_columns: ClusterColumns,
    config,
):
    """個別のクラスタに対してマージラベリングを実行する

    Args:
        target_cluster_id: 処理対象のクラスタID
        result_df: クラスタリング結果のDataFrame
        current_columns: 現在のレベルのカラム情報
        previous_columns: 前のレベルのカラム情報
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含む辞書
    """

    def filter_previous_values(df: pd.DataFrame, previous_columns: ClusterColumns) -> list[ClusterValues]:
        """前のレベルのクラスタ情報を取得する"""
        previous_records = df[df[current_columns.id] == target_cluster_id][
            [previous_columns.label, previous_columns.description]
        ].drop_duplicates()
        previous_values = [
            ClusterValues(
                label=row[previous_columns.label],
                description=row[previous_columns.description],
            )
            for _, row in previous_records.iterrows()
        ]
        return previous_values

    previous_values = filter_previous_values(result_df, previous_columns)
    if len(previous_values) == 1:
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: previous_values[0].label,
            current_columns.description: previous_values[0].description,
        }
    elif len(previous_values) == 0:
        raise ValueError(f"クラスタ {target_cluster_id} には前のレベルのクラスタが存在しません。")

    current_cluster_data = result_df[result_df[current_columns.id] == target_cluster_id]
    sampling_num = min(
        config["hierarchical_merge_labelling"]["sampling_num"],
        len(current_cluster_data),
    )
    sampled_data = current_cluster_data.sample(sampling_num)
    sampled_argument_text = "\n".join(sampled_data["argument"].values)
    cluster_text = "\n".join([value.to_prompt_text() for value in previous_values])
    messages = [
        {"role": "system", "content": config["hierarchical_merge_labelling"]["prompt"]},
        {
            "role": "user",
            "content": "クラスタラベル\n" + cluster_text + "\n" + "クラスタの意見\n" + sampled_argument_text,
        },
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=config["hierarchical_merge_labelling"]["model"],
            json_schema=LabellingFromat,
            provider=config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )

        config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
        config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
        config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
        print(f"Merge labelling: input={token_input}, output={token_output}, total={token_total} tokens")

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: response_json.get("label", "エラーでラベル名が取得できませんでした"),
            current_columns.description: response_json.get("description", "エラーで解説が取得できませんでした"),
        }
    except Exception as e:
        print(f"エラーが発生しました: {e}")
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: "エラーでラベル名が取得できませんでした",
            current_columns.description: "エラーで解説が取得できませんでした",
        }


def calculate_cluster_density(melted_df: pd.DataFrame, config: dict):
    """クラスタ内の密度計算"""
    hierarchical_cluster_df = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_clusters.csv")

    densities = []
    for level, c_id in zip(melted_df["level"], melted_df["id"], strict=False):
        cluster_embeds = hierarchical_cluster_df[hierarchical_cluster_df[f"cluster-level-{level}-id"] == c_id][
            ["x", "y"]
        ].values
        density = calculate_density(cluster_embeds)
        densities.append(density)

    # 密度のランクを計算
    melted_df["density"] = densities
    melted_df["density_rank"] = melted_df.groupby("level")["density"].rank(ascending=False, method="first")
    melted_df["density_rank_percentile"] = melted_df.groupby("level")["density_rank"].transform(lambda x: x / len(x))
    return melted_df


def calculate_density(embeds: np.ndarray):
    """平均距離に基づいて密度を計算"""
    center = np.mean(embeds, axis=0)
    distances = np.linalg.norm(embeds - center, axis=1)
    avg_distance = np.mean(distances)
    density = 1 / (avg_distance + 1e-10)
    return density
1b:Ta82,"""Create summaries for the clusters."""

import json
import os
import re

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class OverviewResponse(BaseModel):
    summary: str = Field(..., description="クラスターの全体的な要約")


def hierarchical_overview(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_overview.txt"

    hierarchical_label_df = pd.read_csv(f"outputs/{dataset}/hierarchical_merge_labels.csv")

    prompt = config["hierarchical_overview"]["prompt"]
    model = config["hierarchical_overview"]["model"]

    # TODO: level1で固定にしているが、設定で変えられるようにする
    target_level = 1
    target_records = hierarchical_label_df[hierarchical_label_df["level"] == target_level]
    ids = target_records["id"].to_list()
    labels = target_records["label"].to_list()
    descriptions = target_records["description"].to_list()
    target_records.set_index("id", inplace=True)

    input_text = ""
    for i, _ in enumerate(ids):
        input_text += f"# Cluster {i}/{len(ids)}: {labels[i]}\n\n"
        input_text += descriptions[i] + "\n\n"

    messages = [{"role": "system", "content": prompt}, {"role": "user", "content": input_text}]
    response_text, token_input, token_output, token_total = request_to_chat_ai(
        messages=messages,
        model=model,
        provider=config["provider"],
        local_llm_address=config.get("local_llm_address"),
        user_api_key=os.getenv("USER_API_KEY"),
        json_schema=OverviewResponse,
    )

    # トークン使用量を累積
    config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
    config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
    config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
    print(f"Hierarchical overview: input={token_input}, output={token_output}, total={token_total} tokens")

    try:
        # structured outputとしてパースできるなら処理する
        if isinstance(response_text, dict):
            parsed_response = response_text
        else:
            parsed_response = json.loads(response_text)

        with open(path, "w") as file:
            file.write(parsed_response["summary"])

    except Exception:
        # thinkタグが出力されるReasoningモデル用に、thinkタグを除去する
        thinking_removed = re.sub(
            r"<think\b[^>]*>.*?</think>",
            "",
            response_text,
            flags=re.DOTALL,
        )

        with open(path, "w") as file:
            file.write(thinking_removed)
1c:T3f38,"""Generate a convenient JSON output file."""

import json
from collections import defaultdict
from pathlib import Path
from typing import Any, TypedDict

import numpy as np
import pandas as pd

ROOT_DIR = Path(__file__).parent.parent.parent.parent
CONFIG_DIR = ROOT_DIR / "scatter" / "pipeline" / "configs"
PIPELINE_DIR = ROOT_DIR / "broadlistening" / "pipeline"


def json_serialize_numpy(obj: Any) -> Any:
    """
    Recursively convert NumPy data types to native Python types for JSON serialization.

    Args:
        obj: Any Python object which might contain NumPy data types

    Returns:
        The same object structure with NumPy types converted to Python native types
    """
    if isinstance(obj, np.integer):
        return int(obj)
    elif isinstance(obj, np.floating):
        return float(obj)
    elif isinstance(obj, np.ndarray):
        return obj.tolist()
    elif isinstance(obj, dict):
        return {k: json_serialize_numpy(v) for k, v in obj.items()}
    elif isinstance(obj, list):
        return [json_serialize_numpy(item) for item in obj]
    elif isinstance(obj, tuple):
        return tuple(json_serialize_numpy(item) for item in obj)
    else:
        return obj


class Argument(TypedDict):
    arg_id: str
    argument: str
    comment_id: str
    x: float
    y: float
    p: float
    cluster_ids: list[str]
    attributes: dict[str, str] | None
    url: str | None


class Cluster(TypedDict):
    level: int
    id: str
    label: str
    takeaway: str
    value: int
    parent: str
    density_rank_percentile: float | None


def hierarchical_aggregation(config) -> bool:
    try:
        path = f"outputs/{config['output_dir']}/hierarchical_result.json"
        results = {
            "arguments": [],
            "clusters": [],
            "comments": {},
            "propertyMap": {},
            "translations": {},
            "overview": "",
            "config": config,
        }

        arguments = pd.read_csv(f"outputs/{config['output_dir']}/args.csv")
        arguments.set_index("arg-id", inplace=True)
        arg_num = len(arguments)
        relation_df = pd.read_csv(f"outputs/{config['output_dir']}/relations.csv")
        comments = pd.read_csv(f"inputs/{config['input']}.csv")
        clusters = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_clusters.csv")
        labels = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_merge_labels.csv")

        hidden_properties_map: dict[str, list[str]] = config["hierarchical_aggregation"]["hidden_properties"]

        results["arguments"] = _build_arguments(clusters, comments, relation_df, config)
        results["clusters"] = _build_cluster_value(labels, arg_num)

        # results["comments"] = _build_comments_value(
        #     comments, arguments, hidden_properties_map
        # )
        results["comment_num"] = len(comments)
        results["translations"] = _build_translations(config)
        # 属性情報のカラムは、元データに対して指定したカラムとclassificationするカテゴリを合わせたもの
        results["propertyMap"] = _build_property_map(arguments, comments, hidden_properties_map, config)

        with open(f"outputs/{config['output_dir']}/hierarchical_overview.txt") as f:
            overview = f.read()
        print("overview")
        print(overview)
        results["overview"] = overview

        # Convert non-serializable NumPy types to native Python types
        results = json_serialize_numpy(results)

        with open(path, "w") as file:
            json.dump(results, file, indent=2, ensure_ascii=False)
        # TODO: サンプリングロジックを実装したいが、現状は全件抽出
        create_custom_intro(config)
        if config["is_pubcom"]:
            add_original_comments(labels, arguments, relation_df, clusters, config)
        return True
    except Exception as e:
        print("error")
        print(e)
        return False


def create_custom_intro(config):
    dataset = config["output_dir"]
    args_path = PIPELINE_DIR / f"outputs/{dataset}/args.csv"
    comments = pd.read_csv(PIPELINE_DIR / f"inputs/{config['input']}.csv")
    result_path = PIPELINE_DIR / f"outputs/{dataset}/hierarchical_result.json"

    input_count = len(comments)
    args_count = len(pd.read_csv(args_path))
    processed_num = min(input_count, config["extraction"]["limit"])

    print(f"Input count: {input_count}")
    print(f"Args count: {args_count}")

    # LLMプロバイダーとモデル名の判定
    def get_llm_provider_display():
        # configからプロバイダー情報を取得（優先）
        provider = config.get("provider", "openai")
        model = config.get("model", "unknown")

        # プロバイダー名をマッピング
        provider_names = {
            "openai": "OpenAI API",
            "azure": "Azure OpenAI API",
            "openrouter": "OpenRouter API",
            "local": "Local LLM",
        }

        provider_name = provider_names.get(provider, f"{provider} API")
        return f"{provider_name} ({model})"

    llm_provider = get_llm_provider_display()

    base_custom_intro = """{intro}
分析対象となったデータの件数は{processed_num}件で、これらのデータに対して{llm_provider}を用いて{args_count}件の意見（議論）を抽出し、クラスタリングを行った。
"""

    intro = config["intro"]
    custom_intro = base_custom_intro.format(
        intro=intro, processed_num=processed_num, args_count=args_count, llm_provider=llm_provider
    )

    with open(result_path) as f:
        result = json.load(f)
    result["config"]["intro"] = custom_intro
    with open(result_path, "w") as f:
        json.dump(result, f, indent=2, ensure_ascii=False)


def add_original_comments(labels, arguments, relation_df, clusters, config):
    # 大カテゴリ（cluster-level-1）に該当するラベルだけ抽出
    labels_lv1 = labels[labels["level"] == 1][["id", "label"]].rename(
        columns={"id": "cluster-level-1-id", "label": "category_label"}
    )

    # arguments と clusters をマージ（カテゴリ情報付与）
    merged = arguments.merge(clusters[["arg-id", "cluster-level-1-id"]], on="arg-id").merge(
        labels_lv1, on="cluster-level-1-id", how="left"
    )

    # relation_df と結合
    merged = merged.merge(relation_df, on="arg-id", how="left")

    # 元コメント取得
    comments = pd.read_csv(PIPELINE_DIR / f"inputs/{config['input']}.csv")
    comments["comment-id"] = comments["comment-id"].astype(str)
    merged["comment-id"] = merged["comment-id"].astype(str)

    # 元コメント本文などとマージ
    final_df = merged.merge(comments, on="comment-id", how="left")

    # 必要カラムのみ整形
    final_cols = ["comment-id", "comment-body", "arg-id", "argument", "cluster-level-1-id", "category_label"]

    # 基本カラム
    for col in ["x", "y", "source", "url"]:
        if col in comments.columns:
            final_cols.append(col)

    # 属性カラムを追加
    attribute_columns = []
    for col in comments.columns:
        # attributeプレフィックスが付いたカラムを探す
        if col.startswith("attribute_"):
            attribute_columns.append(col)
            final_cols.append(col)

    print(f"属性カラム検出: {attribute_columns}")

    # 必要なカラムだけ選択
    final_df = final_df[final_cols]
    final_df = final_df.rename(
        columns={
            "cluster-level-1-id": "category_id",
            "category_label": "category",
            "arg-id": "arg_id",
            "argument": "argument",
            "comment-body": "original-comment",
        }
    )

    # 保存
    final_df.to_csv(PIPELINE_DIR / f"outputs/{config['output_dir']}/final_result_with_comments.csv", index=False)


def _build_arguments(
    clusters: pd.DataFrame, comments: pd.DataFrame, relation_df: pd.DataFrame, config: dict
) -> list[Argument]:
    """
    Build the arguments list including attribute information from original comments

    Args:
        clusters: DataFrame containing cluster information for each argument
        comments: DataFrame containing original comments with attribute columns
        relation_df: DataFrame relating arguments to original comments
        config: Configuration dictionary containing enable_source_link setting
    """
    cluster_columns = [col for col in clusters.columns if col.startswith("cluster-level-") and "id" in col]

    # Prepare for merging with original comments to get attributes
    comments_copy = comments.copy()
    comments_copy["comment-id"] = comments_copy["comment-id"].astype(str)

    # Get argument to comment mapping
    arg_comment_map = {}
    if "comment-id" in relation_df.columns:
        relation_df["comment-id"] = relation_df["comment-id"].astype(str)
        arg_comment_map = dict(zip(relation_df["arg-id"], relation_df["comment-id"], strict=False))

    # Find attribute columns in comments dataframe
    attribute_columns = [col for col in comments.columns if col.startswith("attribute_")]
    print(f"属性カラム検出: {attribute_columns}")

    arguments: list[Argument] = []
    for _, row in clusters.iterrows():
        cluster_ids = ["0"]
        for cluster_column in cluster_columns:
            cluster_ids.append(str(row[cluster_column]))  # Convert to string to ensure serializable

        # Create base argument
        argument: Argument = {
            "arg_id": str(row["arg-id"]),  # Convert to string to ensure serializable
            "argument": str(row["argument"]),
            "x": float(row["x"]),  # Convert to native float
            "y": float(row["y"]),  # Convert to native float
            "p": 0,  # NOTE: 一旦全部0でいれる
            "cluster_ids": cluster_ids,
            "attributes": None,
            "url": None,
        }

        # Add attributes and URL if available
        if row["arg-id"] in arg_comment_map:
            comment_id = arg_comment_map[row["arg-id"]]
            comment_rows = comments_copy[comments_copy["comment-id"] == comment_id]

            if not comment_rows.empty:
                comment_row = comment_rows.iloc[0]

                # Add URL if available and enabled
                if config.get("enable_source_link", False) and "url" in comment_row and comment_row["url"] is not None:
                    argument["url"] = str(comment_row["url"])

                # Add attributes if available
                if attribute_columns:
                    attributes = {}
                    for attr_col in attribute_columns:
                        # Remove "attribute_" prefix for cleaner attribute names
                        attr_name = attr_col[len("attribute_") :]
                        # Convert potential numpy types to Python native types
                        attr_value = comment_row.get(attr_col, None)
                        if attr_value is not None:
                            if isinstance(attr_value, np.integer):
                                attr_value = int(attr_value)
                            elif isinstance(attr_value, np.floating):
                                attr_value = float(attr_value)
                            elif isinstance(attr_value, np.ndarray):
                                attr_value = attr_value.tolist()
                        attributes[attr_name] = attr_value

                    # Only add non-empty attributes
                    if any(v is not None for v in attributes.values()):
                        argument["attributes"] = attributes

        arguments.append(argument)
    return arguments


def _build_cluster_value(melted_labels: pd.DataFrame, total_num: int) -> list[Cluster]:
    results: list[Cluster] = [
        Cluster(
            level=0,
            id="0",
            label="全体",
            takeaway="",
            value=int(total_num),  # Convert to native int
            parent="",
            density_rank_percentile=0,
        )
    ]

    for _, melted_label in melted_labels.iterrows():
        # Convert potential NumPy types to native Python types
        level = (
            int(melted_label["level"]) if isinstance(melted_label["level"], int | np.integer) else melted_label["level"]
        )
        cluster_id = str(melted_label["id"])
        label = str(melted_label["label"])
        takeaway = str(melted_label["description"])
        value = (
            int(melted_label["value"]) if isinstance(melted_label["value"], int | np.integer) else melted_label["value"]
        )
        parent = str(melted_label.get("parent", "全体"))

        # Handle density_rank_percentile which might be None or a numeric value
        density_rank = melted_label.get("density_rank_percentile")
        if density_rank is not None:
            if isinstance(density_rank, float | np.floating):
                density_rank = float(density_rank)
            elif isinstance(density_rank, int | np.integer):
                density_rank = int(density_rank)

        cluster_value = Cluster(
            level=level,
            id=cluster_id,
            label=label,
            takeaway=takeaway,
            value=value,
            parent=parent,
            density_rank_percentile=density_rank,
        )
        results.append(cluster_value)
    return results


def _build_comments_value(
    comments: pd.DataFrame,
    arguments: pd.DataFrame,
    hidden_properties_map: dict[str, list[str]],
):
    comment_dict: dict[str, dict[str, str]] = {}
    useful_comment_ids = set(arguments["comment-id"].values)
    for _, row in comments.iterrows():
        id = row["comment-id"]
        if id in useful_comment_ids:
            res = {"comment": row["comment-body"]}
            should_skip = any(row[prop] in hidden_values for prop, hidden_values in hidden_properties_map.items())
            if should_skip:
                continue
            comment_dict[str(id)] = res

    return comment_dict


def _build_translations(config):
    languages = list(config.get("translation", {}).get("languages", []))
    if len(languages) > 0:
        with open(PIPELINE_DIR / f"outputs/{config['output_dir']}/translations.json") as f:
            translations = f.read()
        return json.loads(translations)
    return {}


def _build_property_map(
    arguments: pd.DataFrame, comments: pd.DataFrame, hidden_properties_map: dict[str, list[str]], config: dict
) -> dict[str, dict[str, str]]:
    property_columns = list(hidden_properties_map.keys()) + list(config["extraction"]["categories"].keys())
    property_map = defaultdict(dict)

    # 指定された property_columns が arguments に存在するかチェック
    missing_cols = [col for col in property_columns if col not in arguments.columns]
    if missing_cols:
        raise ValueError(
            f"指定されたカラム {missing_cols} が args.csv に存在しません。"
            "設定ファイルaggregation / hidden_propertiesから該当カラムを取り除いてください。"
        )

    for prop in property_columns:
        for arg_id, row in arguments.iterrows():
            # LLMによるcategory classificationがうまく行かず、NaNの場合はNoneにする
            value = row[prop] if not pd.isna(row[prop]) else None

            # Convert NumPy types to Python native types
            if value is not None:
                if isinstance(value, np.integer):
                    value = int(value)
                elif isinstance(value, np.floating):
                    value = float(value)
                elif isinstance(value, np.ndarray):
                    value = value.tolist()
                else:
                    # Convert any other types to string to ensure serialization
                    try:
                        value = str(value)
                    except Exception as e:
                        print(f"Error converting value to string: {e}")
                        value = None

            # Make sure arg_id is string
            str_arg_id = str(arg_id)
            property_map[prop][str_arg_id] = value

    return property_map
1d:T194c,import concurrent.futures
import json
import logging
import os
import re

import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai
from services.parse_json_list import parse_extraction_response
from utils import update_progress

COMMA_AND_SPACE_AND_RIGHT_BRACKET = re.compile(r",\s*(\])")


class ExtractionResponse(BaseModel):
    extractedOpinionList: list[str] = Field(..., description="抽出した意見のリスト")


def _validate_property_columns(property_columns: list[str], comments: pd.DataFrame) -> None:
    if not all(property in comments.columns for property in property_columns):
        raise ValueError(f"Properties {property_columns} not found in comments. Columns are {comments.columns}")


def extraction(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/args.csv"
    model = config["extraction"]["model"]
    prompt = config["extraction"]["prompt"]
    workers = config["extraction"]["workers"]
    limit = config["extraction"]["limit"]
    property_columns = config["extraction"]["properties"]

    if "provider" not in config:
        raise RuntimeError("provider is not set")
    provider = config["provider"]

    # カラム名だけを読み込み、必要なカラムが含まれているか確認する
    comments = pd.read_csv(f"inputs/{config['input']}.csv", nrows=0)
    _validate_property_columns(property_columns, comments)
    # エラーが出なかった場合、すべての行を読み込む
    comments = pd.read_csv(
        f"inputs/{config['input']}.csv", usecols=["comment-id", "comment-body"] + config["extraction"]["properties"]
    )
    comment_ids = (comments["comment-id"].values)[:limit]
    comments.set_index("comment-id", inplace=True)
    results = pd.DataFrame()
    update_progress(config, total=len(comment_ids))

    argument_map = {}
    relation_rows = []

    for i in tqdm(range(0, len(comment_ids), workers)):
        batch = comment_ids[i : i + workers]
        batch_inputs = [comments.loc[id]["comment-body"] for id in batch]
        batch_results = extract_batch(
            batch_inputs, prompt, model, workers, provider, config.get("local_llm_address"), config
        )

        for comment_id, extracted_args in zip(batch, batch_results, strict=False):
            for j, arg in enumerate(extracted_args):
                if arg not in argument_map:
                    # argumentテーブルに追加
                    arg_id = f"A{comment_id}_{j}"
                    argument = arg
                    argument_map[arg] = {
                        "arg-id": arg_id,
                        "argument": argument,
                    }
                else:
                    arg_id = argument_map[arg]["arg-id"]

                # relationテーブルにcommentとargの関係を追加
                relation_row = {
                    "arg-id": arg_id,
                    "comment-id": comment_id,
                }
                relation_rows.append(relation_row)

        update_progress(config, incr=len(batch))

    # DataFrame化
    results = pd.DataFrame(argument_map.values())
    relation_df = pd.DataFrame(relation_rows)

    if results.empty:
        raise RuntimeError("result is empty, maybe bad prompt")

    results.to_csv(path, index=False)
    # comment-idとarg-idの関係を保存
    relation_df.to_csv(f"outputs/{dataset}/relations.csv", index=False)


logging.basicConfig(level=logging.DEBUG)


def extract_batch(batch, prompt, model, workers, provider="openai", local_llm_address=None, config=None):
    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:
        futures_with_index = [
            (i, executor.submit(extract_arguments, input, prompt, model, provider, local_llm_address))
            for i, input in enumerate(batch)
        ]

        done, not_done = concurrent.futures.wait([f for _, f in futures_with_index], timeout=30)
        results = [[] for _ in range(len(batch))]
        total_token_input = 0
        total_token_output = 0
        total_token_usage = 0

        for _, future in futures_with_index:
            if future in not_done and not future.cancelled():
                future.cancel()

        for i, future in futures_with_index:
            if future in done:
                try:
                    result = future.result()
                    if isinstance(result, tuple) and len(result) == 4:
                        items, token_input, token_output, token_total = result
                        results[i] = items
                        total_token_input += token_input
                        total_token_output += token_output
                        total_token_usage += token_total
                    else:
                        results[i] = result
                except Exception as e:
                    logging.error(f"Task {future} failed with error: {e}")
                    results[i] = []

        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + total_token_usage
            config["token_usage_input"] = config.get("token_usage_input", 0) + total_token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + total_token_output
            print(
                f"Extraction batch: input={total_token_input}, output={total_token_output}, total={total_token_usage} tokens"
            )

        return results


def extract_arguments(input, prompt, model, provider="openai", local_llm_address=None):
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            is_json=False,
            json_schema=ExtractionResponse,
            provider=provider,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )
        items = parse_extraction_response(response)
        items = list(filter(None, items))  # omit empty strings
        return items, token_input, token_output, token_total
    except json.decoder.JSONDecodeError as e:
        print("JSON error:", e)
        print("Input was:", input)
        print("Response was:", response)
        print("Silently giving up on trying to generate valid list.")
        return []
1e:T1149,"""Cluster the arguments using UMAP + HDBSCAN and GPT-4."""

from importlib import import_module

import numpy as np
import pandas as pd
import scipy.cluster.hierarchy as sch
from sklearn.cluster import KMeans


def hierarchical_clustering(config):
    UMAP = import_module("umap").UMAP

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_clusters.csv"
    arguments_df = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings_df = pd.read_pickle(f"outputs/{dataset}/embeddings.pkl")
    embeddings_array = np.asarray(embeddings_df["embedding"].values.tolist())
    cluster_nums = config["hierarchical_clustering"]["cluster_nums"]

    n_samples = embeddings_array.shape[0]
    # デフォルト設定は15
    default_n_neighbors = 15

    # テスト等サンプルが少なすぎる場合、n_neighborsの設定値を下げる
    if n_samples <= default_n_neighbors:
        n_neighbors = max(2, n_samples - 1)  # 最低2以上
    else:
        n_neighbors = default_n_neighbors

    umap_model = UMAP(random_state=42, n_components=2, n_neighbors=n_neighbors)
    # TODO 詳細エラーメッセージを加える
    # 以下のエラーの場合、おそらく元の意見件数が少なすぎることが原因
    # TypeError: Cannot use scipy.linalg.eigh for sparse A with k >= N. Use scipy.linalg.eigh(A.toarray()) or reduce k.
    umap_embeds = umap_model.fit_transform(embeddings_array)

    cluster_results = hierarchical_clustering_embeddings(
        umap_embeds=umap_embeds,
        cluster_nums=cluster_nums,
    )
    result_df = pd.DataFrame(
        {
            "arg-id": arguments_df["arg-id"],
            "argument": arguments_df["argument"],
            "x": umap_embeds[:, 0],
            "y": umap_embeds[:, 1],
        }
    )

    for cluster_level, final_labels in enumerate(cluster_results.values(), start=1):
        result_df[f"cluster-level-{cluster_level}-id"] = [f"{cluster_level}_{label}" for label in final_labels]

    result_df.to_csv(path, index=False)


def generate_cluster_count_list(min_clusters: int, max_clusters: int):
    cluster_counts = []
    current = min_clusters
    cluster_counts.append(current)

    if min_clusters == max_clusters:
        return cluster_counts

    while True:
        next_double = current * 2
        next_triple = current * 3

        if next_double >= max_clusters:
            if cluster_counts[-1] != max_clusters:
                cluster_counts.append(max_clusters)
            break

        # 次の倍はまだ max_clusters に収まるが、3倍だと超える
        # -> (次の倍は細かすぎるので)スキップして max_clusters に飛ぶ
        if next_triple > max_clusters:
            cluster_counts.append(max_clusters)
            break

        cluster_counts.append(next_double)
        current = next_double

    return cluster_counts


def merge_clusters_with_hierarchy(
    cluster_centers: np.ndarray,
    kmeans_labels: np.ndarray,
    umap_array: np.ndarray,
    n_cluster_cut: int,
):
    Z = sch.linkage(cluster_centers, method="ward")
    cluster_labels_merged = sch.fcluster(Z, t=n_cluster_cut, criterion="maxclust")

    n_samples = umap_array.shape[0]
    final_labels = np.zeros(n_samples, dtype=int)

    for i in range(n_samples):
        original_label = kmeans_labels[i]
        final_labels[i] = cluster_labels_merged[original_label]

    return final_labels


def hierarchical_clustering_embeddings(
    umap_embeds,
    cluster_nums,
):
    # 最大分割数でクラスタリングを実施
    print("start initial clustering")
    initial_cluster_num = cluster_nums[-1]
    kmeans_model = KMeans(n_clusters=initial_cluster_num, random_state=42)
    kmeans_model.fit(umap_embeds)
    print("end initial clustering")

    results = {}
    print("start hierarchical clustering")
    cluster_nums.sort()
    print(cluster_nums)
    for n_cluster_cut in cluster_nums[:-1]:
        print("n_cluster_cut: ", n_cluster_cut)
        final_labels = merge_clusters_with_hierarchy(
            cluster_centers=kmeans_model.cluster_centers_,
            kmeans_labels=kmeans_model.labels_,
            umap_array=umap_embeds,
            n_cluster_cut=n_cluster_cut,
        )
        results[n_cluster_cut] = final_labels

    results[initial_cluster_num] = kmeans_model.labels_
    print("end hierarchical clustering")

    return results
1f:T1c36,import json
import os
from concurrent.futures import ThreadPoolExecutor
from functools import partial
from typing import TypedDict

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class LabellingResult(TypedDict):
    """各クラスタのラベリング結果を表す型"""

    cluster_id: str  # クラスタのID
    label: str  # クラスタのラベル名
    description: str  # クラスタの説明文


def hierarchical_initial_labelling(config: dict) -> None:
    """階層的クラスタリングの初期ラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_initial_labelling: 初期ラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_initial_labels.csv"
    clusters_argument_df = pd.read_csv(f"outputs/{dataset}/hierarchical_clusters.csv")

    cluster_id_columns = [col for col in clusters_argument_df.columns if col.startswith("cluster-level-")]
    initial_cluster_id_column = cluster_id_columns[-1]
    sampling_num = config["hierarchical_initial_labelling"]["sampling_num"]
    initial_labelling_prompt = config["hierarchical_initial_labelling"]["prompt"]
    model = config["hierarchical_initial_labelling"]["model"]
    workers = config["hierarchical_initial_labelling"]["workers"]

    # トークン使用量を追跡するための変数を初期化
    config["total_token_usage"] = config.get("total_token_usage", 0)

    initial_label_df = initial_labelling(
        initial_labelling_prompt,
        clusters_argument_df,
        sampling_num,
        model,
        workers,
        config["provider"],
        config.get("local_llm_address"),
        config,  # configを渡して、トークン使用量を累積できるようにする
    )
    print("start initial labelling")
    initial_clusters_argument_df = clusters_argument_df.merge(
        initial_label_df,
        left_on=initial_cluster_id_column,
        right_on="cluster_id",
        how="left",
    ).rename(
        columns={
            "label": f"{initial_cluster_id_column.replace('-id', '')}-label",
            "description": f"{initial_cluster_id_column.replace('-id', '')}-description",
        }
    )
    print("end initial labelling")
    initial_clusters_argument_df.to_csv(path, index=False)


def initial_labelling(
    prompt: str,
    clusters_df: pd.DataFrame,
    sampling_num: int,
    model: str,
    workers: int,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> pd.DataFrame:
    """各クラスタに対して初期ラベリングを実行する

    Args:
        prompt: LLMへのプロンプト
        clusters_df: クラスタリング結果のDataFrame
        sampling_num: 各クラスタからサンプリングする意見の数
        model: 使用するLLMモデル名
        workers: 並列処理のワーカー数
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        各クラスタのラベリング結果を含むDataFrame
    """
    cluster_columns = [col for col in clusters_df.columns if col.startswith("cluster-level-")]
    initial_cluster_column = cluster_columns[-1]
    cluster_ids = clusters_df[initial_cluster_column].unique()
    process_func = partial(
        process_initial_labelling,
        df=clusters_df,
        prompt=prompt,
        sampling_num=sampling_num,
        target_column=initial_cluster_column,
        model=model,
        provider=provider,
        local_llm_address=local_llm_address,
        config=config,  # configを渡す
    )
    with ThreadPoolExecutor(max_workers=workers) as executor:
        results = list(executor.map(process_func, cluster_ids))
    return pd.DataFrame(results)


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_initial_labelling(
    cluster_id: str,
    df: pd.DataFrame,
    prompt: str,
    sampling_num: int,
    target_column: str,
    model: str,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> LabellingResult:
    """個別のクラスタに対してラベリングを実行する

    Args:
        cluster_id: 処理対象のクラスタID
        df: クラスタリング結果のDataFrame
        prompt: LLMへのプロンプト
        sampling_num: サンプリングする意見の数
        target_column: クラスタIDが格納されている列名
        model: 使用するLLMモデル名
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        クラスタのラベリング結果
    """
    cluster_data = df[df[target_column] == cluster_id]
    sampling_num = min(sampling_num, len(cluster_data))
    cluster = cluster_data.sample(sampling_num)
    input = "\n".join(cluster["argument"].values)
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            provider=provider,
            json_schema=LabellingFromat,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )

        # トークン使用量を累積（configが渡されている場合）
        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
            config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + token_output

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return LabellingResult(
            cluster_id=cluster_id,
            label=response_json.get("label", "エラーでラベル名が取得できませんでした"),
            description=response_json.get("description", "エラーで解説が取得できませんでした"),
        )
    except Exception as e:
        print(e)
        return LabellingResult(
            cluster_id=cluster_id,
            label="エラーでラベル名が取得できませんでした",
            description="エラーで解説が取得できませんでした",
        )
20:T337b,import json
import os
from concurrent.futures import ThreadPoolExecutor
from dataclasses import dataclass
from functools import partial

import numpy as np
import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai


@dataclass
class ClusterColumns:
    """同一階層のクラスター関連のカラム名を管理するクラス"""

    id: str
    label: str
    description: str

    @classmethod
    def from_id_column(cls, id_column: str) -> "ClusterColumns":
        """ID列名から関連するカラム名を生成"""
        return cls(
            id=id_column,
            label=id_column.replace("-id", "-label"),
            description=id_column.replace("-id", "-description"),
        )


@dataclass
class ClusterValues:
    """対象クラスタのlabel/descriptionを管理するクラス"""

    label: str
    description: str

    def to_prompt_text(self) -> str:
        return f"- {self.label}: {self.description}"


def hierarchical_merge_labelling(config: dict) -> None:
    """階層的クラスタリングの結果に対してマージラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_merge_labelling: マージラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    merge_path = f"outputs/{dataset}/hierarchical_merge_labels.csv"
    clusters_df = pd.read_csv(f"outputs/{dataset}/hierarchical_initial_labels.csv")

    cluster_id_columns: list[str] = _filter_id_columns(clusters_df.columns)
    # ボトムクラスタのラベル・説明とクラスタid付きの各argumentを入力し、各階層のクラスタラベル・説明を生成し、argumentに付けたdfを作成
    merge_result_df = merge_labelling(
        clusters_df=clusters_df,
        cluster_id_columns=sorted(cluster_id_columns, reverse=True),
        config=config,
    )
    # 上記のdfから各クラスタのlevel, id, label, description, valueを取得してdfを作成
    melted_df = melt_cluster_data(merge_result_df)
    # 上記のdfに親子関係を追加
    parent_child_df = _build_parent_child_mapping(merge_result_df, cluster_id_columns)
    melted_df = melted_df.merge(parent_child_df, on=["level", "id"], how="left")
    density_df = calculate_cluster_density(melted_df, config)
    density_df.to_csv(merge_path, index=False)


def _build_parent_child_mapping(df: pd.DataFrame, cluster_id_columns: list[str]):
    """クラスタ間の親子関係をマッピングする

    Args:
        df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト

    Returns:
        親子関係のマッピング情報を含むDataFrame
    """
    results = []
    top_cluster_column = cluster_id_columns[0]
    top_cluster_values = df[top_cluster_column].unique()
    for c in top_cluster_values:
        results.append(
            {
                "level": 1,
                "id": c,
                "parent": "0",  # aggregationで追加する全体クラスタのid
            }
        )

    for idx in range(len(cluster_id_columns) - 1):
        current_column = cluster_id_columns[idx]
        children_column = cluster_id_columns[idx + 1]
        current_level = current_column.replace("-id", "").replace("cluster-level-", "")
        # 現在のレベルのクラスタid
        current_cluster_values = df[current_column].unique()
        for current_id in current_cluster_values:
            children_ids = df.loc[df[current_column] == current_id, children_column].unique()
            for child_id in children_ids:
                results.append(
                    {
                        "level": int(current_level) + 1,
                        "id": child_id,
                        "parent": current_id,
                    }
                )
    return pd.DataFrame(results)


def _filter_id_columns(columns: list[str]) -> list[str]:
    """クラスタIDのカラム名をフィルタリングする

    Args:
        columns: 全カラム名のリスト

    Returns:
        クラスタIDのカラム名のリスト
    """
    return [col for col in columns if col.startswith("cluster-level-") and col.endswith("-id")]


def melt_cluster_data(df: pd.DataFrame) -> pd.DataFrame:
    """クラスタデータを行形式に変換する

    cluster-level-n-(id|label|description) を行形式 (level, id, label, description, value) にまとめる。
    [cluster-level-n-id, cluster-level-n-label, cluster-level-n-description] を [level, id, label, description, value(件数)] に変換する。

    Args:
        df: クラスタリング結果のDataFrame

    Returns:
        行形式に変換されたDataFrame
    """
    id_columns: list[str] = _filter_id_columns(df.columns)
    levels: set[int] = {int(col.replace("cluster-level-", "").replace("-id", "")) for col in id_columns}
    all_rows: list[dict] = []

    # levelごとに各クラスタの出現件数を集計・縦持ちにする
    for level in levels:
        cluster_columns = ClusterColumns.from_id_column(f"cluster-level-{level}-id")
        # クラスタidごとの件数集計
        level_count_df = df.groupby(cluster_columns.id).size().reset_index(name="value")

        level_unique_val_df = df[
            [cluster_columns.id, cluster_columns.label, cluster_columns.description]
        ].drop_duplicates()
        level_unique_val_df = level_unique_val_df.merge(level_count_df, on=cluster_columns.id, how="left")
        level_unique_vals = [
            {
                "level": level,
                "id": row[cluster_columns.id],
                "label": row[cluster_columns.label],
                "description": row[cluster_columns.description],
                "value": row["value"],
            }
            for _, row in level_unique_val_df.iterrows()
        ]
        all_rows.extend(level_unique_vals)
    return pd.DataFrame(all_rows)


def merge_labelling(clusters_df: pd.DataFrame, cluster_id_columns: list[str], config) -> pd.DataFrame:
    """階層的なクラスタのマージラベリングを実行する

    Args:
        clusters_df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含むDataFrame
    """
    for idx in tqdm(range(len(cluster_id_columns) - 1)):
        previous_columns = ClusterColumns.from_id_column(cluster_id_columns[idx])
        current_columns = ClusterColumns.from_id_column(cluster_id_columns[idx + 1])

        process_fn = partial(
            process_merge_labelling,
            result_df=clusters_df,
            current_columns=current_columns,
            previous_columns=previous_columns,
            config=config,
        )

        current_cluster_ids = sorted(clusters_df[current_columns.id].unique())
        with ThreadPoolExecutor(max_workers=config["hierarchical_merge_labelling"]["workers"]) as executor:
            responses = list(
                tqdm(
                    executor.map(process_fn, current_cluster_ids),
                    total=len(current_cluster_ids),
                )
            )

        current_result_df = pd.DataFrame(responses)
        clusters_df = clusters_df.merge(current_result_df, on=[current_columns.id])
    return clusters_df


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_merge_labelling(
    target_cluster_id: str,
    result_df: pd.DataFrame,
    current_columns: ClusterColumns,
    previous_columns: ClusterColumns,
    config,
):
    """個別のクラスタに対してマージラベリングを実行する

    Args:
        target_cluster_id: 処理対象のクラスタID
        result_df: クラスタリング結果のDataFrame
        current_columns: 現在のレベルのカラム情報
        previous_columns: 前のレベルのカラム情報
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含む辞書
    """

    def filter_previous_values(df: pd.DataFrame, previous_columns: ClusterColumns) -> list[ClusterValues]:
        """前のレベルのクラスタ情報を取得する"""
        previous_records = df[df[current_columns.id] == target_cluster_id][
            [previous_columns.label, previous_columns.description]
        ].drop_duplicates()
        previous_values = [
            ClusterValues(
                label=row[previous_columns.label],
                description=row[previous_columns.description],
            )
            for _, row in previous_records.iterrows()
        ]
        return previous_values

    previous_values = filter_previous_values(result_df, previous_columns)
    if len(previous_values) == 1:
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: previous_values[0].label,
            current_columns.description: previous_values[0].description,
        }
    elif len(previous_values) == 0:
        raise ValueError(f"クラスタ {target_cluster_id} には前のレベルのクラスタが存在しません。")

    current_cluster_data = result_df[result_df[current_columns.id] == target_cluster_id]
    sampling_num = min(
        config["hierarchical_merge_labelling"]["sampling_num"],
        len(current_cluster_data),
    )
    sampled_data = current_cluster_data.sample(sampling_num)
    sampled_argument_text = "\n".join(sampled_data["argument"].values)
    cluster_text = "\n".join([value.to_prompt_text() for value in previous_values])
    messages = [
        {"role": "system", "content": config["hierarchical_merge_labelling"]["prompt"]},
        {
            "role": "user",
            "content": "クラスタラベル\n" + cluster_text + "\n" + "クラスタの意見\n" + sampled_argument_text,
        },
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=config["hierarchical_merge_labelling"]["model"],
            json_schema=LabellingFromat,
            provider=config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )

        config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
        config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
        config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
        print(f"Merge labelling: input={token_input}, output={token_output}, total={token_total} tokens")

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: response_json.get("label", "エラーでラベル名が取得できませんでした"),
            current_columns.description: response_json.get("description", "エラーで解説が取得できませんでした"),
        }
    except Exception as e:
        print(f"エラーが発生しました: {e}")
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: "エラーでラベル名が取得できませんでした",
            current_columns.description: "エラーで解説が取得できませんでした",
        }


def calculate_cluster_density(melted_df: pd.DataFrame, config: dict):
    """クラスタ内の密度計算"""
    hierarchical_cluster_df = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_clusters.csv")

    densities = []
    for level, c_id in zip(melted_df["level"], melted_df["id"], strict=False):
        cluster_embeds = hierarchical_cluster_df[hierarchical_cluster_df[f"cluster-level-{level}-id"] == c_id][
            ["x", "y"]
        ].values
        density = calculate_density(cluster_embeds)
        densities.append(density)

    # 密度のランクを計算
    melted_df["density"] = densities
    melted_df["density_rank"] = melted_df.groupby("level")["density"].rank(ascending=False, method="first")
    melted_df["density_rank_percentile"] = melted_df.groupby("level")["density_rank"].transform(lambda x: x / len(x))
    return melted_df


def calculate_density(embeds: np.ndarray):
    """平均距離に基づいて密度を計算"""
    center = np.mean(embeds, axis=0)
    distances = np.linalg.norm(embeds - center, axis=1)
    avg_distance = np.mean(distances)
    density = 1 / (avg_distance + 1e-10)
    return density
21:Ta82,"""Create summaries for the clusters."""

import json
import os
import re

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class OverviewResponse(BaseModel):
    summary: str = Field(..., description="クラスターの全体的な要約")


def hierarchical_overview(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_overview.txt"

    hierarchical_label_df = pd.read_csv(f"outputs/{dataset}/hierarchical_merge_labels.csv")

    prompt = config["hierarchical_overview"]["prompt"]
    model = config["hierarchical_overview"]["model"]

    # TODO: level1で固定にしているが、設定で変えられるようにする
    target_level = 1
    target_records = hierarchical_label_df[hierarchical_label_df["level"] == target_level]
    ids = target_records["id"].to_list()
    labels = target_records["label"].to_list()
    descriptions = target_records["description"].to_list()
    target_records.set_index("id", inplace=True)

    input_text = ""
    for i, _ in enumerate(ids):
        input_text += f"# Cluster {i}/{len(ids)}: {labels[i]}\n\n"
        input_text += descriptions[i] + "\n\n"

    messages = [{"role": "system", "content": prompt}, {"role": "user", "content": input_text}]
    response_text, token_input, token_output, token_total = request_to_chat_ai(
        messages=messages,
        model=model,
        provider=config["provider"],
        local_llm_address=config.get("local_llm_address"),
        user_api_key=os.getenv("USER_API_KEY"),
        json_schema=OverviewResponse,
    )

    # トークン使用量を累積
    config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
    config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
    config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
    print(f"Hierarchical overview: input={token_input}, output={token_output}, total={token_total} tokens")

    try:
        # structured outputとしてパースできるなら処理する
        if isinstance(response_text, dict):
            parsed_response = response_text
        else:
            parsed_response = json.loads(response_text)

        with open(path, "w") as file:
            file.write(parsed_response["summary"])

    except Exception:
        # thinkタグが出力されるReasoningモデル用に、thinkタグを除去する
        thinking_removed = re.sub(
            r"<think\b[^>]*>.*?</think>",
            "",
            response_text,
            flags=re.DOTALL,
        )

        with open(path, "w") as file:
            file.write(thinking_removed)
22:T3f38,"""Generate a convenient JSON output file."""

import json
from collections import defaultdict
from pathlib import Path
from typing import Any, TypedDict

import numpy as np
import pandas as pd

ROOT_DIR = Path(__file__).parent.parent.parent.parent
CONFIG_DIR = ROOT_DIR / "scatter" / "pipeline" / "configs"
PIPELINE_DIR = ROOT_DIR / "broadlistening" / "pipeline"


def json_serialize_numpy(obj: Any) -> Any:
    """
    Recursively convert NumPy data types to native Python types for JSON serialization.

    Args:
        obj: Any Python object which might contain NumPy data types

    Returns:
        The same object structure with NumPy types converted to Python native types
    """
    if isinstance(obj, np.integer):
        return int(obj)
    elif isinstance(obj, np.floating):
        return float(obj)
    elif isinstance(obj, np.ndarray):
        return obj.tolist()
    elif isinstance(obj, dict):
        return {k: json_serialize_numpy(v) for k, v in obj.items()}
    elif isinstance(obj, list):
        return [json_serialize_numpy(item) for item in obj]
    elif isinstance(obj, tuple):
        return tuple(json_serialize_numpy(item) for item in obj)
    else:
        return obj


class Argument(TypedDict):
    arg_id: str
    argument: str
    comment_id: str
    x: float
    y: float
    p: float
    cluster_ids: list[str]
    attributes: dict[str, str] | None
    url: str | None


class Cluster(TypedDict):
    level: int
    id: str
    label: str
    takeaway: str
    value: int
    parent: str
    density_rank_percentile: float | None


def hierarchical_aggregation(config) -> bool:
    try:
        path = f"outputs/{config['output_dir']}/hierarchical_result.json"
        results = {
            "arguments": [],
            "clusters": [],
            "comments": {},
            "propertyMap": {},
            "translations": {},
            "overview": "",
            "config": config,
        }

        arguments = pd.read_csv(f"outputs/{config['output_dir']}/args.csv")
        arguments.set_index("arg-id", inplace=True)
        arg_num = len(arguments)
        relation_df = pd.read_csv(f"outputs/{config['output_dir']}/relations.csv")
        comments = pd.read_csv(f"inputs/{config['input']}.csv")
        clusters = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_clusters.csv")
        labels = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_merge_labels.csv")

        hidden_properties_map: dict[str, list[str]] = config["hierarchical_aggregation"]["hidden_properties"]

        results["arguments"] = _build_arguments(clusters, comments, relation_df, config)
        results["clusters"] = _build_cluster_value(labels, arg_num)

        # results["comments"] = _build_comments_value(
        #     comments, arguments, hidden_properties_map
        # )
        results["comment_num"] = len(comments)
        results["translations"] = _build_translations(config)
        # 属性情報のカラムは、元データに対して指定したカラムとclassificationするカテゴリを合わせたもの
        results["propertyMap"] = _build_property_map(arguments, comments, hidden_properties_map, config)

        with open(f"outputs/{config['output_dir']}/hierarchical_overview.txt") as f:
            overview = f.read()
        print("overview")
        print(overview)
        results["overview"] = overview

        # Convert non-serializable NumPy types to native Python types
        results = json_serialize_numpy(results)

        with open(path, "w") as file:
            json.dump(results, file, indent=2, ensure_ascii=False)
        # TODO: サンプリングロジックを実装したいが、現状は全件抽出
        create_custom_intro(config)
        if config["is_pubcom"]:
            add_original_comments(labels, arguments, relation_df, clusters, config)
        return True
    except Exception as e:
        print("error")
        print(e)
        return False


def create_custom_intro(config):
    dataset = config["output_dir"]
    args_path = PIPELINE_DIR / f"outputs/{dataset}/args.csv"
    comments = pd.read_csv(PIPELINE_DIR / f"inputs/{config['input']}.csv")
    result_path = PIPELINE_DIR / f"outputs/{dataset}/hierarchical_result.json"

    input_count = len(comments)
    args_count = len(pd.read_csv(args_path))
    processed_num = min(input_count, config["extraction"]["limit"])

    print(f"Input count: {input_count}")
    print(f"Args count: {args_count}")

    # LLMプロバイダーとモデル名の判定
    def get_llm_provider_display():
        # configからプロバイダー情報を取得（優先）
        provider = config.get("provider", "openai")
        model = config.get("model", "unknown")

        # プロバイダー名をマッピング
        provider_names = {
            "openai": "OpenAI API",
            "azure": "Azure OpenAI API",
            "openrouter": "OpenRouter API",
            "local": "Local LLM",
        }

        provider_name = provider_names.get(provider, f"{provider} API")
        return f"{provider_name} ({model})"

    llm_provider = get_llm_provider_display()

    base_custom_intro = """{intro}
分析対象となったデータの件数は{processed_num}件で、これらのデータに対して{llm_provider}を用いて{args_count}件の意見（議論）を抽出し、クラスタリングを行った。
"""

    intro = config["intro"]
    custom_intro = base_custom_intro.format(
        intro=intro, processed_num=processed_num, args_count=args_count, llm_provider=llm_provider
    )

    with open(result_path) as f:
        result = json.load(f)
    result["config"]["intro"] = custom_intro
    with open(result_path, "w") as f:
        json.dump(result, f, indent=2, ensure_ascii=False)


def add_original_comments(labels, arguments, relation_df, clusters, config):
    # 大カテゴリ（cluster-level-1）に該当するラベルだけ抽出
    labels_lv1 = labels[labels["level"] == 1][["id", "label"]].rename(
        columns={"id": "cluster-level-1-id", "label": "category_label"}
    )

    # arguments と clusters をマージ（カテゴリ情報付与）
    merged = arguments.merge(clusters[["arg-id", "cluster-level-1-id"]], on="arg-id").merge(
        labels_lv1, on="cluster-level-1-id", how="left"
    )

    # relation_df と結合
    merged = merged.merge(relation_df, on="arg-id", how="left")

    # 元コメント取得
    comments = pd.read_csv(PIPELINE_DIR / f"inputs/{config['input']}.csv")
    comments["comment-id"] = comments["comment-id"].astype(str)
    merged["comment-id"] = merged["comment-id"].astype(str)

    # 元コメント本文などとマージ
    final_df = merged.merge(comments, on="comment-id", how="left")

    # 必要カラムのみ整形
    final_cols = ["comment-id", "comment-body", "arg-id", "argument", "cluster-level-1-id", "category_label"]

    # 基本カラム
    for col in ["x", "y", "source", "url"]:
        if col in comments.columns:
            final_cols.append(col)

    # 属性カラムを追加
    attribute_columns = []
    for col in comments.columns:
        # attributeプレフィックスが付いたカラムを探す
        if col.startswith("attribute_"):
            attribute_columns.append(col)
            final_cols.append(col)

    print(f"属性カラム検出: {attribute_columns}")

    # 必要なカラムだけ選択
    final_df = final_df[final_cols]
    final_df = final_df.rename(
        columns={
            "cluster-level-1-id": "category_id",
            "category_label": "category",
            "arg-id": "arg_id",
            "argument": "argument",
            "comment-body": "original-comment",
        }
    )

    # 保存
    final_df.to_csv(PIPELINE_DIR / f"outputs/{config['output_dir']}/final_result_with_comments.csv", index=False)


def _build_arguments(
    clusters: pd.DataFrame, comments: pd.DataFrame, relation_df: pd.DataFrame, config: dict
) -> list[Argument]:
    """
    Build the arguments list including attribute information from original comments

    Args:
        clusters: DataFrame containing cluster information for each argument
        comments: DataFrame containing original comments with attribute columns
        relation_df: DataFrame relating arguments to original comments
        config: Configuration dictionary containing enable_source_link setting
    """
    cluster_columns = [col for col in clusters.columns if col.startswith("cluster-level-") and "id" in col]

    # Prepare for merging with original comments to get attributes
    comments_copy = comments.copy()
    comments_copy["comment-id"] = comments_copy["comment-id"].astype(str)

    # Get argument to comment mapping
    arg_comment_map = {}
    if "comment-id" in relation_df.columns:
        relation_df["comment-id"] = relation_df["comment-id"].astype(str)
        arg_comment_map = dict(zip(relation_df["arg-id"], relation_df["comment-id"], strict=False))

    # Find attribute columns in comments dataframe
    attribute_columns = [col for col in comments.columns if col.startswith("attribute_")]
    print(f"属性カラム検出: {attribute_columns}")

    arguments: list[Argument] = []
    for _, row in clusters.iterrows():
        cluster_ids = ["0"]
        for cluster_column in cluster_columns:
            cluster_ids.append(str(row[cluster_column]))  # Convert to string to ensure serializable

        # Create base argument
        argument: Argument = {
            "arg_id": str(row["arg-id"]),  # Convert to string to ensure serializable
            "argument": str(row["argument"]),
            "x": float(row["x"]),  # Convert to native float
            "y": float(row["y"]),  # Convert to native float
            "p": 0,  # NOTE: 一旦全部0でいれる
            "cluster_ids": cluster_ids,
            "attributes": None,
            "url": None,
        }

        # Add attributes and URL if available
        if row["arg-id"] in arg_comment_map:
            comment_id = arg_comment_map[row["arg-id"]]
            comment_rows = comments_copy[comments_copy["comment-id"] == comment_id]

            if not comment_rows.empty:
                comment_row = comment_rows.iloc[0]

                # Add URL if available and enabled
                if config.get("enable_source_link", False) and "url" in comment_row and comment_row["url"] is not None:
                    argument["url"] = str(comment_row["url"])

                # Add attributes if available
                if attribute_columns:
                    attributes = {}
                    for attr_col in attribute_columns:
                        # Remove "attribute_" prefix for cleaner attribute names
                        attr_name = attr_col[len("attribute_") :]
                        # Convert potential numpy types to Python native types
                        attr_value = comment_row.get(attr_col, None)
                        if attr_value is not None:
                            if isinstance(attr_value, np.integer):
                                attr_value = int(attr_value)
                            elif isinstance(attr_value, np.floating):
                                attr_value = float(attr_value)
                            elif isinstance(attr_value, np.ndarray):
                                attr_value = attr_value.tolist()
                        attributes[attr_name] = attr_value

                    # Only add non-empty attributes
                    if any(v is not None for v in attributes.values()):
                        argument["attributes"] = attributes

        arguments.append(argument)
    return arguments


def _build_cluster_value(melted_labels: pd.DataFrame, total_num: int) -> list[Cluster]:
    results: list[Cluster] = [
        Cluster(
            level=0,
            id="0",
            label="全体",
            takeaway="",
            value=int(total_num),  # Convert to native int
            parent="",
            density_rank_percentile=0,
        )
    ]

    for _, melted_label in melted_labels.iterrows():
        # Convert potential NumPy types to native Python types
        level = (
            int(melted_label["level"]) if isinstance(melted_label["level"], int | np.integer) else melted_label["level"]
        )
        cluster_id = str(melted_label["id"])
        label = str(melted_label["label"])
        takeaway = str(melted_label["description"])
        value = (
            int(melted_label["value"]) if isinstance(melted_label["value"], int | np.integer) else melted_label["value"]
        )
        parent = str(melted_label.get("parent", "全体"))

        # Handle density_rank_percentile which might be None or a numeric value
        density_rank = melted_label.get("density_rank_percentile")
        if density_rank is not None:
            if isinstance(density_rank, float | np.floating):
                density_rank = float(density_rank)
            elif isinstance(density_rank, int | np.integer):
                density_rank = int(density_rank)

        cluster_value = Cluster(
            level=level,
            id=cluster_id,
            label=label,
            takeaway=takeaway,
            value=value,
            parent=parent,
            density_rank_percentile=density_rank,
        )
        results.append(cluster_value)
    return results


def _build_comments_value(
    comments: pd.DataFrame,
    arguments: pd.DataFrame,
    hidden_properties_map: dict[str, list[str]],
):
    comment_dict: dict[str, dict[str, str]] = {}
    useful_comment_ids = set(arguments["comment-id"].values)
    for _, row in comments.iterrows():
        id = row["comment-id"]
        if id in useful_comment_ids:
            res = {"comment": row["comment-body"]}
            should_skip = any(row[prop] in hidden_values for prop, hidden_values in hidden_properties_map.items())
            if should_skip:
                continue
            comment_dict[str(id)] = res

    return comment_dict


def _build_translations(config):
    languages = list(config.get("translation", {}).get("languages", []))
    if len(languages) > 0:
        with open(PIPELINE_DIR / f"outputs/{config['output_dir']}/translations.json") as f:
            translations = f.read()
        return json.loads(translations)
    return {}


def _build_property_map(
    arguments: pd.DataFrame, comments: pd.DataFrame, hidden_properties_map: dict[str, list[str]], config: dict
) -> dict[str, dict[str, str]]:
    property_columns = list(hidden_properties_map.keys()) + list(config["extraction"]["categories"].keys())
    property_map = defaultdict(dict)

    # 指定された property_columns が arguments に存在するかチェック
    missing_cols = [col for col in property_columns if col not in arguments.columns]
    if missing_cols:
        raise ValueError(
            f"指定されたカラム {missing_cols} が args.csv に存在しません。"
            "設定ファイルaggregation / hidden_propertiesから該当カラムを取り除いてください。"
        )

    for prop in property_columns:
        for arg_id, row in arguments.iterrows():
            # LLMによるcategory classificationがうまく行かず、NaNの場合はNoneにする
            value = row[prop] if not pd.isna(row[prop]) else None

            # Convert NumPy types to Python native types
            if value is not None:
                if isinstance(value, np.integer):
                    value = int(value)
                elif isinstance(value, np.floating):
                    value = float(value)
                elif isinstance(value, np.ndarray):
                    value = value.tolist()
                else:
                    # Convert any other types to string to ensure serialization
                    try:
                        value = str(value)
                    except Exception as e:
                        print(f"Error converting value to string: {e}")
                        value = None

            # Make sure arg_id is string
            str_arg_id = str(arg_id)
            property_map[prop][str_arg_id] = value

    return property_map
23:T458,import os

import pandas as pd
from tqdm import tqdm

from services.llm import request_to_embed


def embedding(config):
    model = config["embedding"]["model"]
    is_embedded_at_local = config["is_embedded_at_local"]
    # print("start embedding")
    # print(f"embedding model: {model}, is_embedded_at_local: {is_embedded_at_local}")

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/embeddings.pkl"
    arguments = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings = []
    batch_size = 1000
    for i in tqdm(range(0, len(arguments), batch_size)):
        args = arguments["argument"].tolist()[i : i + batch_size]
        embeds = request_to_embed(
            args,
            model,
            is_embedded_at_local,
            config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )
        embeddings.extend(embeds)
    df = pd.DataFrame([{"arg-id": arguments.iloc[i]["arg-id"], "embedding": e} for i, e in enumerate(embeddings)])
    df.to_pickle(path)
24:T194c,import concurrent.futures
import json
import logging
import os
import re

import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai
from services.parse_json_list import parse_extraction_response
from utils import update_progress

COMMA_AND_SPACE_AND_RIGHT_BRACKET = re.compile(r",\s*(\])")


class ExtractionResponse(BaseModel):
    extractedOpinionList: list[str] = Field(..., description="抽出した意見のリスト")


def _validate_property_columns(property_columns: list[str], comments: pd.DataFrame) -> None:
    if not all(property in comments.columns for property in property_columns):
        raise ValueError(f"Properties {property_columns} not found in comments. Columns are {comments.columns}")


def extraction(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/args.csv"
    model = config["extraction"]["model"]
    prompt = config["extraction"]["prompt"]
    workers = config["extraction"]["workers"]
    limit = config["extraction"]["limit"]
    property_columns = config["extraction"]["properties"]

    if "provider" not in config:
        raise RuntimeError("provider is not set")
    provider = config["provider"]

    # カラム名だけを読み込み、必要なカラムが含まれているか確認する
    comments = pd.read_csv(f"inputs/{config['input']}.csv", nrows=0)
    _validate_property_columns(property_columns, comments)
    # エラーが出なかった場合、すべての行を読み込む
    comments = pd.read_csv(
        f"inputs/{config['input']}.csv", usecols=["comment-id", "comment-body"] + config["extraction"]["properties"]
    )
    comment_ids = (comments["comment-id"].values)[:limit]
    comments.set_index("comment-id", inplace=True)
    results = pd.DataFrame()
    update_progress(config, total=len(comment_ids))

    argument_map = {}
    relation_rows = []

    for i in tqdm(range(0, len(comment_ids), workers)):
        batch = comment_ids[i : i + workers]
        batch_inputs = [comments.loc[id]["comment-body"] for id in batch]
        batch_results = extract_batch(
            batch_inputs, prompt, model, workers, provider, config.get("local_llm_address"), config
        )

        for comment_id, extracted_args in zip(batch, batch_results, strict=False):
            for j, arg in enumerate(extracted_args):
                if arg not in argument_map:
                    # argumentテーブルに追加
                    arg_id = f"A{comment_id}_{j}"
                    argument = arg
                    argument_map[arg] = {
                        "arg-id": arg_id,
                        "argument": argument,
                    }
                else:
                    arg_id = argument_map[arg]["arg-id"]

                # relationテーブルにcommentとargの関係を追加
                relation_row = {
                    "arg-id": arg_id,
                    "comment-id": comment_id,
                }
                relation_rows.append(relation_row)

        update_progress(config, incr=len(batch))

    # DataFrame化
    results = pd.DataFrame(argument_map.values())
    relation_df = pd.DataFrame(relation_rows)

    if results.empty:
        raise RuntimeError("result is empty, maybe bad prompt")

    results.to_csv(path, index=False)
    # comment-idとarg-idの関係を保存
    relation_df.to_csv(f"outputs/{dataset}/relations.csv", index=False)


logging.basicConfig(level=logging.DEBUG)


def extract_batch(batch, prompt, model, workers, provider="openai", local_llm_address=None, config=None):
    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:
        futures_with_index = [
            (i, executor.submit(extract_arguments, input, prompt, model, provider, local_llm_address))
            for i, input in enumerate(batch)
        ]

        done, not_done = concurrent.futures.wait([f for _, f in futures_with_index], timeout=30)
        results = [[] for _ in range(len(batch))]
        total_token_input = 0
        total_token_output = 0
        total_token_usage = 0

        for _, future in futures_with_index:
            if future in not_done and not future.cancelled():
                future.cancel()

        for i, future in futures_with_index:
            if future in done:
                try:
                    result = future.result()
                    if isinstance(result, tuple) and len(result) == 4:
                        items, token_input, token_output, token_total = result
                        results[i] = items
                        total_token_input += token_input
                        total_token_output += token_output
                        total_token_usage += token_total
                    else:
                        results[i] = result
                except Exception as e:
                    logging.error(f"Task {future} failed with error: {e}")
                    results[i] = []

        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + total_token_usage
            config["token_usage_input"] = config.get("token_usage_input", 0) + total_token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + total_token_output
            print(
                f"Extraction batch: input={total_token_input}, output={total_token_output}, total={total_token_usage} tokens"
            )

        return results


def extract_arguments(input, prompt, model, provider="openai", local_llm_address=None):
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            is_json=False,
            json_schema=ExtractionResponse,
            provider=provider,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )
        items = parse_extraction_response(response)
        items = list(filter(None, items))  # omit empty strings
        return items, token_input, token_output, token_total
    except json.decoder.JSONDecodeError as e:
        print("JSON error:", e)
        print("Input was:", input)
        print("Response was:", response)
        print("Silently giving up on trying to generate valid list.")
        return []
25:T458,import os

import pandas as pd
from tqdm import tqdm

from services.llm import request_to_embed


def embedding(config):
    model = config["embedding"]["model"]
    is_embedded_at_local = config["is_embedded_at_local"]
    # print("start embedding")
    # print(f"embedding model: {model}, is_embedded_at_local: {is_embedded_at_local}")

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/embeddings.pkl"
    arguments = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings = []
    batch_size = 1000
    for i in tqdm(range(0, len(arguments), batch_size)):
        args = arguments["argument"].tolist()[i : i + batch_size]
        embeds = request_to_embed(
            args,
            model,
            is_embedded_at_local,
            config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )
        embeddings.extend(embeds)
    df = pd.DataFrame([{"arg-id": arguments.iloc[i]["arg-id"], "embedding": e} for i, e in enumerate(embeddings)])
    df.to_pickle(path)
26:T1149,"""Cluster the arguments using UMAP + HDBSCAN and GPT-4."""

from importlib import import_module

import numpy as np
import pandas as pd
import scipy.cluster.hierarchy as sch
from sklearn.cluster import KMeans


def hierarchical_clustering(config):
    UMAP = import_module("umap").UMAP

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_clusters.csv"
    arguments_df = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings_df = pd.read_pickle(f"outputs/{dataset}/embeddings.pkl")
    embeddings_array = np.asarray(embeddings_df["embedding"].values.tolist())
    cluster_nums = config["hierarchical_clustering"]["cluster_nums"]

    n_samples = embeddings_array.shape[0]
    # デフォルト設定は15
    default_n_neighbors = 15

    # テスト等サンプルが少なすぎる場合、n_neighborsの設定値を下げる
    if n_samples <= default_n_neighbors:
        n_neighbors = max(2, n_samples - 1)  # 最低2以上
    else:
        n_neighbors = default_n_neighbors

    umap_model = UMAP(random_state=42, n_components=2, n_neighbors=n_neighbors)
    # TODO 詳細エラーメッセージを加える
    # 以下のエラーの場合、おそらく元の意見件数が少なすぎることが原因
    # TypeError: Cannot use scipy.linalg.eigh for sparse A with k >= N. Use scipy.linalg.eigh(A.toarray()) or reduce k.
    umap_embeds = umap_model.fit_transform(embeddings_array)

    cluster_results = hierarchical_clustering_embeddings(
        umap_embeds=umap_embeds,
        cluster_nums=cluster_nums,
    )
    result_df = pd.DataFrame(
        {
            "arg-id": arguments_df["arg-id"],
            "argument": arguments_df["argument"],
            "x": umap_embeds[:, 0],
            "y": umap_embeds[:, 1],
        }
    )

    for cluster_level, final_labels in enumerate(cluster_results.values(), start=1):
        result_df[f"cluster-level-{cluster_level}-id"] = [f"{cluster_level}_{label}" for label in final_labels]

    result_df.to_csv(path, index=False)


def generate_cluster_count_list(min_clusters: int, max_clusters: int):
    cluster_counts = []
    current = min_clusters
    cluster_counts.append(current)

    if min_clusters == max_clusters:
        return cluster_counts

    while True:
        next_double = current * 2
        next_triple = current * 3

        if next_double >= max_clusters:
            if cluster_counts[-1] != max_clusters:
                cluster_counts.append(max_clusters)
            break

        # 次の倍はまだ max_clusters に収まるが、3倍だと超える
        # -> (次の倍は細かすぎるので)スキップして max_clusters に飛ぶ
        if next_triple > max_clusters:
            cluster_counts.append(max_clusters)
            break

        cluster_counts.append(next_double)
        current = next_double

    return cluster_counts


def merge_clusters_with_hierarchy(
    cluster_centers: np.ndarray,
    kmeans_labels: np.ndarray,
    umap_array: np.ndarray,
    n_cluster_cut: int,
):
    Z = sch.linkage(cluster_centers, method="ward")
    cluster_labels_merged = sch.fcluster(Z, t=n_cluster_cut, criterion="maxclust")

    n_samples = umap_array.shape[0]
    final_labels = np.zeros(n_samples, dtype=int)

    for i in range(n_samples):
        original_label = kmeans_labels[i]
        final_labels[i] = cluster_labels_merged[original_label]

    return final_labels


def hierarchical_clustering_embeddings(
    umap_embeds,
    cluster_nums,
):
    # 最大分割数でクラスタリングを実施
    print("start initial clustering")
    initial_cluster_num = cluster_nums[-1]
    kmeans_model = KMeans(n_clusters=initial_cluster_num, random_state=42)
    kmeans_model.fit(umap_embeds)
    print("end initial clustering")

    results = {}
    print("start hierarchical clustering")
    cluster_nums.sort()
    print(cluster_nums)
    for n_cluster_cut in cluster_nums[:-1]:
        print("n_cluster_cut: ", n_cluster_cut)
        final_labels = merge_clusters_with_hierarchy(
            cluster_centers=kmeans_model.cluster_centers_,
            kmeans_labels=kmeans_model.labels_,
            umap_array=umap_embeds,
            n_cluster_cut=n_cluster_cut,
        )
        results[n_cluster_cut] = final_labels

    results[initial_cluster_num] = kmeans_model.labels_
    print("end hierarchical clustering")

    return results
27:T1c36,import json
import os
from concurrent.futures import ThreadPoolExecutor
from functools import partial
from typing import TypedDict

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class LabellingResult(TypedDict):
    """各クラスタのラベリング結果を表す型"""

    cluster_id: str  # クラスタのID
    label: str  # クラスタのラベル名
    description: str  # クラスタの説明文


def hierarchical_initial_labelling(config: dict) -> None:
    """階層的クラスタリングの初期ラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_initial_labelling: 初期ラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_initial_labels.csv"
    clusters_argument_df = pd.read_csv(f"outputs/{dataset}/hierarchical_clusters.csv")

    cluster_id_columns = [col for col in clusters_argument_df.columns if col.startswith("cluster-level-")]
    initial_cluster_id_column = cluster_id_columns[-1]
    sampling_num = config["hierarchical_initial_labelling"]["sampling_num"]
    initial_labelling_prompt = config["hierarchical_initial_labelling"]["prompt"]
    model = config["hierarchical_initial_labelling"]["model"]
    workers = config["hierarchical_initial_labelling"]["workers"]

    # トークン使用量を追跡するための変数を初期化
    config["total_token_usage"] = config.get("total_token_usage", 0)

    initial_label_df = initial_labelling(
        initial_labelling_prompt,
        clusters_argument_df,
        sampling_num,
        model,
        workers,
        config["provider"],
        config.get("local_llm_address"),
        config,  # configを渡して、トークン使用量を累積できるようにする
    )
    print("start initial labelling")
    initial_clusters_argument_df = clusters_argument_df.merge(
        initial_label_df,
        left_on=initial_cluster_id_column,
        right_on="cluster_id",
        how="left",
    ).rename(
        columns={
            "label": f"{initial_cluster_id_column.replace('-id', '')}-label",
            "description": f"{initial_cluster_id_column.replace('-id', '')}-description",
        }
    )
    print("end initial labelling")
    initial_clusters_argument_df.to_csv(path, index=False)


def initial_labelling(
    prompt: str,
    clusters_df: pd.DataFrame,
    sampling_num: int,
    model: str,
    workers: int,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> pd.DataFrame:
    """各クラスタに対して初期ラベリングを実行する

    Args:
        prompt: LLMへのプロンプト
        clusters_df: クラスタリング結果のDataFrame
        sampling_num: 各クラスタからサンプリングする意見の数
        model: 使用するLLMモデル名
        workers: 並列処理のワーカー数
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        各クラスタのラベリング結果を含むDataFrame
    """
    cluster_columns = [col for col in clusters_df.columns if col.startswith("cluster-level-")]
    initial_cluster_column = cluster_columns[-1]
    cluster_ids = clusters_df[initial_cluster_column].unique()
    process_func = partial(
        process_initial_labelling,
        df=clusters_df,
        prompt=prompt,
        sampling_num=sampling_num,
        target_column=initial_cluster_column,
        model=model,
        provider=provider,
        local_llm_address=local_llm_address,
        config=config,  # configを渡す
    )
    with ThreadPoolExecutor(max_workers=workers) as executor:
        results = list(executor.map(process_func, cluster_ids))
    return pd.DataFrame(results)


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_initial_labelling(
    cluster_id: str,
    df: pd.DataFrame,
    prompt: str,
    sampling_num: int,
    target_column: str,
    model: str,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> LabellingResult:
    """個別のクラスタに対してラベリングを実行する

    Args:
        cluster_id: 処理対象のクラスタID
        df: クラスタリング結果のDataFrame
        prompt: LLMへのプロンプト
        sampling_num: サンプリングする意見の数
        target_column: クラスタIDが格納されている列名
        model: 使用するLLMモデル名
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        クラスタのラベリング結果
    """
    cluster_data = df[df[target_column] == cluster_id]
    sampling_num = min(sampling_num, len(cluster_data))
    cluster = cluster_data.sample(sampling_num)
    input = "\n".join(cluster["argument"].values)
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            provider=provider,
            json_schema=LabellingFromat,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )

        # トークン使用量を累積（configが渡されている場合）
        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
            config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + token_output

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return LabellingResult(
            cluster_id=cluster_id,
            label=response_json.get("label", "エラーでラベル名が取得できませんでした"),
            description=response_json.get("description", "エラーで解説が取得できませんでした"),
        )
    except Exception as e:
        print(e)
        return LabellingResult(
            cluster_id=cluster_id,
            label="エラーでラベル名が取得できませんでした",
            description="エラーで解説が取得できませんでした",
        )
28:T337b,import json
import os
from concurrent.futures import ThreadPoolExecutor
from dataclasses import dataclass
from functools import partial

import numpy as np
import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai


@dataclass
class ClusterColumns:
    """同一階層のクラスター関連のカラム名を管理するクラス"""

    id: str
    label: str
    description: str

    @classmethod
    def from_id_column(cls, id_column: str) -> "ClusterColumns":
        """ID列名から関連するカラム名を生成"""
        return cls(
            id=id_column,
            label=id_column.replace("-id", "-label"),
            description=id_column.replace("-id", "-description"),
        )


@dataclass
class ClusterValues:
    """対象クラスタのlabel/descriptionを管理するクラス"""

    label: str
    description: str

    def to_prompt_text(self) -> str:
        return f"- {self.label}: {self.description}"


def hierarchical_merge_labelling(config: dict) -> None:
    """階層的クラスタリングの結果に対してマージラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_merge_labelling: マージラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    merge_path = f"outputs/{dataset}/hierarchical_merge_labels.csv"
    clusters_df = pd.read_csv(f"outputs/{dataset}/hierarchical_initial_labels.csv")

    cluster_id_columns: list[str] = _filter_id_columns(clusters_df.columns)
    # ボトムクラスタのラベル・説明とクラスタid付きの各argumentを入力し、各階層のクラスタラベル・説明を生成し、argumentに付けたdfを作成
    merge_result_df = merge_labelling(
        clusters_df=clusters_df,
        cluster_id_columns=sorted(cluster_id_columns, reverse=True),
        config=config,
    )
    # 上記のdfから各クラスタのlevel, id, label, description, valueを取得してdfを作成
    melted_df = melt_cluster_data(merge_result_df)
    # 上記のdfに親子関係を追加
    parent_child_df = _build_parent_child_mapping(merge_result_df, cluster_id_columns)
    melted_df = melted_df.merge(parent_child_df, on=["level", "id"], how="left")
    density_df = calculate_cluster_density(melted_df, config)
    density_df.to_csv(merge_path, index=False)


def _build_parent_child_mapping(df: pd.DataFrame, cluster_id_columns: list[str]):
    """クラスタ間の親子関係をマッピングする

    Args:
        df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト

    Returns:
        親子関係のマッピング情報を含むDataFrame
    """
    results = []
    top_cluster_column = cluster_id_columns[0]
    top_cluster_values = df[top_cluster_column].unique()
    for c in top_cluster_values:
        results.append(
            {
                "level": 1,
                "id": c,
                "parent": "0",  # aggregationで追加する全体クラスタのid
            }
        )

    for idx in range(len(cluster_id_columns) - 1):
        current_column = cluster_id_columns[idx]
        children_column = cluster_id_columns[idx + 1]
        current_level = current_column.replace("-id", "").replace("cluster-level-", "")
        # 現在のレベルのクラスタid
        current_cluster_values = df[current_column].unique()
        for current_id in current_cluster_values:
            children_ids = df.loc[df[current_column] == current_id, children_column].unique()
            for child_id in children_ids:
                results.append(
                    {
                        "level": int(current_level) + 1,
                        "id": child_id,
                        "parent": current_id,
                    }
                )
    return pd.DataFrame(results)


def _filter_id_columns(columns: list[str]) -> list[str]:
    """クラスタIDのカラム名をフィルタリングする

    Args:
        columns: 全カラム名のリスト

    Returns:
        クラスタIDのカラム名のリスト
    """
    return [col for col in columns if col.startswith("cluster-level-") and col.endswith("-id")]


def melt_cluster_data(df: pd.DataFrame) -> pd.DataFrame:
    """クラスタデータを行形式に変換する

    cluster-level-n-(id|label|description) を行形式 (level, id, label, description, value) にまとめる。
    [cluster-level-n-id, cluster-level-n-label, cluster-level-n-description] を [level, id, label, description, value(件数)] に変換する。

    Args:
        df: クラスタリング結果のDataFrame

    Returns:
        行形式に変換されたDataFrame
    """
    id_columns: list[str] = _filter_id_columns(df.columns)
    levels: set[int] = {int(col.replace("cluster-level-", "").replace("-id", "")) for col in id_columns}
    all_rows: list[dict] = []

    # levelごとに各クラスタの出現件数を集計・縦持ちにする
    for level in levels:
        cluster_columns = ClusterColumns.from_id_column(f"cluster-level-{level}-id")
        # クラスタidごとの件数集計
        level_count_df = df.groupby(cluster_columns.id).size().reset_index(name="value")

        level_unique_val_df = df[
            [cluster_columns.id, cluster_columns.label, cluster_columns.description]
        ].drop_duplicates()
        level_unique_val_df = level_unique_val_df.merge(level_count_df, on=cluster_columns.id, how="left")
        level_unique_vals = [
            {
                "level": level,
                "id": row[cluster_columns.id],
                "label": row[cluster_columns.label],
                "description": row[cluster_columns.description],
                "value": row["value"],
            }
            for _, row in level_unique_val_df.iterrows()
        ]
        all_rows.extend(level_unique_vals)
    return pd.DataFrame(all_rows)


def merge_labelling(clusters_df: pd.DataFrame, cluster_id_columns: list[str], config) -> pd.DataFrame:
    """階層的なクラスタのマージラベリングを実行する

    Args:
        clusters_df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含むDataFrame
    """
    for idx in tqdm(range(len(cluster_id_columns) - 1)):
        previous_columns = ClusterColumns.from_id_column(cluster_id_columns[idx])
        current_columns = ClusterColumns.from_id_column(cluster_id_columns[idx + 1])

        process_fn = partial(
            process_merge_labelling,
            result_df=clusters_df,
            current_columns=current_columns,
            previous_columns=previous_columns,
            config=config,
        )

        current_cluster_ids = sorted(clusters_df[current_columns.id].unique())
        with ThreadPoolExecutor(max_workers=config["hierarchical_merge_labelling"]["workers"]) as executor:
            responses = list(
                tqdm(
                    executor.map(process_fn, current_cluster_ids),
                    total=len(current_cluster_ids),
                )
            )

        current_result_df = pd.DataFrame(responses)
        clusters_df = clusters_df.merge(current_result_df, on=[current_columns.id])
    return clusters_df


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_merge_labelling(
    target_cluster_id: str,
    result_df: pd.DataFrame,
    current_columns: ClusterColumns,
    previous_columns: ClusterColumns,
    config,
):
    """個別のクラスタに対してマージラベリングを実行する

    Args:
        target_cluster_id: 処理対象のクラスタID
        result_df: クラスタリング結果のDataFrame
        current_columns: 現在のレベルのカラム情報
        previous_columns: 前のレベルのカラム情報
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含む辞書
    """

    def filter_previous_values(df: pd.DataFrame, previous_columns: ClusterColumns) -> list[ClusterValues]:
        """前のレベルのクラスタ情報を取得する"""
        previous_records = df[df[current_columns.id] == target_cluster_id][
            [previous_columns.label, previous_columns.description]
        ].drop_duplicates()
        previous_values = [
            ClusterValues(
                label=row[previous_columns.label],
                description=row[previous_columns.description],
            )
            for _, row in previous_records.iterrows()
        ]
        return previous_values

    previous_values = filter_previous_values(result_df, previous_columns)
    if len(previous_values) == 1:
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: previous_values[0].label,
            current_columns.description: previous_values[0].description,
        }
    elif len(previous_values) == 0:
        raise ValueError(f"クラスタ {target_cluster_id} には前のレベルのクラスタが存在しません。")

    current_cluster_data = result_df[result_df[current_columns.id] == target_cluster_id]
    sampling_num = min(
        config["hierarchical_merge_labelling"]["sampling_num"],
        len(current_cluster_data),
    )
    sampled_data = current_cluster_data.sample(sampling_num)
    sampled_argument_text = "\n".join(sampled_data["argument"].values)
    cluster_text = "\n".join([value.to_prompt_text() for value in previous_values])
    messages = [
        {"role": "system", "content": config["hierarchical_merge_labelling"]["prompt"]},
        {
            "role": "user",
            "content": "クラスタラベル\n" + cluster_text + "\n" + "クラスタの意見\n" + sampled_argument_text,
        },
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=config["hierarchical_merge_labelling"]["model"],
            json_schema=LabellingFromat,
            provider=config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )

        config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
        config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
        config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
        print(f"Merge labelling: input={token_input}, output={token_output}, total={token_total} tokens")

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: response_json.get("label", "エラーでラベル名が取得できませんでした"),
            current_columns.description: response_json.get("description", "エラーで解説が取得できませんでした"),
        }
    except Exception as e:
        print(f"エラーが発生しました: {e}")
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: "エラーでラベル名が取得できませんでした",
            current_columns.description: "エラーで解説が取得できませんでした",
        }


def calculate_cluster_density(melted_df: pd.DataFrame, config: dict):
    """クラスタ内の密度計算"""
    hierarchical_cluster_df = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_clusters.csv")

    densities = []
    for level, c_id in zip(melted_df["level"], melted_df["id"], strict=False):
        cluster_embeds = hierarchical_cluster_df[hierarchical_cluster_df[f"cluster-level-{level}-id"] == c_id][
            ["x", "y"]
        ].values
        density = calculate_density(cluster_embeds)
        densities.append(density)

    # 密度のランクを計算
    melted_df["density"] = densities
    melted_df["density_rank"] = melted_df.groupby("level")["density"].rank(ascending=False, method="first")
    melted_df["density_rank_percentile"] = melted_df.groupby("level")["density_rank"].transform(lambda x: x / len(x))
    return melted_df


def calculate_density(embeds: np.ndarray):
    """平均距離に基づいて密度を計算"""
    center = np.mean(embeds, axis=0)
    distances = np.linalg.norm(embeds - center, axis=1)
    avg_distance = np.mean(distances)
    density = 1 / (avg_distance + 1e-10)
    return density
29:Ta82,"""Create summaries for the clusters."""

import json
import os
import re

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class OverviewResponse(BaseModel):
    summary: str = Field(..., description="クラスターの全体的な要約")


def hierarchical_overview(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_overview.txt"

    hierarchical_label_df = pd.read_csv(f"outputs/{dataset}/hierarchical_merge_labels.csv")

    prompt = config["hierarchical_overview"]["prompt"]
    model = config["hierarchical_overview"]["model"]

    # TODO: level1で固定にしているが、設定で変えられるようにする
    target_level = 1
    target_records = hierarchical_label_df[hierarchical_label_df["level"] == target_level]
    ids = target_records["id"].to_list()
    labels = target_records["label"].to_list()
    descriptions = target_records["description"].to_list()
    target_records.set_index("id", inplace=True)

    input_text = ""
    for i, _ in enumerate(ids):
        input_text += f"# Cluster {i}/{len(ids)}: {labels[i]}\n\n"
        input_text += descriptions[i] + "\n\n"

    messages = [{"role": "system", "content": prompt}, {"role": "user", "content": input_text}]
    response_text, token_input, token_output, token_total = request_to_chat_ai(
        messages=messages,
        model=model,
        provider=config["provider"],
        local_llm_address=config.get("local_llm_address"),
        user_api_key=os.getenv("USER_API_KEY"),
        json_schema=OverviewResponse,
    )

    # トークン使用量を累積
    config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
    config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
    config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
    print(f"Hierarchical overview: input={token_input}, output={token_output}, total={token_total} tokens")

    try:
        # structured outputとしてパースできるなら処理する
        if isinstance(response_text, dict):
            parsed_response = response_text
        else:
            parsed_response = json.loads(response_text)

        with open(path, "w") as file:
            file.write(parsed_response["summary"])

    except Exception:
        # thinkタグが出力されるReasoningモデル用に、thinkタグを除去する
        thinking_removed = re.sub(
            r"<think\b[^>]*>.*?</think>",
            "",
            response_text,
            flags=re.DOTALL,
        )

        with open(path, "w") as file:
            file.write(thinking_removed)
2a:T3f38,"""Generate a convenient JSON output file."""

import json
from collections import defaultdict
from pathlib import Path
from typing import Any, TypedDict

import numpy as np
import pandas as pd

ROOT_DIR = Path(__file__).parent.parent.parent.parent
CONFIG_DIR = ROOT_DIR / "scatter" / "pipeline" / "configs"
PIPELINE_DIR = ROOT_DIR / "broadlistening" / "pipeline"


def json_serialize_numpy(obj: Any) -> Any:
    """
    Recursively convert NumPy data types to native Python types for JSON serialization.

    Args:
        obj: Any Python object which might contain NumPy data types

    Returns:
        The same object structure with NumPy types converted to Python native types
    """
    if isinstance(obj, np.integer):
        return int(obj)
    elif isinstance(obj, np.floating):
        return float(obj)
    elif isinstance(obj, np.ndarray):
        return obj.tolist()
    elif isinstance(obj, dict):
        return {k: json_serialize_numpy(v) for k, v in obj.items()}
    elif isinstance(obj, list):
        return [json_serialize_numpy(item) for item in obj]
    elif isinstance(obj, tuple):
        return tuple(json_serialize_numpy(item) for item in obj)
    else:
        return obj


class Argument(TypedDict):
    arg_id: str
    argument: str
    comment_id: str
    x: float
    y: float
    p: float
    cluster_ids: list[str]
    attributes: dict[str, str] | None
    url: str | None


class Cluster(TypedDict):
    level: int
    id: str
    label: str
    takeaway: str
    value: int
    parent: str
    density_rank_percentile: float | None


def hierarchical_aggregation(config) -> bool:
    try:
        path = f"outputs/{config['output_dir']}/hierarchical_result.json"
        results = {
            "arguments": [],
            "clusters": [],
            "comments": {},
            "propertyMap": {},
            "translations": {},
            "overview": "",
            "config": config,
        }

        arguments = pd.read_csv(f"outputs/{config['output_dir']}/args.csv")
        arguments.set_index("arg-id", inplace=True)
        arg_num = len(arguments)
        relation_df = pd.read_csv(f"outputs/{config['output_dir']}/relations.csv")
        comments = pd.read_csv(f"inputs/{config['input']}.csv")
        clusters = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_clusters.csv")
        labels = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_merge_labels.csv")

        hidden_properties_map: dict[str, list[str]] = config["hierarchical_aggregation"]["hidden_properties"]

        results["arguments"] = _build_arguments(clusters, comments, relation_df, config)
        results["clusters"] = _build_cluster_value(labels, arg_num)

        # results["comments"] = _build_comments_value(
        #     comments, arguments, hidden_properties_map
        # )
        results["comment_num"] = len(comments)
        results["translations"] = _build_translations(config)
        # 属性情報のカラムは、元データに対して指定したカラムとclassificationするカテゴリを合わせたもの
        results["propertyMap"] = _build_property_map(arguments, comments, hidden_properties_map, config)

        with open(f"outputs/{config['output_dir']}/hierarchical_overview.txt") as f:
            overview = f.read()
        print("overview")
        print(overview)
        results["overview"] = overview

        # Convert non-serializable NumPy types to native Python types
        results = json_serialize_numpy(results)

        with open(path, "w") as file:
            json.dump(results, file, indent=2, ensure_ascii=False)
        # TODO: サンプリングロジックを実装したいが、現状は全件抽出
        create_custom_intro(config)
        if config["is_pubcom"]:
            add_original_comments(labels, arguments, relation_df, clusters, config)
        return True
    except Exception as e:
        print("error")
        print(e)
        return False


def create_custom_intro(config):
    dataset = config["output_dir"]
    args_path = PIPELINE_DIR / f"outputs/{dataset}/args.csv"
    comments = pd.read_csv(PIPELINE_DIR / f"inputs/{config['input']}.csv")
    result_path = PIPELINE_DIR / f"outputs/{dataset}/hierarchical_result.json"

    input_count = len(comments)
    args_count = len(pd.read_csv(args_path))
    processed_num = min(input_count, config["extraction"]["limit"])

    print(f"Input count: {input_count}")
    print(f"Args count: {args_count}")

    # LLMプロバイダーとモデル名の判定
    def get_llm_provider_display():
        # configからプロバイダー情報を取得（優先）
        provider = config.get("provider", "openai")
        model = config.get("model", "unknown")

        # プロバイダー名をマッピング
        provider_names = {
            "openai": "OpenAI API",
            "azure": "Azure OpenAI API",
            "openrouter": "OpenRouter API",
            "local": "Local LLM",
        }

        provider_name = provider_names.get(provider, f"{provider} API")
        return f"{provider_name} ({model})"

    llm_provider = get_llm_provider_display()

    base_custom_intro = """{intro}
分析対象となったデータの件数は{processed_num}件で、これらのデータに対して{llm_provider}を用いて{args_count}件の意見（議論）を抽出し、クラスタリングを行った。
"""

    intro = config["intro"]
    custom_intro = base_custom_intro.format(
        intro=intro, processed_num=processed_num, args_count=args_count, llm_provider=llm_provider
    )

    with open(result_path) as f:
        result = json.load(f)
    result["config"]["intro"] = custom_intro
    with open(result_path, "w") as f:
        json.dump(result, f, indent=2, ensure_ascii=False)


def add_original_comments(labels, arguments, relation_df, clusters, config):
    # 大カテゴリ（cluster-level-1）に該当するラベルだけ抽出
    labels_lv1 = labels[labels["level"] == 1][["id", "label"]].rename(
        columns={"id": "cluster-level-1-id", "label": "category_label"}
    )

    # arguments と clusters をマージ（カテゴリ情報付与）
    merged = arguments.merge(clusters[["arg-id", "cluster-level-1-id"]], on="arg-id").merge(
        labels_lv1, on="cluster-level-1-id", how="left"
    )

    # relation_df と結合
    merged = merged.merge(relation_df, on="arg-id", how="left")

    # 元コメント取得
    comments = pd.read_csv(PIPELINE_DIR / f"inputs/{config['input']}.csv")
    comments["comment-id"] = comments["comment-id"].astype(str)
    merged["comment-id"] = merged["comment-id"].astype(str)

    # 元コメント本文などとマージ
    final_df = merged.merge(comments, on="comment-id", how="left")

    # 必要カラムのみ整形
    final_cols = ["comment-id", "comment-body", "arg-id", "argument", "cluster-level-1-id", "category_label"]

    # 基本カラム
    for col in ["x", "y", "source", "url"]:
        if col in comments.columns:
            final_cols.append(col)

    # 属性カラムを追加
    attribute_columns = []
    for col in comments.columns:
        # attributeプレフィックスが付いたカラムを探す
        if col.startswith("attribute_"):
            attribute_columns.append(col)
            final_cols.append(col)

    print(f"属性カラム検出: {attribute_columns}")

    # 必要なカラムだけ選択
    final_df = final_df[final_cols]
    final_df = final_df.rename(
        columns={
            "cluster-level-1-id": "category_id",
            "category_label": "category",
            "arg-id": "arg_id",
            "argument": "argument",
            "comment-body": "original-comment",
        }
    )

    # 保存
    final_df.to_csv(PIPELINE_DIR / f"outputs/{config['output_dir']}/final_result_with_comments.csv", index=False)


def _build_arguments(
    clusters: pd.DataFrame, comments: pd.DataFrame, relation_df: pd.DataFrame, config: dict
) -> list[Argument]:
    """
    Build the arguments list including attribute information from original comments

    Args:
        clusters: DataFrame containing cluster information for each argument
        comments: DataFrame containing original comments with attribute columns
        relation_df: DataFrame relating arguments to original comments
        config: Configuration dictionary containing enable_source_link setting
    """
    cluster_columns = [col for col in clusters.columns if col.startswith("cluster-level-") and "id" in col]

    # Prepare for merging with original comments to get attributes
    comments_copy = comments.copy()
    comments_copy["comment-id"] = comments_copy["comment-id"].astype(str)

    # Get argument to comment mapping
    arg_comment_map = {}
    if "comment-id" in relation_df.columns:
        relation_df["comment-id"] = relation_df["comment-id"].astype(str)
        arg_comment_map = dict(zip(relation_df["arg-id"], relation_df["comment-id"], strict=False))

    # Find attribute columns in comments dataframe
    attribute_columns = [col for col in comments.columns if col.startswith("attribute_")]
    print(f"属性カラム検出: {attribute_columns}")

    arguments: list[Argument] = []
    for _, row in clusters.iterrows():
        cluster_ids = ["0"]
        for cluster_column in cluster_columns:
            cluster_ids.append(str(row[cluster_column]))  # Convert to string to ensure serializable

        # Create base argument
        argument: Argument = {
            "arg_id": str(row["arg-id"]),  # Convert to string to ensure serializable
            "argument": str(row["argument"]),
            "x": float(row["x"]),  # Convert to native float
            "y": float(row["y"]),  # Convert to native float
            "p": 0,  # NOTE: 一旦全部0でいれる
            "cluster_ids": cluster_ids,
            "attributes": None,
            "url": None,
        }

        # Add attributes and URL if available
        if row["arg-id"] in arg_comment_map:
            comment_id = arg_comment_map[row["arg-id"]]
            comment_rows = comments_copy[comments_copy["comment-id"] == comment_id]

            if not comment_rows.empty:
                comment_row = comment_rows.iloc[0]

                # Add URL if available and enabled
                if config.get("enable_source_link", False) and "url" in comment_row and comment_row["url"] is not None:
                    argument["url"] = str(comment_row["url"])

                # Add attributes if available
                if attribute_columns:
                    attributes = {}
                    for attr_col in attribute_columns:
                        # Remove "attribute_" prefix for cleaner attribute names
                        attr_name = attr_col[len("attribute_") :]
                        # Convert potential numpy types to Python native types
                        attr_value = comment_row.get(attr_col, None)
                        if attr_value is not None:
                            if isinstance(attr_value, np.integer):
                                attr_value = int(attr_value)
                            elif isinstance(attr_value, np.floating):
                                attr_value = float(attr_value)
                            elif isinstance(attr_value, np.ndarray):
                                attr_value = attr_value.tolist()
                        attributes[attr_name] = attr_value

                    # Only add non-empty attributes
                    if any(v is not None for v in attributes.values()):
                        argument["attributes"] = attributes

        arguments.append(argument)
    return arguments


def _build_cluster_value(melted_labels: pd.DataFrame, total_num: int) -> list[Cluster]:
    results: list[Cluster] = [
        Cluster(
            level=0,
            id="0",
            label="全体",
            takeaway="",
            value=int(total_num),  # Convert to native int
            parent="",
            density_rank_percentile=0,
        )
    ]

    for _, melted_label in melted_labels.iterrows():
        # Convert potential NumPy types to native Python types
        level = (
            int(melted_label["level"]) if isinstance(melted_label["level"], int | np.integer) else melted_label["level"]
        )
        cluster_id = str(melted_label["id"])
        label = str(melted_label["label"])
        takeaway = str(melted_label["description"])
        value = (
            int(melted_label["value"]) if isinstance(melted_label["value"], int | np.integer) else melted_label["value"]
        )
        parent = str(melted_label.get("parent", "全体"))

        # Handle density_rank_percentile which might be None or a numeric value
        density_rank = melted_label.get("density_rank_percentile")
        if density_rank is not None:
            if isinstance(density_rank, float | np.floating):
                density_rank = float(density_rank)
            elif isinstance(density_rank, int | np.integer):
                density_rank = int(density_rank)

        cluster_value = Cluster(
            level=level,
            id=cluster_id,
            label=label,
            takeaway=takeaway,
            value=value,
            parent=parent,
            density_rank_percentile=density_rank,
        )
        results.append(cluster_value)
    return results


def _build_comments_value(
    comments: pd.DataFrame,
    arguments: pd.DataFrame,
    hidden_properties_map: dict[str, list[str]],
):
    comment_dict: dict[str, dict[str, str]] = {}
    useful_comment_ids = set(arguments["comment-id"].values)
    for _, row in comments.iterrows():
        id = row["comment-id"]
        if id in useful_comment_ids:
            res = {"comment": row["comment-body"]}
            should_skip = any(row[prop] in hidden_values for prop, hidden_values in hidden_properties_map.items())
            if should_skip:
                continue
            comment_dict[str(id)] = res

    return comment_dict


def _build_translations(config):
    languages = list(config.get("translation", {}).get("languages", []))
    if len(languages) > 0:
        with open(PIPELINE_DIR / f"outputs/{config['output_dir']}/translations.json") as f:
            translations = f.read()
        return json.loads(translations)
    return {}


def _build_property_map(
    arguments: pd.DataFrame, comments: pd.DataFrame, hidden_properties_map: dict[str, list[str]], config: dict
) -> dict[str, dict[str, str]]:
    property_columns = list(hidden_properties_map.keys()) + list(config["extraction"]["categories"].keys())
    property_map = defaultdict(dict)

    # 指定された property_columns が arguments に存在するかチェック
    missing_cols = [col for col in property_columns if col not in arguments.columns]
    if missing_cols:
        raise ValueError(
            f"指定されたカラム {missing_cols} が args.csv に存在しません。"
            "設定ファイルaggregation / hidden_propertiesから該当カラムを取り除いてください。"
        )

    for prop in property_columns:
        for arg_id, row in arguments.iterrows():
            # LLMによるcategory classificationがうまく行かず、NaNの場合はNoneにする
            value = row[prop] if not pd.isna(row[prop]) else None

            # Convert NumPy types to Python native types
            if value is not None:
                if isinstance(value, np.integer):
                    value = int(value)
                elif isinstance(value, np.floating):
                    value = float(value)
                elif isinstance(value, np.ndarray):
                    value = value.tolist()
                else:
                    # Convert any other types to string to ensure serialization
                    try:
                        value = str(value)
                    except Exception as e:
                        print(f"Error converting value to string: {e}")
                        value = None

            # Make sure arg_id is string
            str_arg_id = str(arg_id)
            property_map[prop][str_arg_id] = value

    return property_map
2b:T458,import os

import pandas as pd
from tqdm import tqdm

from services.llm import request_to_embed


def embedding(config):
    model = config["embedding"]["model"]
    is_embedded_at_local = config["is_embedded_at_local"]
    # print("start embedding")
    # print(f"embedding model: {model}, is_embedded_at_local: {is_embedded_at_local}")

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/embeddings.pkl"
    arguments = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings = []
    batch_size = 1000
    for i in tqdm(range(0, len(arguments), batch_size)):
        args = arguments["argument"].tolist()[i : i + batch_size]
        embeds = request_to_embed(
            args,
            model,
            is_embedded_at_local,
            config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )
        embeddings.extend(embeds)
    df = pd.DataFrame([{"arg-id": arguments.iloc[i]["arg-id"], "embedding": e} for i, e in enumerate(embeddings)])
    df.to_pickle(path)
2c:T194c,import concurrent.futures
import json
import logging
import os
import re

import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai
from services.parse_json_list import parse_extraction_response
from utils import update_progress

COMMA_AND_SPACE_AND_RIGHT_BRACKET = re.compile(r",\s*(\])")


class ExtractionResponse(BaseModel):
    extractedOpinionList: list[str] = Field(..., description="抽出した意見のリスト")


def _validate_property_columns(property_columns: list[str], comments: pd.DataFrame) -> None:
    if not all(property in comments.columns for property in property_columns):
        raise ValueError(f"Properties {property_columns} not found in comments. Columns are {comments.columns}")


def extraction(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/args.csv"
    model = config["extraction"]["model"]
    prompt = config["extraction"]["prompt"]
    workers = config["extraction"]["workers"]
    limit = config["extraction"]["limit"]
    property_columns = config["extraction"]["properties"]

    if "provider" not in config:
        raise RuntimeError("provider is not set")
    provider = config["provider"]

    # カラム名だけを読み込み、必要なカラムが含まれているか確認する
    comments = pd.read_csv(f"inputs/{config['input']}.csv", nrows=0)
    _validate_property_columns(property_columns, comments)
    # エラーが出なかった場合、すべての行を読み込む
    comments = pd.read_csv(
        f"inputs/{config['input']}.csv", usecols=["comment-id", "comment-body"] + config["extraction"]["properties"]
    )
    comment_ids = (comments["comment-id"].values)[:limit]
    comments.set_index("comment-id", inplace=True)
    results = pd.DataFrame()
    update_progress(config, total=len(comment_ids))

    argument_map = {}
    relation_rows = []

    for i in tqdm(range(0, len(comment_ids), workers)):
        batch = comment_ids[i : i + workers]
        batch_inputs = [comments.loc[id]["comment-body"] for id in batch]
        batch_results = extract_batch(
            batch_inputs, prompt, model, workers, provider, config.get("local_llm_address"), config
        )

        for comment_id, extracted_args in zip(batch, batch_results, strict=False):
            for j, arg in enumerate(extracted_args):
                if arg not in argument_map:
                    # argumentテーブルに追加
                    arg_id = f"A{comment_id}_{j}"
                    argument = arg
                    argument_map[arg] = {
                        "arg-id": arg_id,
                        "argument": argument,
                    }
                else:
                    arg_id = argument_map[arg]["arg-id"]

                # relationテーブルにcommentとargの関係を追加
                relation_row = {
                    "arg-id": arg_id,
                    "comment-id": comment_id,
                }
                relation_rows.append(relation_row)

        update_progress(config, incr=len(batch))

    # DataFrame化
    results = pd.DataFrame(argument_map.values())
    relation_df = pd.DataFrame(relation_rows)

    if results.empty:
        raise RuntimeError("result is empty, maybe bad prompt")

    results.to_csv(path, index=False)
    # comment-idとarg-idの関係を保存
    relation_df.to_csv(f"outputs/{dataset}/relations.csv", index=False)


logging.basicConfig(level=logging.DEBUG)


def extract_batch(batch, prompt, model, workers, provider="openai", local_llm_address=None, config=None):
    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:
        futures_with_index = [
            (i, executor.submit(extract_arguments, input, prompt, model, provider, local_llm_address))
            for i, input in enumerate(batch)
        ]

        done, not_done = concurrent.futures.wait([f for _, f in futures_with_index], timeout=30)
        results = [[] for _ in range(len(batch))]
        total_token_input = 0
        total_token_output = 0
        total_token_usage = 0

        for _, future in futures_with_index:
            if future in not_done and not future.cancelled():
                future.cancel()

        for i, future in futures_with_index:
            if future in done:
                try:
                    result = future.result()
                    if isinstance(result, tuple) and len(result) == 4:
                        items, token_input, token_output, token_total = result
                        results[i] = items
                        total_token_input += token_input
                        total_token_output += token_output
                        total_token_usage += token_total
                    else:
                        results[i] = result
                except Exception as e:
                    logging.error(f"Task {future} failed with error: {e}")
                    results[i] = []

        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + total_token_usage
            config["token_usage_input"] = config.get("token_usage_input", 0) + total_token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + total_token_output
            print(
                f"Extraction batch: input={total_token_input}, output={total_token_output}, total={total_token_usage} tokens"
            )

        return results


def extract_arguments(input, prompt, model, provider="openai", local_llm_address=None):
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            is_json=False,
            json_schema=ExtractionResponse,
            provider=provider,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )
        items = parse_extraction_response(response)
        items = list(filter(None, items))  # omit empty strings
        return items, token_input, token_output, token_total
    except json.decoder.JSONDecodeError as e:
        print("JSON error:", e)
        print("Input was:", input)
        print("Response was:", response)
        print("Silently giving up on trying to generate valid list.")
        return []
2d:T458,import os

import pandas as pd
from tqdm import tqdm

from services.llm import request_to_embed


def embedding(config):
    model = config["embedding"]["model"]
    is_embedded_at_local = config["is_embedded_at_local"]
    # print("start embedding")
    # print(f"embedding model: {model}, is_embedded_at_local: {is_embedded_at_local}")

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/embeddings.pkl"
    arguments = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings = []
    batch_size = 1000
    for i in tqdm(range(0, len(arguments), batch_size)):
        args = arguments["argument"].tolist()[i : i + batch_size]
        embeds = request_to_embed(
            args,
            model,
            is_embedded_at_local,
            config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )
        embeddings.extend(embeds)
    df = pd.DataFrame([{"arg-id": arguments.iloc[i]["arg-id"], "embedding": e} for i, e in enumerate(embeddings)])
    df.to_pickle(path)
2e:T1149,"""Cluster the arguments using UMAP + HDBSCAN and GPT-4."""

from importlib import import_module

import numpy as np
import pandas as pd
import scipy.cluster.hierarchy as sch
from sklearn.cluster import KMeans


def hierarchical_clustering(config):
    UMAP = import_module("umap").UMAP

    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_clusters.csv"
    arguments_df = pd.read_csv(f"outputs/{dataset}/args.csv", usecols=["arg-id", "argument"])
    embeddings_df = pd.read_pickle(f"outputs/{dataset}/embeddings.pkl")
    embeddings_array = np.asarray(embeddings_df["embedding"].values.tolist())
    cluster_nums = config["hierarchical_clustering"]["cluster_nums"]

    n_samples = embeddings_array.shape[0]
    # デフォルト設定は15
    default_n_neighbors = 15

    # テスト等サンプルが少なすぎる場合、n_neighborsの設定値を下げる
    if n_samples <= default_n_neighbors:
        n_neighbors = max(2, n_samples - 1)  # 最低2以上
    else:
        n_neighbors = default_n_neighbors

    umap_model = UMAP(random_state=42, n_components=2, n_neighbors=n_neighbors)
    # TODO 詳細エラーメッセージを加える
    # 以下のエラーの場合、おそらく元の意見件数が少なすぎることが原因
    # TypeError: Cannot use scipy.linalg.eigh for sparse A with k >= N. Use scipy.linalg.eigh(A.toarray()) or reduce k.
    umap_embeds = umap_model.fit_transform(embeddings_array)

    cluster_results = hierarchical_clustering_embeddings(
        umap_embeds=umap_embeds,
        cluster_nums=cluster_nums,
    )
    result_df = pd.DataFrame(
        {
            "arg-id": arguments_df["arg-id"],
            "argument": arguments_df["argument"],
            "x": umap_embeds[:, 0],
            "y": umap_embeds[:, 1],
        }
    )

    for cluster_level, final_labels in enumerate(cluster_results.values(), start=1):
        result_df[f"cluster-level-{cluster_level}-id"] = [f"{cluster_level}_{label}" for label in final_labels]

    result_df.to_csv(path, index=False)


def generate_cluster_count_list(min_clusters: int, max_clusters: int):
    cluster_counts = []
    current = min_clusters
    cluster_counts.append(current)

    if min_clusters == max_clusters:
        return cluster_counts

    while True:
        next_double = current * 2
        next_triple = current * 3

        if next_double >= max_clusters:
            if cluster_counts[-1] != max_clusters:
                cluster_counts.append(max_clusters)
            break

        # 次の倍はまだ max_clusters に収まるが、3倍だと超える
        # -> (次の倍は細かすぎるので)スキップして max_clusters に飛ぶ
        if next_triple > max_clusters:
            cluster_counts.append(max_clusters)
            break

        cluster_counts.append(next_double)
        current = next_double

    return cluster_counts


def merge_clusters_with_hierarchy(
    cluster_centers: np.ndarray,
    kmeans_labels: np.ndarray,
    umap_array: np.ndarray,
    n_cluster_cut: int,
):
    Z = sch.linkage(cluster_centers, method="ward")
    cluster_labels_merged = sch.fcluster(Z, t=n_cluster_cut, criterion="maxclust")

    n_samples = umap_array.shape[0]
    final_labels = np.zeros(n_samples, dtype=int)

    for i in range(n_samples):
        original_label = kmeans_labels[i]
        final_labels[i] = cluster_labels_merged[original_label]

    return final_labels


def hierarchical_clustering_embeddings(
    umap_embeds,
    cluster_nums,
):
    # 最大分割数でクラスタリングを実施
    print("start initial clustering")
    initial_cluster_num = cluster_nums[-1]
    kmeans_model = KMeans(n_clusters=initial_cluster_num, random_state=42)
    kmeans_model.fit(umap_embeds)
    print("end initial clustering")

    results = {}
    print("start hierarchical clustering")
    cluster_nums.sort()
    print(cluster_nums)
    for n_cluster_cut in cluster_nums[:-1]:
        print("n_cluster_cut: ", n_cluster_cut)
        final_labels = merge_clusters_with_hierarchy(
            cluster_centers=kmeans_model.cluster_centers_,
            kmeans_labels=kmeans_model.labels_,
            umap_array=umap_embeds,
            n_cluster_cut=n_cluster_cut,
        )
        results[n_cluster_cut] = final_labels

    results[initial_cluster_num] = kmeans_model.labels_
    print("end hierarchical clustering")

    return results
2f:T1c36,import json
import os
from concurrent.futures import ThreadPoolExecutor
from functools import partial
from typing import TypedDict

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class LabellingResult(TypedDict):
    """各クラスタのラベリング結果を表す型"""

    cluster_id: str  # クラスタのID
    label: str  # クラスタのラベル名
    description: str  # クラスタの説明文


def hierarchical_initial_labelling(config: dict) -> None:
    """階層的クラスタリングの初期ラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_initial_labelling: 初期ラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_initial_labels.csv"
    clusters_argument_df = pd.read_csv(f"outputs/{dataset}/hierarchical_clusters.csv")

    cluster_id_columns = [col for col in clusters_argument_df.columns if col.startswith("cluster-level-")]
    initial_cluster_id_column = cluster_id_columns[-1]
    sampling_num = config["hierarchical_initial_labelling"]["sampling_num"]
    initial_labelling_prompt = config["hierarchical_initial_labelling"]["prompt"]
    model = config["hierarchical_initial_labelling"]["model"]
    workers = config["hierarchical_initial_labelling"]["workers"]

    # トークン使用量を追跡するための変数を初期化
    config["total_token_usage"] = config.get("total_token_usage", 0)

    initial_label_df = initial_labelling(
        initial_labelling_prompt,
        clusters_argument_df,
        sampling_num,
        model,
        workers,
        config["provider"],
        config.get("local_llm_address"),
        config,  # configを渡して、トークン使用量を累積できるようにする
    )
    print("start initial labelling")
    initial_clusters_argument_df = clusters_argument_df.merge(
        initial_label_df,
        left_on=initial_cluster_id_column,
        right_on="cluster_id",
        how="left",
    ).rename(
        columns={
            "label": f"{initial_cluster_id_column.replace('-id', '')}-label",
            "description": f"{initial_cluster_id_column.replace('-id', '')}-description",
        }
    )
    print("end initial labelling")
    initial_clusters_argument_df.to_csv(path, index=False)


def initial_labelling(
    prompt: str,
    clusters_df: pd.DataFrame,
    sampling_num: int,
    model: str,
    workers: int,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> pd.DataFrame:
    """各クラスタに対して初期ラベリングを実行する

    Args:
        prompt: LLMへのプロンプト
        clusters_df: クラスタリング結果のDataFrame
        sampling_num: 各クラスタからサンプリングする意見の数
        model: 使用するLLMモデル名
        workers: 並列処理のワーカー数
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        各クラスタのラベリング結果を含むDataFrame
    """
    cluster_columns = [col for col in clusters_df.columns if col.startswith("cluster-level-")]
    initial_cluster_column = cluster_columns[-1]
    cluster_ids = clusters_df[initial_cluster_column].unique()
    process_func = partial(
        process_initial_labelling,
        df=clusters_df,
        prompt=prompt,
        sampling_num=sampling_num,
        target_column=initial_cluster_column,
        model=model,
        provider=provider,
        local_llm_address=local_llm_address,
        config=config,  # configを渡す
    )
    with ThreadPoolExecutor(max_workers=workers) as executor:
        results = list(executor.map(process_func, cluster_ids))
    return pd.DataFrame(results)


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_initial_labelling(
    cluster_id: str,
    df: pd.DataFrame,
    prompt: str,
    sampling_num: int,
    target_column: str,
    model: str,
    provider: str = "openai",
    local_llm_address: str | None = None,
    config: dict | None = None,  # configを追加
) -> LabellingResult:
    """個別のクラスタに対してラベリングを実行する

    Args:
        cluster_id: 処理対象のクラスタID
        df: クラスタリング結果のDataFrame
        prompt: LLMへのプロンプト
        sampling_num: サンプリングする意見の数
        target_column: クラスタIDが格納されている列名
        model: 使用するLLMモデル名
        provider: LLMプロバイダー
        local_llm_address: ローカルLLMのアドレス
        config: 設定情報を含む辞書（トークン使用量の累積に使用）

    Returns:
        クラスタのラベリング結果
    """
    cluster_data = df[df[target_column] == cluster_id]
    sampling_num = min(sampling_num, len(cluster_data))
    cluster = cluster_data.sample(sampling_num)
    input = "\n".join(cluster["argument"].values)
    messages = [
        {"role": "system", "content": prompt},
        {"role": "user", "content": input},
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=model,
            provider=provider,
            json_schema=LabellingFromat,
            local_llm_address=local_llm_address,
            user_api_key=os.getenv("USER_API_KEY"),
        )

        # トークン使用量を累積（configが渡されている場合）
        if config is not None:
            config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
            config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
            config["token_usage_output"] = config.get("token_usage_output", 0) + token_output

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return LabellingResult(
            cluster_id=cluster_id,
            label=response_json.get("label", "エラーでラベル名が取得できませんでした"),
            description=response_json.get("description", "エラーで解説が取得できませんでした"),
        )
    except Exception as e:
        print(e)
        return LabellingResult(
            cluster_id=cluster_id,
            label="エラーでラベル名が取得できませんでした",
            description="エラーで解説が取得できませんでした",
        )
30:T337b,import json
import os
from concurrent.futures import ThreadPoolExecutor
from dataclasses import dataclass
from functools import partial

import numpy as np
import pandas as pd
from pydantic import BaseModel, Field
from tqdm import tqdm

from services.llm import request_to_chat_ai


@dataclass
class ClusterColumns:
    """同一階層のクラスター関連のカラム名を管理するクラス"""

    id: str
    label: str
    description: str

    @classmethod
    def from_id_column(cls, id_column: str) -> "ClusterColumns":
        """ID列名から関連するカラム名を生成"""
        return cls(
            id=id_column,
            label=id_column.replace("-id", "-label"),
            description=id_column.replace("-id", "-description"),
        )


@dataclass
class ClusterValues:
    """対象クラスタのlabel/descriptionを管理するクラス"""

    label: str
    description: str

    def to_prompt_text(self) -> str:
        return f"- {self.label}: {self.description}"


def hierarchical_merge_labelling(config: dict) -> None:
    """階層的クラスタリングの結果に対してマージラベリングを実行する

    Args:
        config: 設定情報を含む辞書
            - output_dir: 出力ディレクトリ名
            - hierarchical_merge_labelling: マージラベリングの設定
                - sampling_num: サンプリング数
                - prompt: LLMへのプロンプト
                - model: 使用するLLMモデル名
                - workers: 並列処理のワーカー数
            - provider: LLMプロバイダー
    """
    dataset = config["output_dir"]
    merge_path = f"outputs/{dataset}/hierarchical_merge_labels.csv"
    clusters_df = pd.read_csv(f"outputs/{dataset}/hierarchical_initial_labels.csv")

    cluster_id_columns: list[str] = _filter_id_columns(clusters_df.columns)
    # ボトムクラスタのラベル・説明とクラスタid付きの各argumentを入力し、各階層のクラスタラベル・説明を生成し、argumentに付けたdfを作成
    merge_result_df = merge_labelling(
        clusters_df=clusters_df,
        cluster_id_columns=sorted(cluster_id_columns, reverse=True),
        config=config,
    )
    # 上記のdfから各クラスタのlevel, id, label, description, valueを取得してdfを作成
    melted_df = melt_cluster_data(merge_result_df)
    # 上記のdfに親子関係を追加
    parent_child_df = _build_parent_child_mapping(merge_result_df, cluster_id_columns)
    melted_df = melted_df.merge(parent_child_df, on=["level", "id"], how="left")
    density_df = calculate_cluster_density(melted_df, config)
    density_df.to_csv(merge_path, index=False)


def _build_parent_child_mapping(df: pd.DataFrame, cluster_id_columns: list[str]):
    """クラスタ間の親子関係をマッピングする

    Args:
        df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト

    Returns:
        親子関係のマッピング情報を含むDataFrame
    """
    results = []
    top_cluster_column = cluster_id_columns[0]
    top_cluster_values = df[top_cluster_column].unique()
    for c in top_cluster_values:
        results.append(
            {
                "level": 1,
                "id": c,
                "parent": "0",  # aggregationで追加する全体クラスタのid
            }
        )

    for idx in range(len(cluster_id_columns) - 1):
        current_column = cluster_id_columns[idx]
        children_column = cluster_id_columns[idx + 1]
        current_level = current_column.replace("-id", "").replace("cluster-level-", "")
        # 現在のレベルのクラスタid
        current_cluster_values = df[current_column].unique()
        for current_id in current_cluster_values:
            children_ids = df.loc[df[current_column] == current_id, children_column].unique()
            for child_id in children_ids:
                results.append(
                    {
                        "level": int(current_level) + 1,
                        "id": child_id,
                        "parent": current_id,
                    }
                )
    return pd.DataFrame(results)


def _filter_id_columns(columns: list[str]) -> list[str]:
    """クラスタIDのカラム名をフィルタリングする

    Args:
        columns: 全カラム名のリスト

    Returns:
        クラスタIDのカラム名のリスト
    """
    return [col for col in columns if col.startswith("cluster-level-") and col.endswith("-id")]


def melt_cluster_data(df: pd.DataFrame) -> pd.DataFrame:
    """クラスタデータを行形式に変換する

    cluster-level-n-(id|label|description) を行形式 (level, id, label, description, value) にまとめる。
    [cluster-level-n-id, cluster-level-n-label, cluster-level-n-description] を [level, id, label, description, value(件数)] に変換する。

    Args:
        df: クラスタリング結果のDataFrame

    Returns:
        行形式に変換されたDataFrame
    """
    id_columns: list[str] = _filter_id_columns(df.columns)
    levels: set[int] = {int(col.replace("cluster-level-", "").replace("-id", "")) for col in id_columns}
    all_rows: list[dict] = []

    # levelごとに各クラスタの出現件数を集計・縦持ちにする
    for level in levels:
        cluster_columns = ClusterColumns.from_id_column(f"cluster-level-{level}-id")
        # クラスタidごとの件数集計
        level_count_df = df.groupby(cluster_columns.id).size().reset_index(name="value")

        level_unique_val_df = df[
            [cluster_columns.id, cluster_columns.label, cluster_columns.description]
        ].drop_duplicates()
        level_unique_val_df = level_unique_val_df.merge(level_count_df, on=cluster_columns.id, how="left")
        level_unique_vals = [
            {
                "level": level,
                "id": row[cluster_columns.id],
                "label": row[cluster_columns.label],
                "description": row[cluster_columns.description],
                "value": row["value"],
            }
            for _, row in level_unique_val_df.iterrows()
        ]
        all_rows.extend(level_unique_vals)
    return pd.DataFrame(all_rows)


def merge_labelling(clusters_df: pd.DataFrame, cluster_id_columns: list[str], config) -> pd.DataFrame:
    """階層的なクラスタのマージラベリングを実行する

    Args:
        clusters_df: クラスタリング結果のDataFrame
        cluster_id_columns: クラスタIDのカラム名のリスト
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含むDataFrame
    """
    for idx in tqdm(range(len(cluster_id_columns) - 1)):
        previous_columns = ClusterColumns.from_id_column(cluster_id_columns[idx])
        current_columns = ClusterColumns.from_id_column(cluster_id_columns[idx + 1])

        process_fn = partial(
            process_merge_labelling,
            result_df=clusters_df,
            current_columns=current_columns,
            previous_columns=previous_columns,
            config=config,
        )

        current_cluster_ids = sorted(clusters_df[current_columns.id].unique())
        with ThreadPoolExecutor(max_workers=config["hierarchical_merge_labelling"]["workers"]) as executor:
            responses = list(
                tqdm(
                    executor.map(process_fn, current_cluster_ids),
                    total=len(current_cluster_ids),
                )
            )

        current_result_df = pd.DataFrame(responses)
        clusters_df = clusters_df.merge(current_result_df, on=[current_columns.id])
    return clusters_df


class LabellingFromat(BaseModel):
    """ラベリング結果のフォーマットを定義する"""

    label: str = Field(..., description="クラスタのラベル名")
    description: str = Field(..., description="クラスタの説明文")


def process_merge_labelling(
    target_cluster_id: str,
    result_df: pd.DataFrame,
    current_columns: ClusterColumns,
    previous_columns: ClusterColumns,
    config,
):
    """個別のクラスタに対してマージラベリングを実行する

    Args:
        target_cluster_id: 処理対象のクラスタID
        result_df: クラスタリング結果のDataFrame
        current_columns: 現在のレベルのカラム情報
        previous_columns: 前のレベルのカラム情報
        config: 設定情報を含む辞書

    Returns:
        マージラベリング結果を含む辞書
    """

    def filter_previous_values(df: pd.DataFrame, previous_columns: ClusterColumns) -> list[ClusterValues]:
        """前のレベルのクラスタ情報を取得する"""
        previous_records = df[df[current_columns.id] == target_cluster_id][
            [previous_columns.label, previous_columns.description]
        ].drop_duplicates()
        previous_values = [
            ClusterValues(
                label=row[previous_columns.label],
                description=row[previous_columns.description],
            )
            for _, row in previous_records.iterrows()
        ]
        return previous_values

    previous_values = filter_previous_values(result_df, previous_columns)
    if len(previous_values) == 1:
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: previous_values[0].label,
            current_columns.description: previous_values[0].description,
        }
    elif len(previous_values) == 0:
        raise ValueError(f"クラスタ {target_cluster_id} には前のレベルのクラスタが存在しません。")

    current_cluster_data = result_df[result_df[current_columns.id] == target_cluster_id]
    sampling_num = min(
        config["hierarchical_merge_labelling"]["sampling_num"],
        len(current_cluster_data),
    )
    sampled_data = current_cluster_data.sample(sampling_num)
    sampled_argument_text = "\n".join(sampled_data["argument"].values)
    cluster_text = "\n".join([value.to_prompt_text() for value in previous_values])
    messages = [
        {"role": "system", "content": config["hierarchical_merge_labelling"]["prompt"]},
        {
            "role": "user",
            "content": "クラスタラベル\n" + cluster_text + "\n" + "クラスタの意見\n" + sampled_argument_text,
        },
    ]
    try:
        response_text, token_input, token_output, token_total = request_to_chat_ai(
            messages=messages,
            model=config["hierarchical_merge_labelling"]["model"],
            json_schema=LabellingFromat,
            provider=config["provider"],
            local_llm_address=config.get("local_llm_address"),
            user_api_key=os.getenv("USER_API_KEY"),
        )

        config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
        config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
        config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
        print(f"Merge labelling: input={token_input}, output={token_output}, total={token_total} tokens")

        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: response_json.get("label", "エラーでラベル名が取得できませんでした"),
            current_columns.description: response_json.get("description", "エラーで解説が取得できませんでした"),
        }
    except Exception as e:
        print(f"エラーが発生しました: {e}")
        return {
            current_columns.id: target_cluster_id,
            current_columns.label: "エラーでラベル名が取得できませんでした",
            current_columns.description: "エラーで解説が取得できませんでした",
        }


def calculate_cluster_density(melted_df: pd.DataFrame, config: dict):
    """クラスタ内の密度計算"""
    hierarchical_cluster_df = pd.read_csv(f"outputs/{config['output_dir']}/hierarchical_clusters.csv")

    densities = []
    for level, c_id in zip(melted_df["level"], melted_df["id"], strict=False):
        cluster_embeds = hierarchical_cluster_df[hierarchical_cluster_df[f"cluster-level-{level}-id"] == c_id][
            ["x", "y"]
        ].values
        density = calculate_density(cluster_embeds)
        densities.append(density)

    # 密度のランクを計算
    melted_df["density"] = densities
    melted_df["density_rank"] = melted_df.groupby("level")["density"].rank(ascending=False, method="first")
    melted_df["density_rank_percentile"] = melted_df.groupby("level")["density_rank"].transform(lambda x: x / len(x))
    return melted_df


def calculate_density(embeds: np.ndarray):
    """平均距離に基づいて密度を計算"""
    center = np.mean(embeds, axis=0)
    distances = np.linalg.norm(embeds - center, axis=1)
    avg_distance = np.mean(distances)
    density = 1 / (avg_distance + 1e-10)
    return density
31:Ta82,"""Create summaries for the clusters."""

import json
import os
import re

import pandas as pd
from pydantic import BaseModel, Field

from services.llm import request_to_chat_ai


class OverviewResponse(BaseModel):
    summary: str = Field(..., description="クラスターの全体的な要約")


def hierarchical_overview(config):
    dataset = config["output_dir"]
    path = f"outputs/{dataset}/hierarchical_overview.txt"

    hierarchical_label_df = pd.read_csv(f"outputs/{dataset}/hierarchical_merge_labels.csv")

    prompt = config["hierarchical_overview"]["prompt"]
    model = config["hierarchical_overview"]["model"]

    # TODO: level1で固定にしているが、設定で変えられるようにする
    target_level = 1
    target_records = hierarchical_label_df[hierarchical_label_df["level"] == target_level]
    ids = target_records["id"].to_list()
    labels = target_records["label"].to_list()
    descriptions = target_records["description"].to_list()
    target_records.set_index("id", inplace=True)

    input_text = ""
    for i, _ in enumerate(ids):
        input_text += f"# Cluster {i}/{len(ids)}: {labels[i]}\n\n"
        input_text += descriptions[i] + "\n\n"

    messages = [{"role": "system", "content": prompt}, {"role": "user", "content": input_text}]
    response_text, token_input, token_output, token_total = request_to_chat_ai(
        messages=messages,
        model=model,
        provider=config["provider"],
        local_llm_address=config.get("local_llm_address"),
        user_api_key=os.getenv("USER_API_KEY"),
        json_schema=OverviewResponse,
    )

    # トークン使用量を累積
    config["total_token_usage"] = config.get("total_token_usage", 0) + token_total
    config["token_usage_input"] = config.get("token_usage_input", 0) + token_input
    config["token_usage_output"] = config.get("token_usage_output", 0) + token_output
    print(f"Hierarchical overview: input={token_input}, output={token_output}, total={token_total} tokens")

    try:
        # structured outputとしてパースできるなら処理する
        if isinstance(response_text, dict):
            parsed_response = response_text
        else:
            parsed_response = json.loads(response_text)

        with open(path, "w") as file:
            file.write(parsed_response["summary"])

    except Exception:
        # thinkタグが出力されるReasoningモデル用に、thinkタグを除去する
        thinking_removed = re.sub(
            r"<think\b[^>]*>.*?</think>",
            "",
            response_text,
            flags=re.DOTALL,
        )

        with open(path, "w") as file:
            file.write(thinking_removed)
8:[["$","$L11",null,{}],["$","$L12",null,{"className":"container","mt":"8","children":[["$","$L12",null,{"mx":"auto","maxW":"750px","mb":8,"children":[["$","$L13",null,{"textAlign":"left","fontSize":"xl","mb":5,"children":"レポート"}],["$","$L13",null,{"as":"h2","size":"4xl","mb":2,"className":"headingColor","children":"しながわ防災区民憲章の策定に向けて寄せられた意見"}],["$","$L14",null,{"fontWeight":"bold","fontSize":"xl","mb":2,"children":[["$","$L15",null,{"mr":1,"children":["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":20,"height":20,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-messages-square","children":[["$","path","p1xzt8",{"d":"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"}],["$","path","1cx29u",{"d":"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"}],"$undefined"]}]}],"748","件"]}],["$","p",null,{"children":"品川区では、地域特性を活かした防災対策が進められており、地域コミュニティの強化と住民の防災意識向上が重視されています。町会やマンション理事会を通じた活動や、行政との協力によるイベントの開催、SNSを活用した情報共有が行われています。また、備蓄管理や防災教育の推進、多様なメディアを活用した知識普及が進められ、地域全体での迅速な災害対応力の向上が期待されています。これにより、住民同士の信頼関係が深まり、安心して暮らせる環境が整備されています。"}]]}],["$","$L16",null,{"result":{"arguments":[{"arg_id":"Acsv-1_0","argument":"緊急時に身を守るためには、備えることがとても大切だと思います","x":5.893133,"y":-0.4061367,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"外国人参加者の声","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-2_0","argument":"東京での災害時の手順について多くを学ぶことが重要です。","x":3.9137456,"y":-0.32504132,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"外国人参加者の声","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-3_0","argument":"講座を通じて地震の備えを学ぶことができる","x":3.860149,"y":-0.39932632,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"外国人参加者の声","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-4_0","argument":"携帯トイレの使い方に関する情報は具体的で役に立つ","x":6.42932,"y":-3.159951,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"外国人参加者の声","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-5_0","argument":"地震があった時に具体的な行動を学ぶことが重要です","x":4.0512776,"y":-0.48052868,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"外国人参加者の声","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-6_0","argument":"外国の方も防災リュックを日頃から用意していることを知るべき","x":5.44994,"y":-1.8409101,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-7_0","argument":"トイレ・水・食料の備蓄をしている人が少ないため、町会としての啓発が必要だと感じる","x":7.016364,"y":-3.1155155,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-8_0","argument":"スマホ翻訳ツールの使い込みや習熟が必要だと自覚した","x":1.8924179,"y":1.7835197,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-8_1","argument":"避難所用ツールの整備が必要だと自覚した","x":6.632213,"y":-0.30332083,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-9_0","argument":"これまでに再確認してよかったことも多々あった","x":7.3106823,"y":-0.12665842,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-10_0","argument":"外国人として地域の皆さんともっとコミュニケーションをうまく取りたい","x":3.8610053,"y":2.5298946,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"外国人参加者の声","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-11_0","argument":"地元の町会の方々と交流し、その意見を聞くことができて良かった","x":3.5402305,"y":3.5851617,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"外国人参加者の声","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-12_0","argument":"言葉を知らない外国人も、安全のための知識を学ぶことができることは助かる","x":2.085098,"y":1.5789392,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"外国人参加者の声","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-13_0","argument":"自宅にいる場合、外部と連絡を取る方法を考えるべき","x":6.015118,"y":1.4273933,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"外国人参加者の声","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-14_0","argument":"食べ物や水が必要になったら、助けを求める場所を知っておくべき","x":7.613737,"y":-2.6743774,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"外国人参加者の声","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-15_0","argument":"いろいろな国の方に分かりやすく伝える方法を考えるべき","x":2.230128,"y":1.8086034,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-16_0","argument":"避難所での外国人とのコミュニケーションについて、町会として取り組むべき時が来ていると感じる","x":3.936938,"y":1.9317299,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-17_0","argument":"外国人と連携が必要であり、彼らもそれを望んでいることが分かった","x":3.9265406,"y":2.3362253,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-18_0","argument":"有意義な研修で、私たちが知っていることを教え、彼らが困っていることを知ることができた","x":2.011612,"y":1.4029316,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-19_0","argument":"避難所に外国人を受け入れることは可能だが、普段からのコミュニケーションが大切である","x":4.018283,"y":2.0740097,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-20_0","argument":"外国の方々も『顔を売る』工夫をすべき","x":3.8619409,"y":2.5188134,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-21_0","argument":"意見交換の際、伝えるアプリを使うと意見を引き出しやすいと感じた","x":2.4175143,"y":2.7233722,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-22_0","argument":"災害時に伝えやすいやさしい日本語・やさしい英語が学べる機会を提供すべき","x":2.2108996,"y":1.5125705,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-23_0","argument":"避難経路を家族と共有し、確認すべき","x":6.4112287,"y":0.14977375,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-24_0","argument":"自分に合った避難方法を考えるべき","x":6.214914,"y":0.0014173171,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-25_0","argument":"自分の知識を深めることは重要である","x":1.9261311,"y":1.1950874,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-26_0","argument":"学んだことを共有すべき","x":1.6982992,"y":1.2150197,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-27_0","argument":"ガールスカウトで防災センターに行くことは、防災意識を高めるために有益である","x":3.031458,"y":-0.83158016,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-28_0","argument":"けがの応急手当を学ぶべき","x":2.1542835,"y":-0.23680007,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-29_0","argument":"地域の防災訓練に参加すべき","x":2.2957053,"y":-0.6506568,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-30_0","argument":"祖父、祖母とこまめに連絡をとるべき","x":5.9218135,"y":1.361669,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-31_0","argument":"ごはん作りを手伝うべき","x":7.0687156,"y":-3.002239,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-32_0","argument":"171（いない）を知っていても、公衆電話の場所がわからないと意味がない","x":6.025819,"y":1.7636427,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-33_0","argument":"地図やハザードマップを事前に確認しておくべき","x":7.0350046,"y":-0.11938077,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-34_0","argument":"家具の転落防止対策を強化するために買い換えることは重要です","x":5.3464417,"y":-3.0431569,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-35_0","argument":"保存食を買って家に備えておくべき","x":7.0280867,"y":-2.8323948,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-36_0","argument":"水を十分に備蓄している","x":7.895768,"y":-2.4361277,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-37_0","argument":"中学生の頃から防災用品を持ち歩くことは重要である","x":5.46282,"y":-1.6687698,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-38_0","argument":"応急手当のやり方を身につけておくべき","x":5.986028,"y":-1.2757537,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-39_0","argument":"絆創膏や包帯などの医療品を備蓄すべき（けがを覆うことで安心感が得られるため）","x":7.2167354,"y":-2.4948597,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-40_0","argument":"衣類や毛布の備蓄と洗濯は、ほこりやダニによるアレルギーやアトピーを防ぐために重要である","x":7.4759927,"y":-2.5625753,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-41_0","argument":"防災リュックを準備するべき","x":5.594517,"y":-1.8596781,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-42_0","argument":"モバイルバッテリーを持っておくべき","x":7.137561,"y":-2.0989325,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-43_0","argument":"毎年防災訓練には参加すべき","x":1.9489222,"y":-0.7677433,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-44_0","argument":"地域の高齢者への訪問を行うべき","x":4.585693,"y":2.1403568,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-45_0","argument":"日頃から地域の方たちとコミュニケーションをとるべき","x":4.1998825,"y":3.1588013,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-46_0","argument":"自助としてホッカイロをたくさん持っていることは有効である","x":5.8726864,"y":-2.344688,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-47_0","argument":"Wi-fiがないと困る","x":5.9937654,"y":1.6875601,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-48_0","argument":"持ち歩くべきかどうかについての意見は特に示されていません。","x":5.641596,"y":1.6533768,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-49_0","argument":"高いところに物を置きすぎないようにするべき","x":5.6007767,"y":-2.7758734,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-50_0","argument":"家具を固定しておくべき","x":5.4515324,"y":-2.983691,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-51_0","argument":"近所をいっぱい散歩することは健康に良い","x":5.095101,"y":3.336125,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-52_0","argument":"近所の人に会ったら挨拶するべき","x":4.7858086,"y":3.7934377,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-53_0","argument":"近所の方とお話しすることは、地域の防災意識を高めるために重要です。","x":3.8416626,"y":1.0225625,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-54_0","argument":"シャンプー、リンスがないと髪の健康を保つのが難しい","x":7.691288,"y":-2.4231644,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-55_0","argument":"早めに避難しておくべき","x":6.6731114,"y":-0.14260954,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-56_0","argument":"近所の人に声がけしてみんなで避難すべき","x":6.3128753,"y":0.28140762,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-57_0","argument":"小さい子と遊んであげることは重要です。","x":2.384105,"y":1.4318633,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-58_0","argument":"余分にタオルがあれば持っていくべき","x":6.1430507,"y":-2.813857,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-59_0","argument":"隣人や向かいの人の家庭事情について知っておくべき","x":5.017722,"y":2.8690693,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-60_0","argument":"近所づきあいを大切にすべき","x":5.506384,"y":3.4379933,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-61_0","argument":"日頃から近所の人とあいさつをして顔見知りになることで、何かあった時に誰かわかるようにすべき","x":4.708208,"y":3.2272964,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-62_0","argument":"近所の人と日頃から仲良くしておくべき","x":5.2027698,"y":3.4425735,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-63_0","argument":"近所の人に普段からあいさつするべき","x":4.9847383,"y":3.724602,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-64_0","argument":"共助のためにおばあちゃんとできるだけ近くに住むべき","x":5.779719,"y":2.838637,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-65_0","argument":"家族で災害時の対応について事前に話し合っておくべき","x":5.37041,"y":0.62181556,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"品川女子学院","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-66_0","argument":"避難器具がある場合は、その使い方を確認すべき","x":6.904991,"y":-0.27375886,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-67_0","argument":"人間の食べ物だけでなく、ペット（犬）の非常食も備えるべき","x":7.0928802,"y":-2.8677645,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-68_0","argument":"最近かんに入っているパンを初めて食べて美味しかった","x":7.2236624,"y":-3.053588,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-69_0","argument":"大きい文字で書くべき","x":1.2822591,"y":1.485604,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-70_0","argument":"印象的なキャッチコピーを作るべき","x":1.2294935,"y":1.5951762,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-71_0","argument":"むずかしすぎる言葉を使わずに、誰でも分かるようにすべき","x":1.5679758,"y":1.5199627,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-72_0","argument":"トイレのドアのところに防災情報を貼っておくべき","x":5.0789523,"y":-2.325473,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-73_0","argument":"電車ドアの窓部分にはる","x":4.9917316,"y":-2.4905927,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-74_0","argument":"行列の並び初めの辺りに見やすいポスターを作成して貼るべき","x":1.1817539,"y":1.6429983,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-75_0","argument":"非常食と一緒に配布することで、受け取った人が読む可能性が高まる","x":7.0765886,"y":-3.2000005,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-76_0","argument":"帽子のつばに関する意見が不明確であるため、具体的な意見を抽出できない。","x":5.672646,"y":1.6720451,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-77_0","argument":"教室に教訓を飾るべき","x":1.6964465,"y":0.25650403,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-78_0","argument":"防災教育をカルタやゲーム感覚にすることで、子供たちが楽しく学べるようにすべき","x":2.242238,"y":0.6019574,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-79_0","argument":"アニメのような親しみやすい形式で内容を伝え、CMで放送すべき","x":2.0796607,"y":2.3494806,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-80_0","argument":"学びをゲーム化して楽しめるようにすべき","x":1.6782991,"y":0.82231545,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-81_0","argument":"体育館で体験授業を行うべき","x":1.97043,"y":0.0877036,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-82_0","argument":"自助共助公助の概念を広めるためにイメージキャラクターを活用すべき","x":5.2662873,"y":2.1538892,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-83_0","argument":"地域イベントを開催し、参加者に特典を提供することで参加を促進すべき","x":3.172892,"y":2.4751503,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-84_0","argument":"学校（小・中・高）の授業で防災教育を取り入れるべき","x":2.0918398,"y":0.39755243,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-85_0","argument":"有名な歌手に災害のファイトソングを作ってもらい、そのミュージックビデオのリンクに防災憲章を貼るべき","x":3.2795022,"y":0.5756048,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-86_0","argument":"イコラブ、フルーツジッパー、サンリオ、K-POPアイドル、たまごっちに関する意見は特に記載されていないため、意見を抽出できません。","x":5.668081,"y":1.6751995,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-87_0","argument":"インスタかTikTokかTwitterがSNSの中で良いと思う","x":1.3254315,"y":2.7667224,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-88_0","argument":"SNSは災害時の情報共有に役立つが、誤情報の拡散に注意が必要","x":2.99617,"y":1.4161286,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-89_0","argument":"短めな動画（ショート動画)で情報を伝えるべき","x":2.0059838,"y":2.456138,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-90_0","argument":"シュールな動画は視聴者に新しい視点や考え方を提供することができる。","x":2.0695615,"y":2.4337401,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-91_0","argument":"YoutubeのCMは視聴者にとって煩わしいと感じることがある","x":1.9690582,"y":2.4425054,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-92_0","argument":"歌にのせる","x":0.7639397,"y":0.9762971,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-93_0","argument":"曲にする","x":0.8169804,"y":0.9600348,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-94_0","argument":"ラップや音楽を活用して防災意識を高めるために、街で流すべき","x":3.208992,"y":0.66702384,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-95_0","argument":"TikTokにおどりをつけて投稿することが流行している","x":1.3402189,"y":2.6397877,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-96_0","argument":"文字だけでは不十分である","x":1.3309187,"y":1.4977314,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-97_0","argument":"5・7・5・7・7か、5・7・5のリズムにするべき","x":0.8535358,"y":0.75020546,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-98_0","argument":"書道は日本の伝統文化として重要であり、地域の文化活動として推進すべき","x":3.8468149,"y":2.7911403,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-99_0","argument":"回覧板にチラシを挟むべき","x":1.0375986,"y":1.5071083,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-100_0","argument":"スーパーの袋詰めするところの壁に防災に関する情報を貼るべき","x":5.1560745,"y":-1.9667404,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-101_0","argument":"カレンダーを日替わり形式で配布し、1文ずつ書いてあるものにするべき","x":1.0220622,"y":1.4518709,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-102_0","argument":"ティッシュの紙に書いて配布すべき","x":1.0271142,"y":1.50571,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-103_0","argument":"冷蔵庫に貼れるようにすることで、重要な情報をよく見ることができる","x":6.6785765,"y":-2.3685317,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-104_0","argument":"持ち歩けるカードサイズの防災グッズがあると便利","x":5.252183,"y":-1.8665203,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-105_0","argument":"憲章の内容の一部を名前にした食べ物をカフェで売るべき","x":6.973,"y":-2.7656128,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-106_0","argument":"日用品に防災グッズの情報を印刷するべき","x":5.0779834,"y":-1.889403,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-107_0","argument":"公式LINEを活用すべき","x":1.6741972,"y":2.874441,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-108_0","argument":"町の掲示板の文字を大きくすべき","x":1.2001332,"y":1.565731,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-109_0","argument":"地域の掲示板には、災害時の避難場所や連絡先情報を掲示するべき","x":2.9438317,"y":1.4546528,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-110_0","argument":"目を引くようなポスターを作るべき","x":1.212205,"y":1.7276293,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-111_0","argument":"電車内の広告は、乗客にとって情報提供の手段として有用である","x":2.1115353,"y":2.2825537,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-112_0","argument":"品川区は防災対策を強化し、住民の安全を確保すべき","x":3.9717858,"y":0.19713823,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-113_0","argument":"地域の神社やお寺などにも情報を載せてもらうべき","x":3.177735,"y":1.8491434,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-114_0","argument":"イラストは情報を視覚的に伝える手段として有効であるため、イラスト付きの資料を作成すべき","x":2.2296705,"y":2.3276196,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-115_0","argument":"ショート動画は情報を短時間で伝えることができるため、視聴者の注意を引きやすい。","x":1.9844514,"y":2.4757574,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-115_1","argument":"ショート動画は視聴者の興味を引くために効果的な手段である。","x":1.9570479,"y":2.4796145,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-116_0","argument":"ソーシャルメディアを活用すべき","x":1.4192837,"y":2.7243135,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-117_0","argument":"小学校で九九や百人一首とともに暗唱を取り入れるべき","x":0.8518515,"y":0.8736538,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-118_0","argument":"一言でスローガンのようなものをつくるべき","x":0.95944095,"y":1.19156,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-119_0","argument":"覚えやすいフレーズを作る際には、頭文字を使った工夫が有効である","x":1.3066378,"y":1.4149837,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-120_0","argument":"小さい子にはわかりやすく説明すべき","x":2.278415,"y":1.4708585,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-121_0","argument":"なぞときイベントを用意し、最後に懸賞を出すべき","x":2.9809828,"y":2.5132992,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-122_0","argument":"オリジナルかるたを作成し、大会を開催すべき","x":2.9493306,"y":2.566211,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-123_0","argument":"穴うめクイズや絵早押しクイズの大会を開催すべき","x":3.0094397,"y":2.5613506,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-124_0","argument":"憲章に合う絵を募集し、発表すべき","x":0.78947866,"y":2.3033714,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-125_0","argument":"誰が感情こめて読めるか選手権を開催すべき","x":5.2972627,"y":3.4653587,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"品川女子学院","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-126_0","argument":"災害が発生した時の行動を家族で共有すべき","x":5.4511843,"y":0.50981593,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-127_0","argument":"災害時に家族が一緒にいるとは限らないため、事前に行動を共有しておくことが重要","x":5.5561843,"y":0.49779996,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-128_0","argument":"食品や日用雑貨、常備薬のローリングストックは病気のときにも役に立つ","x":7.3431597,"y":-2.461557,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-129_0","argument":"安否確認の方法をトライアル期間に家族で試すべき","x":6.4497313,"y":0.12220431,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-130_0","argument":"日頃の生活から最悪のケースを想定して行動すべき","x":5.871215,"y":0.24078447,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-130_1","argument":"最近の暑さにより夏の災害が不安である","x":5.1672997,"y":0.5340285,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-131_0","argument":"家庭内での備蓄や、自宅近くの避難所の確認と避難所までの経路の把握を行うべき","x":6.4815483,"y":-0.18063854,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-132_0","argument":"被災地で起きたことに関心を持つことで、災害時に直面することをイメージでき、備えにつながる。","x":4.891629,"y":0.15732935,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"しなトーク","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-133_0","argument":"防災バックを作って備蓄することは重要である","x":5.6294246,"y":-1.8312912,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-134_0","argument":"水などの備蓄は重要である","x":7.8220167,"y":-2.3739338,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-135_0","argument":"水を常備すべき","x":8.084229,"y":-2.3113725,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-136_0","argument":"非常トイレ、非常食、ライトの用意をすべき","x":6.899781,"y":-3.172788,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-136_1","argument":"大雨の備えをどうするか悩んでいる","x":5.5947995,"y":-0.65725833,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-137_0","argument":"家具の転倒防止対策を行うべき","x":5.3482924,"y":-3.0189753,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-137_1","argument":"出前防災訓練に参加すべき","x":2.064463,"y":-0.9384828,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-138_0","argument":"災害時に備えてお水と食品と小銭を用意しておくべき","x":6.212269,"y":-1.7109165,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-139_0","argument":"防災に関して特に意識していない","x":4.513663,"y":-0.2155995,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-139_1","argument":"防災用品を自分ですべて用意するのは難しい","x":5.459121,"y":-2.0187309,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-140_0","argument":"防災訓練に参加することは重要である","x":2.0238485,"y":-0.7799815,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-140_1","argument":"携帯トイレを持っていることは災害時に役立つ","x":6.172688,"y":-2.9456353,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-141_0","argument":"水や食料の備蓄は重要である","x":7.70161,"y":-2.676374,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-142_0","argument":"地震対策として水の保管が重要である","x":7.2771745,"y":-1.9043733,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-143_0","argument":"水の備蓄は重要である","x":7.832957,"y":-2.479335,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-144_0","argument":"1週間分の備蓄を行うべき","x":7.080358,"y":-2.2958043,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-144_1","argument":"町会の訓練に参加すべき","x":2.4573717,"y":-0.40432066,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-145_0","argument":"水などの備蓄を行っている","x":7.8510227,"y":-2.3928313,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-146_0","argument":"水の備蓄をすべき","x":7.889291,"y":-2.3325925,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-147_0","argument":"避難場所の把握、家具類の転倒防止、非常食・非常電源の確保が重要である","x":6.5370126,"y":-0.6802216,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-147_1","argument":"地震時に転倒防止措置をしていたため、棚が倒れなかったことから、転倒防止措置は有効である","x":5.1924996,"y":-2.830333,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-147_2","argument":"落下防止のために棚上部に扉を設置するとさらに良い","x":5.1311903,"y":-2.6839418,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-148_0","argument":"備蓄をして、何かあったときでも対応できるようにすべき","x":6.930854,"y":-2.1844804,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-148_1","argument":"日頃から地震等に備えて物を配置したり、火事が起きないように周りの物を掃除すべき","x":5.8550835,"y":-1.8149297,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-149_0","argument":"災害時に家族の集まる場所を決めておくべき","x":5.772515,"y":0.60283625,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-149_1","argument":"3日分の水を確保しておくべき","x":8.115527,"y":-2.3920667,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-149_2","argument":"地震保険や火災保険に加入すべき","x":4.2826886,"y":-0.6832226,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-150_0","argument":"外出前に火元とコンセントを確認することは重要です。","x":7.299699,"y":-0.465004,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-150_1","argument":"地震や津波から避難する際に持っていくカバンを準備しておくべきです。","x":5.652103,"y":-1.8071913,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-151_0","argument":"自分の住んでいるマンションの消火器の場所を確認すべき","x":7.180166,"y":-0.44532743,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-151_1","argument":"避難場所を確認すべき","x":6.939718,"y":-0.032235786,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-152_0","argument":"避難用袋に必要な物を全て収納しておくべき","x":5.4971247,"y":-1.7274946,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-153_0","argument":"備蓄をしている","x":6.9443336,"y":-2.3333058,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-154_0","argument":"家具の揺れを軽減する物を使用すべき","x":5.3531337,"y":-3.090196,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-155_0","argument":"旅行先のホテルなどで避難経路を確認すべき","x":6.964997,"y":-0.02387263,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-156_0","argument":"家族との連絡方法を決めておくべき","x":5.9402814,"y":1.0979589,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-156_1","argument":"家の中を片付けて、上から物が落ちないようにすべき","x":5.509175,"y":-2.9571378,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-156_2","argument":"各部屋に懐中電灯を置いておくべき","x":5.6307473,"y":-2.6163754,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-156_3","argument":"寝室に履物を置いておくべき","x":5.720205,"y":-2.8732083,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-157_0","argument":"備蓄品を常にストックしているべき","x":6.8103757,"y":-2.3527534,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-158_0","argument":"消火栓の位置と開栓具の保管場所を確認すべき","x":7.270486,"y":-0.68636286,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-158_1","argument":"防災課は三輪スクーターの後ろに消火具を積んだ仕様の車輛の導入を検討すべき","x":5.1513495,"y":-1.4514047,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-158_2","argument":"三輪スクーターによる消火具の運搬は木造住宅密集地域に有効である","x":5.1563725,"y":-1.3484249,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-159_0","argument":"水などの備蓄を行うべき","x":7.8976245,"y":-2.2675436,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-159_1","argument":"防災リュックを作るべき","x":5.432594,"y":-1.9607322,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"福祉まつり","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-161_0","argument":"防災訓練がうまくいかないため、品川総合福祉センターの職員の防災意識を高める必要がある","x":2.961478,"y":-0.92847043,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-162_0","argument":"防災のヒントになる情報に出会ったら極力吸収するように心掛けるべき","x":3.2118554,"y":1.247656,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-163_0","argument":"ニュースをきくようにして、防災に関する情報を常に把握すべき","x":3.1534214,"y":1.3107916,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-163_1","argument":"町会の防災訓練に参加して、地域の防災力を高めるべき","x":2.8368936,"y":-0.6401764,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-164_0","argument":"町会や品川区、京陽小学校の防災訓練に参加することは重要です。","x":2.6126149,"y":-0.6210796,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-165_0","argument":"災害はいつ起こるかわからないため、意識して備える必要があるが、何をすればいいかわからない。","x":5.055498,"y":-0.022215726,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-166_0","argument":"水、食料、トイレ等の意識が高くなった。","x":7.4758954,"y":-2.974381,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-167_0","argument":"避難場所を把握すべき","x":6.675031,"y":-0.0986025,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-168_0","argument":"災害時に備えてお風呂の水をためておくべき","x":6.6296067,"y":-1.5611392,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-168_1","argument":"缶詰などの備蓄品は期限を把握し、定期的に買い足すべき","x":6.866872,"y":-2.4076297,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-169_0","argument":"出かける前は必ず火の元の確認をすべき","x":7.306427,"y":-0.37954363,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-171_0","argument":"物品がすぐに使用できるように心掛けるべき","x":6.1515965,"y":-2.4004376,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-172_0","argument":"心がけていることはないという意見","x":5.775742,"y":1.5911849,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-174_0","argument":"水が止まる前におふろの水をためておくべき","x":8.156768,"y":-2.2724707,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-175_0","argument":"備品の準備をしっかりと行うべき","x":6.1431055,"y":-2.4125447,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-176_0","argument":"備品を置いておくことが重要である","x":6.1121387,"y":-2.4664545,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-177_0","argument":"常に隣近所と話をすることが重要である","x":5.528044,"y":3.2220716,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-178_0","argument":"非常食を準備していることは重要である","x":7.1532035,"y":-3.0472298,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-179_0","argument":"ろうあ者として、1人で避難するのは不安なので、友人や隣人と一緒に避難することが安心できる。","x":6.511969,"y":0.28334424,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-181_0","argument":"備蓄として食品を用意すべき","x":7.0784187,"y":-2.7244406,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-181_1","argument":"子供たちに親の連絡先を覚えさせるべき","x":5.812824,"y":1.425771,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-182_0","argument":"避難地区の確保と確認が必要","x":6.9078774,"y":0.035893522,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-182_1","argument":"常備食品と飲料の準備が必要","x":7.2535796,"y":-2.8933356,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-183_0","argument":"防災グッズを備置すべき","x":5.3157945,"y":-1.8630704,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-183_1","argument":"飲料水を備蓄すべき","x":7.8878326,"y":-2.4067879,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-183_2","argument":"避難場所や経路を家族内で共有すべき","x":6.3306994,"y":0.30549648,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-184_0","argument":"避難場所を意識することが重要である","x":6.606181,"y":0.07740355,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-185_0","argument":"品川区のイベントで電気の広げ方を学ぶことができる","x":3.3950093,"y":0.430807,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-185_1","argument":"日テレのそらじろーが主催する防災イベントで熱中症対策を学ぶことができる","x":2.6874065,"y":0.09734807,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-186_0","argument":"品川区の対応は他県に住んでいる人々にとってうらやましい","x":3.8751926,"y":0.38171825,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-187_0","argument":"防災セットを常備すべき","x":5.5081477,"y":-1.9156677,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-188_0","argument":"水の保存は重要である","x":7.891911,"y":-2.370802,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-189_0","argument":"防災グッズの準備は重要である","x":5.3213153,"y":-1.8955652,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-190_0","argument":"防災リュックを活用し、常備食料品を普段使いして期限切れにならないように意識すべき","x":5.7749844,"y":-1.9666083,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-191_0","argument":"非常用の道具を家族分用意すべき","x":6.1439075,"y":-2.3538876,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-192_0","argument":"水道が止まることを想定して、ふろ水を捨てず夜までためておき、トイレなどに使うべき","x":8.158953,"y":-2.2926633,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-193_0","argument":"防災バッグを用意すべき","x":5.3670144,"y":-1.7638773,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-193_2","argument":"家具のすべりどめを設置すべき","x":5.42554,"y":-3.0399969,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-194_0","argument":"いざという時に備えて、リュックを準備すべき","x":5.800151,"y":-1.8260795,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-195_0","argument":"避難経路の整備は重要である","x":6.781081,"y":-0.09539638,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-196_0","argument":"家具の転倒対策を行うべき","x":5.320981,"y":-3.0346587,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-197_0","argument":"防災グッズは定期的に中身を確認し、期限切れやサイズアウトしたものを更新すべき","x":5.0027375,"y":-1.7673926,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-198_0","argument":"水を常備していることは重要である","x":8.082914,"y":-2.2786763,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-199_0","argument":"防災グッズの見直しが必要","x":5.1353226,"y":-1.8248414,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-201_0","argument":"ローリングストックを活用して非常食を常に新鮮に保つべき","x":7.2437153,"y":-2.3052847,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-201_1","argument":"防災トイレを備えて災害時の衛生環境を確保すべき","x":6.295099,"y":-3.1185346,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-201_2","argument":"防災バッグを準備して緊急時に必要な物資をすぐに持ち出せるようにすべき","x":5.5244536,"y":-1.732957,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-202_0","argument":"食品の保管、水の保管を意識すべき","x":7.6059723,"y":-2.4661975,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-203_0","argument":"備蓄品として水を10Lくらい備えている","x":7.8081717,"y":-2.4639304,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-204_0","argument":"コンロの火の確認を徹底すべき","x":7.343755,"y":-0.4128244,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-205_0","argument":"水分や食料のローリングストックを行うべき","x":7.550512,"y":-2.325162,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-206_0","argument":"地震対策として棚を固定すべき","x":5.1648936,"y":-2.561972,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-206_1","argument":"地震時の集合場所を認識しておくべき","x":4.2598853,"y":-0.3795993,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-208_0","argument":"食料を備蓄することはうまくいった","x":7.3222857,"y":-2.8696332,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-208_1","argument":"家具の固定を改善すべき","x":5.364725,"y":-3.0647383,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-209_0","argument":"備蓄食品を用意すべき","x":7.121604,"y":-2.893876,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-210_0","argument":"災害に備えて水や食品を多めに保管すべき","x":6.3979607,"y":-1.8532808,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-210_1","argument":"日常の薬を少し多めに持っておくべき","x":7.479923,"y":-2.4967346,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-210_2","argument":"災害時に備えてリュックを準備すべき","x":5.9579105,"y":-1.772762,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-211_0","argument":"普段から身のまわりをよく見ておくべき","x":4.987625,"y":3.4379888,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-211_1","argument":"訓練に参加すべき","x":1.5201323,"y":-0.114879645,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-212_0","argument":"防災訓練に参加すべき","x":2.144297,"y":-0.8042921,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-214_0","argument":"家具の転倒防止策を講じるべき","x":5.4061403,"y":-3.0100894,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-215_0","argument":"避難場所の確認は重要である","x":6.9525685,"y":-0.081186816,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-216_0","argument":"エリア毎の被災リスクを意識すべき","x":4.772379,"y":0.120516084,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-217_0","argument":"防災用バックを用意すべき","x":5.459904,"y":-1.9282273,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-217_1","argument":"非常食の準備をすべき","x":7.1383815,"y":-3.106094,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-218_0","argument":"缶詰等の備蓄は賞味期限を管理してうまく備えるべき","x":6.860293,"y":-2.511508,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-219_0","argument":"防災グッズを準備すべき","x":5.313783,"y":-1.8759179,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-220_0","argument":"ウォーターサーバーを設置すべき（停電時にも使用できるため）","x":7.477993,"y":-2.032229,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-222_0","argument":"防災士の資格取得のために勉強中であり、スマホの操作を教える教室に防災を取り入れることは有益である","x":1.9270884,"y":-0.18586248,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-223_0","argument":"AEDの場所を確認すべき","x":7.1217923,"y":-0.14616922,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-223_1","argument":"非常口の場所を確認すべき","x":7.251163,"y":-0.14230889,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-223_2","argument":"家の貯蓄の数を把握すべき","x":6.605525,"y":-2.315247,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-224_0","argument":"災害時に備えて生活維持が図れるよう備蓄品を用意すべき","x":6.183662,"y":-1.7355496,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-225_0","argument":"防災訓練に参加することで、知識の習得だけでなく地域の人とコミュニケーションをとることが重要である","x":2.445852,"y":-0.4294189,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-226_0","argument":"米を備蓄している","x":7.48346,"y":-2.3719945,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-227_0","argument":"防災品の準備は重要である","x":5.389074,"y":-1.881215,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-228_0","argument":"体験などに積極的に参加し、知識をつけておくべき","x":1.9154334,"y":1.0393589,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-229_0","argument":"備蓄品のストックは重要である","x":6.7875004,"y":-2.3227072,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-230_0","argument":"ハザードマップや避難場所を確認すべき","x":7.072975,"y":-0.05165307,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-230_1","argument":"備蓄品の賞味期限を確認すべき","x":6.798485,"y":-2.4766426,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-231_0","argument":"災害備品を持つべき","x":5.70757,"y":-1.768439,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-232_0","argument":"備蓄は災害時の生活を支えるために重要である","x":6.4224806,"y":-1.8999956,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-233_0","argument":"避難経路を把握すべき","x":6.702369,"y":-0.05303348,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-233_1","argument":"避難グッズを定期的に見直すべき","x":5.163406,"y":-1.6426624,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-236_0","argument":"防災リュックを用意すべき","x":5.4584684,"y":-2.021783,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-237_0","argument":"食品や水の備蓄は重要である","x":7.725195,"y":-2.661532,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-239_0","argument":"備蓄と家具転倒防止は重要である","x":5.9300723,"y":-2.444638,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-240_0","argument":"アルファ米の新しい食べ方を知りたい","x":7.1957197,"y":-3.0856953,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-241_0","argument":"ローリングストックは災害時の備蓄方法として有効である","x":6.535637,"y":-1.9692127,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-242_0","argument":"まわりの人と協力すべき","x":5.5888257,"y":2.6240354,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-243_0","argument":"水と食料を7日分備蓄すべき","x":7.5545707,"y":-2.6597118,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-244_0","argument":"備蓄セットは定期的に更新すべき","x":6.8864975,"y":-2.260422,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-244_1","argument":"水のタンクは定期的に入れ替えるべき","x":8.047761,"y":-2.3034751,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-245_0","argument":"防災イベントに参加するべきだが、家の立地を考慮して備蓄は特に必要ない","x":4.0961714,"y":-0.84200114,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-246_0","argument":"備蓄品（食料）や備蓄（トイレ）は期限がくると取りかえるべき","x":6.7995853,"y":-2.5163765,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-247_0","argument":"東日本大震災から学び、ガソリン20Lと灯油40Lを確保しているべき","x":6.2090764,"y":-1.7740064,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-248_0","argument":"消火器の耐用年数を考慮して、定期的な点検と交換が必要です。","x":7.2195444,"y":-1.1471391,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-250_0","argument":"水、備蓄（食料品）、簡易トイレの準備が重要である","x":7.3371477,"y":-2.8719447,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-250_1","argument":"特にトイレは重要である","x":6.5063515,"y":-3.179114,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-251_0","argument":"地震対策を強化すべき","x":4.288951,"y":-0.6804531,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-251_1","argument":"防災食の備蓄を進めるべき","x":6.009967,"y":-1.9650756,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災訓練","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-252_0","argument":"励まし、協力して困難に立ち向かうために、増えつつある単身世帯を繋ぐべき","x":5.6997943,"y":2.554629,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-252_1","argument":"企業と地域の連携を区民レベルで行うべき","x":3.9215968,"y":2.4563835,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-257_0","argument":"普段からあいさつして、楽しくするのが良い","x":4.8091655,"y":3.9651732,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-258_0","argument":"災害前に避難所単位で顔を合わせる機会を増やすべき。知らない人とは声をかけにくいが、知っている人だと協力したいと思うため。","x":5.1163063,"y":0.78067994,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-259_0","argument":"マンション住民は地域での防災訓練に参加するだけでなく、周囲の人と顔を合わせたり交流する機会を持つべき","x":2.840926,"y":-0.36428446,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-260_0","argument":"災害時に協力しやすくするために、普段から顔見知り程度の関係を築くために挨拶をするのが効果的だと思う。","x":4.973542,"y":1.0165204,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-261_0","argument":"近所の人と顔見知りになり、交流ができる機会を設けるべき","x":4.447525,"y":3.2434745,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-263_0","argument":"町内会に入っていなくても、区や町単位で社会人が参加できるゆるやかなコミュニティがあると嬉しい。","x":3.3262024,"y":3.9357858,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-263_1","argument":"普段から街に対する関心や理解を色々な人と意見交換できたら、一人ひとりが自分ごととして防災を考えられるようになると思う。","x":4.1623,"y":0.8852792,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-263_2","argument":"発災時は、独り暮らしや世代間で必要な助けに濃淡が出てくるだろうから、そういうシミュレーションのアイデアも話したい。","x":4.9186087,"y":0.8183124,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-264_0","argument":"地域社会が希薄である中で、自己を優先する人が増えていると感じる","x":4.1328664,"y":2.7142427,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-264_1","argument":"助け合いは日常的に重要だが、そのような場が少ない","x":5.6199746,"y":2.4485676,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-264_2","argument":"大森駅や大井町駅では歩きタバコや人にぶつかる人が多い","x":4.4687343,"y":2.835562,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-264_3","argument":"水神公園では自転車を走らせる危険な行為が見られる","x":6.745084,"y":-0.43416458,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-264_4","argument":"譲り合いや助け合いの精神を持ち、日常にほんわかした空気感を作ることが重要","x":5.031374,"y":3.8170462,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-265_0","argument":"緊急時には率先して行動することが重要である。","x":5.875468,"y":-0.58684385,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-265_1","argument":"誰かが行動を起こすことで、他の人も動きやすくなる。","x":5.50983,"y":2.3221896,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-267_0","argument":"避難所に全員が入れるかどうか心配である","x":6.720313,"y":0.18584739,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-267_1","argument":"新しいマンションに住んでいる人でも避難所に行きたいと考えている","x":6.6392126,"y":0.32988086,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-268_0","argument":"LINEのオープンチャット等を活用して、リアルタイムで情報を交換できると良い","x":2.036399,"y":2.7912238,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-268_1","argument":"ペット連れ、障害者、高齢者、各町会等々、多様なルームを作って情報交換や交流を活発に行うべき","x":3.3781621,"y":3.343737,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-269_0","argument":"平時から近隣住民と顔の見える関係を構築しておくことが重要","x":4.874328,"y":3.1337044,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-270_0","argument":"災害時には、もともとの関係性によらず助け合うことが求められる。","x":5.1445103,"y":0.8497266,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-270_1","argument":"普段から付き合いがない人に対しても、自分から手を差し伸べることが重要である。","x":5.4785976,"y":3.4521916,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"しなトーク","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-271_0","argument":"普段から声がけをすることが重要","x":5.1307874,"y":4.2034936,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-272_0","argument":"顔の見える関係性を重視すべき","x":4.954888,"y":3.2875748,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-273_0","argument":"核となる人づくりが重要である","x":3.974824,"y":2.868267,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-274_0","argument":"商店街によく来る人は、情報が集まりやすい話しができると安心する","x":4.2848544,"y":3.0614393,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-275_0","argument":"防災訓練は重要である","x":1.8665156,"y":-0.82168716,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-275_1","argument":"災害時には顔見知りが最大の味方になる","x":4.9852867,"y":0.599905,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-276_0","argument":"ご近所さんが減っているため、一人一人が自分を考えて過ごしている。","x":5.238207,"y":3.1230268,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-277_0","argument":"地域の住民同士の交流が少なく、隣人のことを知らないため不安を感じる","x":4.8032193,"y":2.4581504,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-278_0","argument":"普段からの地域住民との付き合いが防災において重要である","x":4.1279435,"y":1.087166,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-279_0","argument":"資源を分け合うことが重要である","x":5.9755716,"y":2.5213504,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-280_0","argument":"声かけは地域の防災意識を高めるために重要である","x":3.514527,"y":0.94204026,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-281_0","argument":"何かあったときは電話で確認をすべき","x":6.277137,"y":1.6004885,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-282_0","argument":"普段からの声がけが必要だが、あまりできていない","x":5.102288,"y":4.188242,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-283_0","argument":"避難場所に対する不安がある","x":6.6798415,"y":0.21406376,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-284_0","argument":"近所のお付き合いは大事だが、なかなかできていない","x":5.621136,"y":3.4318595,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-285_0","argument":"相互に安全確認や援助が行えると良い","x":5.7160106,"y":2.434505,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-285_1","argument":"日頃からのコミュニケーションが不足していると感じる","x":4.3993783,"y":3.311241,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-286_0","argument":"お互いに呼びかけ合い、避難したり、必要なものをシェアしたりできると良い","x":5.773021,"y":2.447105,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-286_1","argument":"1人1人が災害に対してさらに意識を持つべき","x":4.854138,"y":0.15579157,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-287_0","argument":"多文化共生により共同体意識が希薄になると、住民同士が助け合えるか不安です。","x":4.5699334,"y":1.4184831,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-287_1","argument":"発災後の治安を保つ政策を国や都、区が考えるべきです。","x":4.4146495,"y":0.5596989,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-288_0","argument":"災害時は一人で何とかしようとせず、大きな声で周りの人の助けを求めることが大切","x":5.2125077,"y":0.51289225,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-288_1","argument":"いざという時に声を出せるように、日々避難訓練を行うべき","x":2.2782083,"y":-1.2852291,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-289_0","argument":"隣人との付き合いが全くないため、実災害時に助け合うのは難しい","x":5.0589857,"y":1.0726508,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-290_0","argument":"町会の方々と集合場所に集まり豊葉の杜に行くことになっている","x":3.422642,"y":3.7418602,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-291_0","argument":"近所付き合いを良くすることが重要","x":5.594699,"y":3.407451,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-292_0","argument":"近くまで浸水してきた時に警報を出すべき","x":6.749906,"y":-0.59230983,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-293_0","argument":"近所にどんな人が住んでいるか知らないことが問題である","x":5.0201664,"y":2.6017516,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-294_0","argument":"近所の人との連絡を密にすべき","x":5.446624,"y":3.1787548,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-294_1","argument":"歩けない高齢者に日頃から声をかけるべき","x":4.6572075,"y":2.2195125,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-295_0","argument":"近所付き合いをしていないことに不安を感じているので、今後の課題として近所の人との付き合いをするようにしていきたい。","x":5.5346174,"y":3.3887596,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-296_0","argument":"消火栓や水道管が壊れた場合に備えて、水槽の設置を検討すべきです。","x":7.315077,"y":-1.1288306,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-296_1","argument":"災害時には食糧が不足する可能性があるため、備蓄を考慮すべきです。","x":6.2602525,"y":-1.7573134,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-297_0","argument":"ふだんの声かけが重要","x":5.1508493,"y":4.2566986,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"福祉まつり","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-298_0","argument":"地域の住民や勤務者とのコミュニケーションが重要であり、祭りやイベントを通じて自然な繋がりを作ることが大切です。","x":3.726458,"y":2.6687777,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"町会","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-298_1","argument":"防災訓練や消火器の点検などの基本的な防災活動を日常的に行うことが重要です。","x":2.0166273,"y":-1.0391339,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"町会","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-299_0","argument":"八潮地区で定期的に話し合う時間を作り、顔見知りとなることができたが、センターでの防災訓練への参加を促す行動が不足していると感じている。","x":2.94792,"y":-0.97479534,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-300_0","argument":"普段の関係性が基本だが、高齢化した旧来の人々と無関心な若い人々の間で関係が粗になっていることが悩ましい。","x":5.420333,"y":3.2584484,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-301_0","argument":"防災訓練がどこまでリアルにできるかは難しい","x":1.9131328,"y":-0.9221636,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-302_0","argument":"町会を通じて普段から話し合いを行うべき","x":3.7217069,"y":3.7711718,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-302_1","argument":"要介護者の把握を行うべき","x":4.728142,"y":1.9779614,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-303_0","argument":"水を常備しておくべき","x":8.114707,"y":-2.3149827,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-304_0","argument":"近所の方たちとは日頃から声をかけあい、いざという時にお互いに心強い存在になれるようにすべき","x":5.237395,"y":3.8215153,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-305_0","argument":"防災部を中心として防災対応を先導すべき","x":3.607699,"y":-0.7104604,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-306_0","argument":"災害時に頼るところがわからない。","x":5.175076,"y":0.1876524,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-307_0","argument":"ボランティアを増やすべき","x":2.3327453,"y":2.5495827,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-308_0","argument":"近所の人とは常に声をかけ合うべき","x":5.243588,"y":3.881035,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-309_0","argument":"防災訓練には協力参加すべき","x":2.0266542,"y":-0.7539327,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-310_0","argument":"近所のつきあいが少ないので、もっとつきあえれば良いと思う。","x":5.593787,"y":3.4815118,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-311_0","argument":"特に意見はありません。","x":5.6398363,"y":1.6291689,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-312_0","argument":"情報共有や食べ物のシェアが重要である","x":2.5528617,"y":2.2734642,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-313_0","argument":"お互いに仲良くして助け合うべき","x":5.7062297,"y":2.6191711,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-314_0","argument":"近所の方とあいさつをすることは地域のコミュニケーションを促進し、防災時の助け合いに繋がる","x":4.2354126,"y":1.1881756,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-315_0","argument":"情報共有を円滑にすべき","x":2.4673755,"y":2.3583639,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-316_0","argument":"町会で防災訓練を行うべき","x":2.6141996,"y":-0.6028608,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-317_0","argument":"トイレなどの設備が不足して困る可能性がある","x":6.4652386,"y":-3.2069728,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-318_0","argument":"知人と一緒にコミュニケーションできることが望ましい","x":4.234391,"y":3.4930038,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-319_0","argument":"日頃からお互いに顔が見える関係性を築き、助け合えるようにするべき","x":5.1834846,"y":3.0129535,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-320_0","argument":"仕事を助けあい、近い人から物資を分け合うべき","x":5.882528,"y":2.624115,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-321_0","argument":"イベントでの交流は地域の防災意識を高めるために重要である","x":3.2326562,"y":0.8217648,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-322_0","argument":"マンションの住民との情報共有が重要である","x":3.5946805,"y":1.9005599,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-323_0","argument":"地域の方々との助け合いが防災の鍵になるが、転入者にはその機会が少ない","x":4.7922,"y":0.980175,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-324_0","argument":"町内会活動は地域の防災力を高めるために重要である","x":3.4577355,"y":0.053989105,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-325_0","argument":"集合場所を決めておくべき","x":5.945919,"y":0.6260143,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-326_0","argument":"助け合いを心がけるべき","x":5.7050543,"y":2.4816916,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-327_0","argument":"地域とのコミュニケーションを強化すべき","x":3.7852225,"y":2.6272907,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-328_0","argument":"普段からのコミュニケーションが必要であり、避難所や町会とのリンクの薄さを改善するために、効果的なPR活動を行うことが重要です。","x":3.8225307,"y":1.8024905,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-329_0","argument":"同じマンションや町会のつながりを大切にすべき","x":5.1687307,"y":3.2580926,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-330_0","argument":"近隣同士の声がけを推進すべき","x":5.237142,"y":3.9607124,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-331_0","argument":"近隣の人と知り合い、普段から声がけし合える間柄を築くべき","x":5.2132354,"y":3.734441,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-332_0","argument":"目の前が消防署なので、そこは少し安心している。","x":3.7779937,"y":-0.2660233,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-332_1","argument":"いざという時の連絡手段や段取りなどの情報が不足している気がする。","x":5.9564667,"y":1.6777258,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-333_0","argument":"気軽に声を掛けられるようになると良い","x":4.972664,"y":4.20124,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-334_0","argument":"子供を守るために、親世代同士で助け合うべき","x":5.6433654,"y":2.4953992,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-335_0","argument":"近隣の人と普段から挨拶をし、顔を覚えてもらうべき","x":4.8516006,"y":3.6480176,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-336_0","argument":"避難場所を把握していれば、災害時に迅速に避難できる","x":6.6837716,"y":-0.022356994,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-337_0","argument":"コミュニケーションは防災において重要な役割を果たすべき","x":3.894822,"y":1.454808,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-338_0","argument":"何かあれば家族が集まる場所を決めるべき","x":5.9565253,"y":0.6443032,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-339_0","argument":"おじいちゃん、おばあちゃんへの声かけは、地域の高齢者の孤立を防ぎ、コミュニティの絆を強化するために重要です。","x":4.527303,"y":2.2989612,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-340_0","argument":"無事ですのステッカーを貼る訓練を行うべき","x":1.3014557,"y":0.8723022,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-341_0","argument":"声をかけ合うことが重要である","x":5.127687,"y":4.1972556,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-342_0","argument":"近所付き合いがなく、災害時に助け合えるかが心配","x":5.074952,"y":0.9328339,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-343_0","argument":"近くの年配の方のサポートをするべき","x":5.75502,"y":2.8447313,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-343_1","argument":"普段から声をかけて交流を深めるべき","x":4.978677,"y":4.170682,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-344_0","argument":"物資の交換は災害時における地域の連携を強化する手段として有効である","x":4.561028,"y":0.81802404,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-345_0","argument":"顔見知りであれば、迷子の人を一緒に探すべき","x":4.584505,"y":3.158666,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-346_0","argument":"まわりの人たちと日々交流し、仲良くし、助け合うべき","x":5.4278326,"y":2.8795352,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-347_0","argument":"1週間位は自宅で過ごせるように備えるべき","x":7.117114,"y":-1.9688282,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-348_0","argument":"地域の方と顔見しりになり、近所にどんな方がいるのか知っておくべき","x":4.8085265,"y":2.9511795,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-349_0","argument":"日頃から近所の方たちと仲良くするべき","x":4.9648848,"y":3.3617172,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-350_0","argument":"町会や区の指示に従って行動すべき","x":3.0786705,"y":3.2552574,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-350_1","argument":"情報交換を行うべき","x":2.4261575,"y":2.5143354,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-351_0","argument":"子供の安全を確保するための対策が必要","x":2.6539016,"y":1.1803961,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-352_0","argument":"声のかけあいは地域の防災において重要である","x":3.7049072,"y":1.0025064,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-353_0","argument":"近くの地域がどのような備えをしているかの情報共有があると良い。","x":3.2267406,"y":1.7739078,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-354_0","argument":"マンション住民は近隣の避難訓練に参加すべき","x":2.6852636,"y":-0.6082198,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-355_0","argument":"地域の方とは顔見知りであるが、大規模な訓練に参加したことがなく具体的なイメージがわかない","x":2.0259233,"y":-0.57134044,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-356_0","argument":"ご近所さんと情報交換したり、日頃から良好な関係を築くよう意識すべき","x":5.027878,"y":3.3369021,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-357_0","argument":"避難場所の把握と誘導が重要である","x":6.697142,"y":-0.13612506,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-357_1","argument":"備蓄品が置いてある場所の把握と提供が重要である","x":6.734292,"y":-2.2988098,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-358_0","argument":"1.5mのバールを常備しているので、周囲の家が崩壊した時は助けに行くべき","x":6.2880597,"y":-0.7274944,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-359_0","argument":"自治会での催しを通して知り合いを増やすことが重要","x":3.5169966,"y":3.7773209,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-359_1","argument":"共助の意味を広く知ってもらうための講義が必要","x":5.380918,"y":2.0086048,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-360_0","argument":"隣近所の人と点呼をとって安全確認をするべき","x":6.020996,"y":2.3075912,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-360_1","argument":"お互いの人となりを知っているので、役割分担をして避難所の運営をすべき","x":6.2067776,"y":0.7160196,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-361_0","argument":"同じ居住区に住んでいる方々との面識を深めるべき","x":4.7276635,"y":2.7209978,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-362_0","argument":"災害時に独身の現役世代は地域とのつながりが弱いので、平時から地域との接点を強くする施策が必要","x":4.77555,"y":0.8893385,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-363_0","argument":"互いに協力し合うべき","x":5.5893736,"y":2.5560093,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-364_0","argument":"日頃のコミュニケーション（あいさつ、日常会話等）が大切","x":4.4089627,"y":3.60011,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-365_0","argument":"ご近所つきあいを大切にすべき","x":5.5331283,"y":3.3343828,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-366_0","argument":"平時から近所の方とのかかわりを大切にすべき","x":5.446355,"y":3.325212,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-367_0","argument":"近所の人と世間話をすることで信頼関係を築き、災害時の安否確認につなげるべき","x":4.4771295,"y":1.222655,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-368_0","argument":"特に防災活動を行っていないが、これから活動しようと思う。","x":3.3802805,"y":-0.7304828,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-369_0","argument":"トイレは災害時における衛生管理の重要な要素であり、品川区のような都市部では特にその整備が求められる。","x":6.3915973,"y":-3.1711662,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-370_0","argument":"普段から地域住民同士で交流をしておくべき","x":4.156764,"y":2.9098685,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-371_0","argument":"水をためておくべき","x":8.150839,"y":-2.267634,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-372_0","argument":"マンションで年に1回防災訓練があるので参加している。","x":2.582184,"y":-0.52123564,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-373_0","argument":"よく分からない","x":5.6896944,"y":1.8966222,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-374_0","argument":"防災訓練への参加を通じて、隣近所や町会の方とのコミュニケーションを図るべき","x":2.7309544,"y":-0.46998212,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-375_0","argument":"地域の人との交流は重要である","x":3.9109402,"y":2.754049,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-376_0","argument":"何をしていいか分からない","x":5.7874036,"y":1.7891979,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-377_0","argument":"日頃から周囲の人々とつながっておくべき","x":4.8239765,"y":3.2567465,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-378_0","argument":"町会の活動に進んで参加すべき","x":3.1968627,"y":3.636297,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-379_0","argument":"思ったときに声をかけあえる関係を普段から築くべき","x":5.1284337,"y":4.1306567,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-380_0","argument":"学校が拠点となるため、地域の多様な人々が集まることを考慮し、ルール決めが重要である。","x":3.6213398,"y":2.4876564,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-381_0","argument":"子どもが生まれたことでマンションの防災イベント（訓練）に参加する意識が高まった","x":2.8850834,"y":-0.111290954,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-382_0","argument":"地域イベントや話し合いの会議を定期的に開催すべき","x":3.469263,"y":2.8031626,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-383_0","argument":"イベントを通じて防災に関する知識を広め、地域の頼れる人を知ってもらうべき","x":3.2603316,"y":1.016687,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-384_0","argument":"避難所の場所イベントに参加したい","x":6.7938967,"y":0.13873978,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-385_0","argument":"実際に経験してみないと分からない訓練が大事である","x":1.4109718,"y":-0.05748017,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-385_1","argument":"色々な防災品の使い方を実際にやってみることが重要である","x":5.237917,"y":-1.8674061,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-386_0","argument":"水などのライフラインの確保は、災害時における東京都品川区の重要な課題である。","x":4.1049175,"y":0.09686257,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-388_0","argument":"憲章は親しみやすく短いものが良い","x":0.71474373,"y":2.2952476,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-388_1","argument":"憲章はおしゃれなデザインで区民の目につくところに配置すべき","x":0.7405487,"y":2.279319,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-389_0","argument":"普段目にするところに出てくると印象に残るかもしれない","x":4.896595,"y":3.3974562,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-389_1","argument":"CMを作って駅前のビジョンなどで流すと良い","x":1.8477604,"y":2.489129,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-390_0","argument":"保育園児や小学生が理解できるレベルのわかりやすさや親しみやすさが必要である。","x":2.2269187,"y":1.2638472,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-390_1","argument":"区の職員が時間を使うことが税金の無駄遣いにならないよう、何を何のために行うのかをわかりやすく説明すべきである。","x":6.0321407,"y":2.4968016,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-392_0","argument":"大雨による被害の振り返りを行い、次世代への継承に繋げるべき","x":4.835431,"y":0.07025255,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-393_0","argument":"思い切って歌をつくるべき","x":0.75984275,"y":0.97348124,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-393_1","argument":"アーティストとコラボすべき","x":0.8334251,"y":1.0400151,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-394_0","argument":"歌に加えてダンスがあると体で覚えやすい","x":0.80968827,"y":0.9308017,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-395_0","argument":"次世代に引き継いでいくためにはSNSでの積極的な広報が不可欠だと思います。","x":1.3226997,"y":2.7194695,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"しなトーク","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-396_0","argument":"学校でも周知すべき","x":1.7989467,"y":1.2645749,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-397_0","argument":"PR活動にはメディアや品川ゆかりの人や場所を活用すべき","x":1.6631505,"y":2.444576,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-397_1","argument":"PR活動には駅での取組みを活用すべき","x":1.7382731,"y":2.3643708,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-398_0","argument":"町会から頂いている品は無事で、使用したことはないがうれしい","x":3.3564157,"y":-0.08741188,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-399_0","argument":"いのちに関わることを伝えるべき","x":2.474001,"y":1.9280747,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-400_0","argument":"本日のようなイベントは地域の防災意識を高めるために重要である","x":3.1856465,"y":0.79870415,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-401_0","argument":"いろいろな所に貼るべき","x":1.3324709,"y":1.3875767,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-402_0","argument":"町会などの防災訓練に不参加の区民への働きかけが必要","x":2.7462325,"y":-0.79498214,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-403_0","argument":"しながわ防災区民憲章を多くの人に知ってもらうため、チラシ等で周知すべき","x":0.75574017,"y":2.1097546,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-403_1","argument":"しながわ防災区民憲章は、より簡潔なものを広めていくと良い","x":0.664545,"y":2.2103505,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-404_0","argument":"SNSやインフルエンサーを活用した広報を行うべき","x":1.4644952,"y":2.4163368,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-405_0","argument":"防災イベントを開催し、多くの人に参加してもらうことが重要","x":3.1796749,"y":0.14265996,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-405_1","argument":"学校と区が連携して防災に関する授業やイベントを取り入れるべき","x":2.2379892,"y":0.35662863,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-406_0","argument":"幅広い世代で楽しめる防災訓練を実施すべき","x":2.208105,"y":-0.38866314,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-407_0","argument":"町会の行事に若い方も参加して交流を深めるべき","x":3.397224,"y":3.6933765,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-408_0","argument":"デジタル技術を活用すべき","x":1.489128,"y":2.752572,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-409_0","argument":"水の逃げ道を作るべき","x":6.877379,"y":-0.68204224,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-411_0","argument":"学校や地域で若い人がもっと興味を持つようにすべき","x":3.1838229,"y":3.2399404,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-412_0","argument":"学校で教育し、保護者に周知するようにすべき","x":2.0400925,"y":0.6306964,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-413_0","argument":"地域ごとに消防団だけでなく、やる気のある人を集めて活動できるように準備するべき","x":2.6302898,"y":-0.805692,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-413_1","argument":"役所の人ももっと積極的に防災活動に参加するべき","x":3.2525945,"y":-0.6400565,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-414_0","argument":"防災情報をいろんな所に掲示すべき","x":2.9926689,"y":1.3733178,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"福祉まつり","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-416_0","argument":"新たに防災に関する場の設定や取り組みをするのは負担になるため、既存の行事に防災を取り入れるべき","x":3.7239823,"y":-0.8684723,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-416_1","argument":"他の福祉法人では防災訓練をお祭り前に行い、地域の方が避難した後にお祭りを開始することで成果を上げている","x":2.9543357,"y":-0.69669175,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-418_0","argument":"現実的なトイレの問題などのリアルを訓練に絞ってやるのが良い","x":1.3662703,"y":-0.07329893,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-421_0","argument":"品川区は日頃から防災イベントが多いと感じる","x":3.748757,"y":0.29793143,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-421_1","argument":"品川区では子供向けの防災イベントが多く、親も意識を高めることができる","x":3.1213963,"y":0.4517564,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-422_0","argument":"トイレを設置してほしい","x":6.461491,"y":-3.2128518,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-423_0","argument":"防災訓練にはより多くの若い人達の参加を浸透させることが今後の課題である","x":2.1707764,"y":-0.3604361,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-424_0","argument":"目黒区在住なので品川区の地域特性については分からない","x":3.9519222,"y":0.37055677,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-425_0","argument":"校歌のように、もっと歌にして誰でも歌えるようにすべき","x":0.78143895,"y":0.9872729,"p":0,"cluster_ids":["0","1_4","2_18"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-427_0","argument":"近隣の人の把握は重要である","x":5.585407,"y":2.978283,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-428_0","argument":"大きな災害の経験がないと説明はできない","x":4.996907,"y":0.047686096,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-429_0","argument":"災害だけをテーマにした取り組みだけではなく、日常の生活やエンタメと防災を組み合わせて、防災が身近なこととつながっていることを伝えるべき","x":3.515036,"y":0.8831435,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-430_0","argument":"ご近所さんとの助け合いや声のかけ合いが重要","x":5.7472186,"y":3.241029,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-431_0","argument":"SNSやイベントを活用して、地域住民の防災意識を高めるべき","x":3.177805,"y":0.86968696,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-432_0","argument":"憲章についての広報誌やSNSでの情報発信を行うべき","x":1.0636474,"y":2.4846275,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-432_1","argument":"憲章を学校での授業に取り入れるべき","x":0.7975544,"y":2.1684237,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-433_0","argument":"楽しいイベントやキャンペーンは、参加することでその意義を理解できる。","x":3.21153,"y":2.5699737,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-435_0","argument":"広めていくためのSNSを活用すべき","x":1.4271028,"y":2.763121,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-436_0","argument":"PR活動は地域の防災意識を高めるために重要である","x":3.0441496,"y":0.6769998,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-437_0","argument":"イベント等での発信は、地域の防災意識を高めるために重要である","x":3.1415842,"y":0.922231,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-438_0","argument":"しながわの良さを区民憲章に載せることは良い考えである","x":0.7180415,"y":2.2823179,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-438_1","argument":"公的なイベントや学校の行事でしながわの良さに触れる機会を増やすべき","x":3.1309426,"y":2.7974784,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-439_0","argument":"憲章を周知してほしい","x":0.7570309,"y":2.2709954,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-440_0","argument":"人同士の声がけは重要である","x":5.2107153,"y":4.232403,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-441_0","argument":"イベントやゲーム等を通じて子供達に伝えるべき","x":2.4671462,"y":1.8411771,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-442_0","argument":"今回のような取り組みはとてもよいと思います。","x":2.7641742,"y":0.73551625,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-443_0","argument":"触れる機会を増やすと良い","x":3.1041446,"y":2.989046,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-444_0","argument":"学校でお便りをもらうことで、子供の意識が高まるのは良いことだと思う","x":2.3002872,"y":0.8484737,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-445_0","argument":"学校の授業に防災教育を取り入れるべき","x":2.0841298,"y":0.36709595,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-446_0","argument":"防災食を小学校で作ったり食べたりすることで、皆が身近に感じることができる。","x":2.5223308,"y":0.5357648,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-446_1","argument":"防災食を通じて安心感を得られる。","x":4.3696437,"y":-0.17884265,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-447_0","argument":"防災トイレが送られてきて助かる","x":6.218054,"y":-3.087518,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-448_0","argument":"現状のままで問題ない","x":5.4291844,"y":1.835699,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-449_0","argument":"家族がバラバラになっている時のために、連絡手段や集合場所を事前に決めておくべき","x":5.8941293,"y":0.86500245,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-450_0","argument":"地域での防災において、住民が集まって確認することが重要である","x":3.8229415,"y":1.0093602,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-451_0","argument":"防災訓練で若い人の参加が少ないため、広報が重要であると感じる。","x":2.0728369,"y":-0.42480108,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-452_0","argument":"インスタ等のSNSを活用すべき","x":1.3825123,"y":2.8133554,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-453_0","argument":"子どもも楽しんで一緒に考えられる防災イベントが増えると参加しやすく、防災意識も高まりやすい","x":2.9076278,"y":0.23880364,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-454_0","argument":"子供たちに分かりやすい動画を作成し、小学校の授業で理解を深めるべき","x":2.1325905,"y":1.3327826,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-455_0","argument":"防災に関する情報の露出を増やしてほしい","x":3.0923936,"y":1.3216058,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-456_0","argument":"楽しみながら学べるのが良い","x":1.7265928,"y":0.8853844,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-457_0","argument":"避難訓練などがあったら積極的に参加すべき","x":2.0780394,"y":-0.9554477,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-458_0","argument":"避難場所や経路について家族でしっかり話し合うべき","x":6.3329077,"y":0.33902416,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-458_1","argument":"小さい子供がいる家庭では特に連携をきちんとすべき","x":5.121517,"y":1.8313498,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-459_0","argument":"イベント・訓練への参加者を増やすべき","x":1.5970548,"y":-0.14110841,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-460_0","argument":"地元の連携を強化すべき","x":3.9765968,"y":2.305258,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-461_0","argument":"このイベントは地域の特性を考慮して計画されるべき","x":3.1643395,"y":2.213542,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-462_0","argument":"周知SNSや学校での周知があると良い","x":1.5577656,"y":2.0616806,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-463_0","argument":"定期的に防災用具の配布を行い、防災意識を確認する機会を創設すべき","x":3.4510736,"y":-1.1191906,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-464_0","argument":"親子で防災について学ぶ機会を提供する取り組みを続けるべき","x":2.5107589,"y":0.1178865,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-465_0","argument":"子供はゲームが好きなので、遊びながら知識を得られるものが取り組みやすい","x":1.9714413,"y":1.0314498,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-466_0","argument":"浸水時などの復旧時には、連絡先の補助が必要である","x":7.9223504,"y":-2.1848571,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-466_1","argument":"浸水時などの復旧時には、備品の補助が必要である","x":7.9684687,"y":-2.2972705,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-467_0","argument":"戸越銀座商店街の浸水対策を強化すべき","x":3.9925086,"y":-0.51783067,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-468_0","argument":"防災ポータルや防災アプリで情報を確認できると良い","x":3.0823884,"y":1.3741286,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-469_0","argument":"学校などで子どもたちに防災について伝えるべき","x":2.2556646,"y":0.7765694,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-470_0","argument":"広報活動の回数を増やすべき","x":1.8971246,"y":2.4928315,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-471_0","argument":"防災イベントに有名人を呼ぶことは、普段参加しない人を呼ぶために有効である","x":3.1952798,"y":0.2636748,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-472_0","argument":"SNSや有名人に宣伝してもらい、使う人を増やすべき","x":1.4966508,"y":2.4333675,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-473_0","argument":"本日のようなイベントやSNSが必要","x":1.3701875,"y":2.7658324,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-474_0","argument":"今回のようなイベントは効果的である","x":2.9736643,"y":0.97686917,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-476_0","argument":"ホームページやSNSでのPRを活用すべき","x":1.3081102,"y":2.6300795,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-476_1","argument":"家へのチラシの配布を行うべき","x":1.0778375,"y":1.6081216,"p":0,"cluster_ids":["0","1_4","2_28"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-477_0","argument":"これから防災活動を始めようと思う","x":3.3713062,"y":-0.7516848,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-478_0","argument":"避難場所の整備は地域の安全性を高めるために重要である","x":6.7281327,"y":0.2683812,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-479_0","argument":"子供向けのイベントを行うべき","x":2.8980854,"y":2.395204,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-480_0","argument":"家に防災かばんを置くべき","x":5.5112267,"y":-2.252943,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-481_0","argument":"知らなかったので、もっと周知する必要がある","x":1.905129,"y":1.5446465,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-482_0","argument":"体験会のようなイベントは地域の防災意識を高めるために有効である","x":3.1118405,"y":0.7738069,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-483_0","argument":"コミュニケーションの場を増やすべき","x":3.2279103,"y":3.0310714,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-484_0","argument":"東京都品川区では、地域の特性を活かした防災イベントを開催すべき","x":3.8521276,"y":0.18516144,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-485_0","argument":"分からない","x":5.6959143,"y":1.870305,"p":0,"cluster_ids":["0","1_3","2_2"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-486_0","argument":"防災区民憲章を短冊にしてストラップ等にし、イベントで配布すべき","x":0.6829291,"y":2.078631,"p":0,"cluster_ids":["0","1_4","2_7"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-487_0","argument":"世代を超えたイベントで必要なことを伝えて広めるべき","x":2.5304463,"y":1.836122,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-488_0","argument":"まわりの人々がよくわからない","x":5.3716755,"y":2.5769837,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-489_0","argument":"防災訓練は地域の特性を考慮して実施すべき","x":2.2115564,"y":-0.7654375,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-490_0","argument":"災害に関する様々な人々の声を聞くことが重要である","x":4.911239,"y":0.5486661,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-490_1","argument":"学校で災害に関する意見を探るべき","x":2.219409,"y":0.500788,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-491_0","argument":"学校での防災訓練や地域での訓練を行うべき","x":2.2908068,"y":-0.25004333,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-491_1","argument":"子どもたちが掲示板などで防災情報を確認できるようにすべき","x":2.7605784,"y":1.3223836,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-492_0","argument":"イベント（区民まつり）での周知が効果的である","x":3.273718,"y":1.2123811,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-493_0","argument":"東京都は防災にお金をかけているので安心できる","x":3.9355881,"y":-0.0776632,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-493_1","argument":"品川区は特に防災対策がしっかりしている","x":3.9515908,"y":0.14697559,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-494_0","argument":"町内会や防災イベントに参加しやすくするべき","x":3.3122425,"y":-0.019671908,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-495_0","argument":"教育は地域の防災意識を高めるために重要である","x":2.7930853,"y":0.7666915,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災訓練","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-496_0","argument":"高層階に住む高齢者や障害者の方々は、強い地震の際にエレベーターが停止する可能性があり、避難が困難であるため、安全な場所に留まるべきである。","x":6.5117264,"y":0.52655125,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-496_1","argument":"防災員が支援物資をリヤカー等で運ぶ体制を整えるべきである。","x":5.166531,"y":-1.5845711,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-497_0","argument":"日々の挨拶を通じて地域のきずなを確立すべき","x":4.571377,"y":3.4982812,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-498_0","argument":"マンション独自に交流イベントと防災訓練が必要である","x":2.8973262,"y":-0.36755976,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-498_1","argument":"交流イベントと防災訓練は顔見知りの関係を育むために重要である","x":3.3276105,"y":0.54252005,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-499_0","argument":"自分の住んでいる地域の現状を把握し、いざというときの行動を自分で考えるべき","x":5.8238983,"y":0.10082732,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-499_1","argument":"組織としての活動を考え、若い人に参加してもらえる組織を作るべき","x":3.0632753,"y":3.527321,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-500_0","argument":"地域の特性を生かした住民に役立つ情報を発信すべき","x":3.3294487,"y":2.1606088,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-500_1","argument":"各家庭・個人で準備するものの定期的な更新情報を提供すべき（技術の進歩に応じた情報提供）","x":2.5158038,"y":2.1748176,"p":0,"cluster_ids":["0","1_4","2_1"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-501_0","argument":"町会や地区の防災訓練に参加しやすい手段と方法を考えるべき","x":2.908765,"y":-0.6011227,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-502_0","argument":"町会として防災訓練や避難訓練には1人でも多くの参加を促すべき","x":2.7518213,"y":-0.7342071,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-502_1","argument":"災害が発生した際には訓練の積み重ねが役に立つ","x":1.7699696,"y":-0.5586946,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-503_0","argument":"家庭内備蓄の管理や賞味期限の確認が重要","x":6.6460953,"y":-2.441215,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-503_1","argument":"ローリングストックの実践が重要","x":7.1186223,"y":-2.158167,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-505_0","argument":"自分の命を守るために、その場所でできることを考えるべき","x":5.914889,"y":-0.090560235,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-505_1","argument":"備蓄の管理、避難経路、集合場所を考慮すべき","x":6.4548936,"y":-0.3694163,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-506_0","argument":"地域の医療機関や薬局との協力体制を決めておくべき","x":4.035307,"y":2.2832894,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-506_1","argument":"地域ごとの防災訓練にもっと多くの人が参加できる仕組みを考えるべき","x":2.2994447,"y":-0.87518644,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-507_0","argument":"町会防災訓練や地域総合防災訓練の参加者数を増やすために、配布物資の充実や町会単位の参加費などの方策を講じるべき。","x":2.9892933,"y":-0.5212704,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-507_1","argument":"在留外国人に対する対面型講習や交流を定例化すべき。","x":3.798079,"y":2.4485357,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-507_2","argument":"ミニポンプ隊の拡充のために、中高大学生への魅力ある参加賞を提供し、学生参加者を確保すべき。","x":1.6167504,"y":-0.05947992,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-509_0","argument":"日頃から人とのつながりを大切にするために、お互いに挨拶を交わすことが重要である。","x":4.7735686,"y":3.659519,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-510_0","argument":"品川区ではマンション会社が多く、それぞれが防災意識を高めている。","x":3.9657052,"y":0.17236461,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-510_1","argument":"マンションにおいては管理人と管理組合（理事長など）との意思疎通が重要である。","x":3.810708,"y":1.9522117,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-511_0","argument":"災害は必ず発生することを全町会員に認識してもらう活動を継続すべき","x":4.541088,"y":0.39868605,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-511_1","argument":"防災啓蒙パンフレットと携帯トイレの配布を行うことは有効である","x":3.8729413,"y":-1.3423914,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-511_2","argument":"町会事務所に非常時太陽光発電機を確保することは重要である","x":3.5369782,"y":0.12850468,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-511_3","argument":"各地区部長宅に簡易トイレセットを確保し周知することは有効である","x":6.348368,"y":-3.176416,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-512_0","argument":"災害時に備えた防災訓練を実施すべき","x":1.8015807,"y":-0.6918884,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-512_1","argument":"災害時の安全確保と地域連携を強化すべき","x":4.5632157,"y":0.675238,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-513_0","argument":"備蓄品の管理とローリングストックの実践が重要である","x":6.861524,"y":-2.2327611,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-513_1","argument":"災害時の家族のルール作りと地域の連携を強化すべき","x":4.7982817,"y":0.7204391,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-517_0","argument":"隣近所で助け合える関係を築くことが重要","x":5.7768216,"y":2.9419758,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-517_1","argument":"地域で防災や減災を学び合うべき","x":2.6765552,"y":0.114197835,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-517_2","argument":"カードゲームを通じて防災を体験的に学ぶ機会を増やすべき（HUG等）","x":2.3962793,"y":0.16420041,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-517_3","argument":"町かど防災の充実が必要","x":3.4413831,"y":-0.4425103,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-517_4","argument":"防災施設での体験学習を推進すべき","x":2.183227,"y":-0.011065813,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-518_0","argument":"家庭内備蓄を促進すべき","x":6.270142,"y":-2.287057,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-519_0","argument":"防災訓練の定期的な実施で初期消火、避難誘導、情報収集など、実践的な訓練で一人ひとりが行動を身に着けるようにするべき","x":2.2199306,"y":-1.1371559,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-519_1","argument":"消火器、救護機材、備蓄品等の定期的な点検整備を行うべき","x":7.1181364,"y":-1.1642475,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-522_0","argument":"町内のコミュニケーションを円滑にして災害発生時にお互いがよく分かる関係にしておくことが大切","x":4.325697,"y":1.3060651,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-523_0","argument":"災害時に備えて食糧、飲み水、明かり、携帯ガスコンロ等の家庭内備蓄が必要","x":6.1641917,"y":-1.8072618,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-526_0","argument":"町会として組織を構成し、メンバーを募り組織図を作成し、連絡網を構築すべき","x":3.0143657,"y":3.7500727,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-526_1","argument":"定期的な打ち合わせを実施し、防災意識を高めるためにC級ポンプ操法訓練や防災倉庫の点検、防災に関する学習会を開催すべき","x":3.0871267,"y":-1.0989146,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-527_0","argument":"日頃からご近所との挨拶を心がけるべき","x":4.7578373,"y":3.6217773,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-527_1","argument":"定期的に避難訓練を行い、防災備蓄を確認すべき","x":2.4282815,"y":-1.4271554,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-528_0","argument":"定期的な訓練を繰り返すべき","x":1.2772964,"y":-0.016398935,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-529_0","argument":"地域の災害リスクを理解し、日常的に訓練・啓発を続け、住民同士の信頼関係を築いておくことが災害時の迅速な共助につながり、被害を最小限に抑えると考えます。","x":4.653166,"y":0.5956314,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-530_0","argument":"町会の老人対策、防火部、防犯部との連携を強化すべき","x":4.057868,"y":1.9589294,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-530_1","argument":"地元消防団との連携を強化すべき","x":3.973965,"y":2.0024908,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-531_0","argument":"定期的な訓練が大切だと思います。","x":1.3720573,"y":-0.14993654,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-533_0","argument":"防災訓練を実施し、地域住民が積極的に参加すべき","x":2.466461,"y":-0.82085705,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-534_0","argument":"東京都品川区では、近所の付き合いが防災において重要である。","x":3.943506,"y":0.23580839,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-535_0","argument":"町会の日々の活動を通じて、住人同士が顔を合わせて会話することが重要である","x":3.7018647,"y":3.8054998,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-536_0","argument":"災害発生時に想定外を無くす努力をすべき","x":5.161505,"y":0.07077289,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-537_0","argument":"住んでいる方々の最新の情報を把握しておくべき","x":3.2994125,"y":1.7094623,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-537_1","argument":"その状況に合わせた防災意識を持つべき","x":4.602348,"y":-0.15958343,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-538_0","argument":"防災イベント及び訓練に積極的に参加するなど、防災への高い意識を持つべき","x":3.0972092,"y":-0.8449612,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"１　日頃から防災に対して心がけていることは何ですか？"},"url":null},{"arg_id":"Acsv-539_0","argument":"高齢者や障害者の人数を把握し、災害時に常に動けるよう話し合いや訓練が必要だと痛感している","x":4.7224855,"y":1.8361474,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-539_1","argument":"災害時の対応には住民全体の協力が望まれる","x":4.8873954,"y":0.86536753,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-540_0","argument":"お互いの事情を理解し合うことが重要","x":5.6435523,"y":2.7672458,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-541_0","argument":"近隣のビル管理会社との災害時の提携が必要","x":4.807052,"y":0.6193152,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-542_0","argument":"町会で避難や介護を必要とする人たちを把握し、コミュニケーションを密にするべき","x":4.100056,"y":1.7167194,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-542_1","argument":"避難や介護を必要とする人たちに町会活動に参加してもらうべき","x":4.0180955,"y":1.6271722,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-543_0","argument":"日常の挨拶を通してお互いを知っておくべき","x":4.6051626,"y":3.8304095,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-543_1","argument":"要支援者へのサポート体制の構築において、個人情報の壁をどう取りはらうか、福祉関係者との情報交換をどう行うかについて情報を提供すべき","x":3.5218635,"y":1.863096,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-544_0","argument":"日頃から隣組とのコミュニケーションが必要で、町会の行事には声かけ合って参加を促すべき","x":3.577795,"y":3.6660497,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-545_0","argument":"災害が発生したら人から人が助け合うことが大事だと思います。","x":5.0618243,"y":0.7610396,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-545_1","argument":"思いやりと人情が大切だと思います。","x":5.2558684,"y":3.544196,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-546_0","argument":"定期的なコミュニケーションのためにSNSを活用すべき","x":1.542155,"y":2.8920953,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-546_1","argument":"東五反田コミュニティというLINE公式アカウントを作って活用している","x":1.8350011,"y":3.027501,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-547_0","argument":"地域全体での取組みが重要だが、顔の見える環境づくりだけでは発災時に効果的に運用できない。","x":2.4221156,"y":-0.94709367,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-547_1","argument":"避難所訓練の内容充実が必要で、区として主導的に内容整理を行い、要支援者対応訓練を必須項目とするなど積極的な関与が望ましい。","x":2.6348863,"y":-1.2135135,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-547_2","argument":"避難所だけでなく、居住地近くのマンション等への備蓄を推進し、近隣住民とマンションとの連携強化を図るべき。","x":6.4015737,"y":0.5795861,"p":0,"cluster_ids":["0","1_2","2_29"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-547_3","argument":"備蓄の説明会等を企画し、全体に意識づけと理解を求める対策をとると効果が期待できる。","x":6.9030104,"y":-2.0688376,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-548_1","argument":"備蓄の管理、避難経路、集合場所を確認すべき","x":6.6371627,"y":-0.42180383,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-549_0","argument":"一戸建てで長年住んでいる人は顔見知りで安心だが、引っ越しが頻繁なマンション・アパートでは住民同士の交流が少ない。","x":4.8048034,"y":2.516767,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-549_1","argument":"地域ごとの防災訓練に参加する人が限られており、もっと多くの人が参加できる仕組みを考える必要がある。","x":2.294371,"y":-0.91681224,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-549_2","argument":"災害時に住民同士の交流が少ないことが心配である。","x":4.73881,"y":1.1660551,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-550_0","argument":"品川区では地域から個へと変わりつつあり、個の共通事項による集合が必要である。","x":3.5904822,"y":2.468531,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-550_1","argument":"町会活動を通じて安心、安全な町を作り維持することが重要である。","x":3.5681505,"y":0.25119984,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-550_2","argument":"町会の存在を行政から認めてもらい、役員等に利有る組織にすることが重要である。","x":3.0458183,"y":3.794792,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-551_0","argument":"いざという時にまずは自分の安全を確保し、その後に他人のことを考える習慣を身につける訓練が大切","x":5.884636,"y":-0.2274217,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-551_1","argument":"ゲーム形式で訓練を行うと楽しく、人を覚えられる効果がある","x":1.4179765,"y":0.5351937,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-552_0","argument":"町会では年に1,2度町づくりのイベントを開催し、住民が参加することでコミュニティを広げることが重要","x":3.463642,"y":3.7886577,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-552_1","argument":"住民が不安にならないように安心感を提供することが重要","x":4.646158,"y":1.1406959,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-553_0","argument":"地域行事の回数を増やし、近所づきあいを密にすることが必要である","x":3.506673,"y":2.7840047,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-553_1","argument":"地域行事のための助成制度を継続してほしい","x":3.4613185,"y":2.60769,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-554_0","argument":"顔見知りの関係を育むために交流イベントや定期的なコミュニケーションの場を設けることが有効","x":3.926601,"y":3.2980912,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-555_0","argument":"行事やイベントを通じて、挨拶のできる人間関係を拡大し、顔見知りを強化すべき","x":4.3955846,"y":3.6576135,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-555_1","argument":"生命を守る知恵を学ぶ機会を充実させるべき","x":5.750675,"y":-0.1260143,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-556_0","argument":"避難支援必要者の情報を町会内で共有すべき","x":3.8122165,"y":1.5585765,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-556_1","argument":"町会各班の常任役員が支援必要者名を把握すべき","x":3.9146156,"y":1.4861989,"p":0,"cluster_ids":["0","1_3","2_20"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-557_0","argument":"豪雨時に備えて、自分たちでできることを意識し、声かけをすることが大事","x":5.4041834,"y":-0.19232066,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-558_0","argument":"日頃から挨拶をすることで、地域の人々との顔なじみを増やし、災害時に助け合える関係を築くべき","x":4.6588435,"y":3.2808588,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-559_0","argument":"町会での活動を通じて、会員同士のつながりを深めるべき","x":3.4531991,"y":3.7804601,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-560_0","argument":"地域住民のつながりを強化するために、さまざまなイベントを実施すべき","x":3.432358,"y":2.6895118,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-561_0","argument":"日頃から近所の人たちと交流し関係を築くことが、災害時の安否確認や協力体制の構築につながる。","x":4.591117,"y":1.2877144,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-561_1","argument":"要援護者のリストアップと見守りを行い、地域の防災に関わる組織と日頃から連携し、合同訓練を行うべき。","x":2.6268983,"y":-0.8389851,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-562_0","argument":"両隣への声がけや日頃の交流が重要である","x":5.1006255,"y":4.051076,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-563_0","argument":"町会行事などを通じて、気軽に話しかけが出来る環境を作るべき","x":3.8323302,"y":3.8139768,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-564_0","argument":"町会会員のコミュニティの場を作り、顔つなぎをしておくことが重要だと思います。","x":3.4982805,"y":3.8378918,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-565_0","argument":"地域住民とのコミュニケーションを重視すべき","x":3.9036388,"y":2.6230936,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-566_0","argument":"日常の顔合わせや日頃のPR、訓練が重要である","x":4.4100566,"y":3.7390227,"p":0,"cluster_ids":["0","1_3","2_30"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-567_0","argument":"祭礼や子ども縁日、春まつり、子どもパトロールなどの参加しやすいイベントを開催し、地域や隣人のコミュニケーションを促進すべき","x":3.1285622,"y":2.688521,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-568_0","argument":"防災の必要性を話題に上げ、地域の関わりを深めることが大切です。","x":3.694614,"y":0.97314084,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-568_1","argument":"町会活動を通じて地域に発信し、困った時に相談できる環境を作ることが防災に繋がります。","x":3.5465395,"y":0.30383816,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-569_0","argument":"日常の挨拶は人間関係を円滑にするために重要である","x":4.57028,"y":3.8341968,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-570_0","argument":"地域住民とのコミュニケーションが重要である","x":3.9314647,"y":2.6328366,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-571_0","argument":"挨拶や地域活動への参加、備蓄や防災習慣の継続等の日常の小さな行動が、災害時の共助を支える大きな力になると考えます。","x":4.9025826,"y":0.9292302,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-572_0","argument":"近隣と良く話し、助け合うべき","x":5.7186446,"y":2.9597857,"p":0,"cluster_ids":["0","1_3","2_19"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-573_0","argument":"訓練が防災において最も重要である","x":1.7785801,"y":-0.75499797,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-574_0","argument":"町会で行う防災訓練に積極的に参加し、初期消火の重要性を理解した上での消火訓練を身に着けるべき","x":2.3893104,"y":-0.9784979,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-574_1","argument":"C級やD級ポンプは貯水槽等の水源が必要で、いざという時にどこから水を引くのか疑問がある","x":7.9768863,"y":-2.3786685,"p":0,"cluster_ids":["0","1_1","2_22"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-574_2","argument":"スタンドパイプの訓練を行う際、消火栓のバルブが錆びて回らないことがあるため、定期的な消火栓の点検が必要","x":7.299507,"y":-1.048344,"p":0,"cluster_ids":["0","1_2","2_13"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-575_0","argument":"イベントなどの実施やコミュニケーションの場を設けるべき","x":3.1377695,"y":2.8028288,"p":0,"cluster_ids":["0","1_3","2_31"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-576_0","argument":"挨拶や雑談ができる雰囲気作りが重要","x":4.60087,"y":4.0191336,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-577_0","argument":"町会内の活動を活発化し、多くの参加を促すことで住人同士の顔合わせの機会を設けるべき","x":3.393431,"y":3.735146,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-577_1","argument":"防災・防犯パトロールを通じて地域・住人の状況を把握し、役員間で情報を共有することが重要","x":3.4284012,"y":1.3161347,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-578_0","argument":"防災意識の向上のために、家庭内の防災備蓄、家具の転倒防止、非常電源の確保を行うべき","x":5.9431233,"y":-2.2036436,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-578_1","argument":"防災組織を確立すべき","x":3.503322,"y":-1.0906485,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-579_0","argument":"コミュニケーションを取れる方へは挨拶と声かけをすべき","x":4.6426835,"y":3.9283335,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-580_0","argument":"町内会、老人会、学校のＰＴＡなどに参加し、地域との関わりを持つべき","x":3.3114545,"y":3.6308594,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"２　災害時に地域や周囲の人とどのように助け合えると良いと思いますか？"},"url":null},{"arg_id":"Acsv-581_0","argument":"防災訓練には多くの人に参加してもらうため、館内放送やポスターで周知を徹底すべき","x":2.5091238,"y":-0.37432846,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-582_0","argument":"防災に対する当事者意識が発災するまで希薄であり、他人事のように捉えられている。","x":4.6428595,"y":-0.064591095,"p":0,"cluster_ids":["0","1_2","2_26"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-583_0","argument":"若い世帯が参加しやすい防災訓練を実施すべき","x":2.1116333,"y":-0.25081542,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-583_1","argument":"学校との連携を強化して防災意識を高めるべき","x":2.2707298,"y":0.38843352,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-583_2","argument":"町会の行事に若い世帯が参加しやすい環境を整えるべき","x":3.37069,"y":3.615898,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-584_0","argument":"AEDや消火器の使い方などの訓練は大勢で行うのではなく、説明書を各家庭に配布し、各自で月一回程度その説明書を読み、家庭内でいざというときの行動を話し合うべき","x":2.2244546,"y":-1.1808903,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-585_0","argument":"防災訓練は、あるべき姿を目指して年度ごとにステップアップする形で繰り返し行うべき","x":1.8875293,"y":-0.8656428,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-585_1","argument":"防災に役立つ最新グッズの定期的な情報提供が必要","x":4.766054,"y":-1.6325824,"p":0,"cluster_ids":["0","1_1","2_8"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-586_0","argument":"町会として防災訓練が必要だと思う","x":2.7849767,"y":-0.8214971,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-587_0","argument":"品川区内では、地域ごとに木造住宅や小規模マンション、大規模マンションといった特性があるため、各地域に合った防災施策が必要である。","x":3.9846697,"y":0.21349904,"p":0,"cluster_ids":["0","1_5","2_14"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-587_1","argument":"特に木造密集地域においては、高齢世帯や歩行困難者の把握が重要である。","x":4.720881,"y":1.9083376,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-588_0","argument":"現在の避難所訓練や防災訓練はマンネリ化しており、参加者の意識も高くないため、区主導の訓練のあり方を改めて検討すべき","x":2.669329,"y":-1.2124873,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-588_1","argument":"訓練の参加呼びかけの徹底や参加者へのインセンティブ、義務化を検討すべき","x":1.5996271,"y":-0.22112827,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-588_2","argument":"訓練に対する積極的な広報活動が必要","x":1.6875025,"y":2.077694,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-588_3","argument":"防災区民組織単位の訓練に対する積極的な支援（要員派遣や資金の提供、防災区民組織間の調整やイベント化への支援等）が必要","x":2.7327898,"y":-0.9094896,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-588_4","argument":"各個人の意識向上を図ると共に、地域全体での取組の必要性を認識し、訓練の工夫・改善を通じて参加者の拡大が必要","x":2.055301,"y":-0.6735817,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-589_0","argument":"月に1度くらい集まって話ができる場をつくるべき","x":3.8031108,"y":3.4150321,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-590_0","argument":"学校教育現場における訓練や避難所の役割分担、収納可能人数についてフレキシブルに対応すべき","x":2.6652958,"y":-1.2196132,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-590_1","argument":"ほとんどの家屋が倒壊した場合の受け入れ先を決定しておくことが区民の安心につながる","x":4.7637496,"y":0.8995614,"p":0,"cluster_ids":["0","1_2","2_16"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-591_0","argument":"小・中・高校における防災教育として、防災ハンドブックの使用を推奨すべき","x":2.1343787,"y":0.42528647,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-591_1","argument":"公立校で救急救命講習を義務付けるべき","x":2.0349324,"y":0.2935926,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-592_0","argument":"防災の情報伝達は、地域の繋がりが薄れている現状では、個々の防災意識を高めることが難しい。","x":3.5526278,"y":1.0873587,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-592_1","argument":"SNSを防災情報のツールとして利用することは考えられるが、区民に広めるのは難しい。","x":2.866377,"y":1.3391291,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-592_2","argument":"既存の町会を活用し、町会会員に防災情報を伝えることが効果的である。","x":3.424935,"y":-0.02576624,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-592_3","argument":"町会を公的な組織とし、区民全てを町会会員とすることが望ましい。","x":3.0559304,"y":3.8254304,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-593_0","argument":"町会での消防団員の推薦により、防災意識の高まりが期待できる","x":3.182104,"y":-0.5927408,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-594_0","argument":"町会の会議やマンションの理事会で、5分～10分の防災会議を設けるべき","x":3.311363,"y":-0.16761835,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-594_1","argument":"2か月に1度くらいのペースで防災意識を高めるアプローチを行うべき","x":3.211414,"y":-1.1586313,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-595_0","argument":"毎年9月1日に各家庭に必要な備蓄品リストと併せてそのうちの1品目を配布する助成制度があれば利用したい","x":5.9560494,"y":-2.1516478,"p":0,"cluster_ids":["0","1_1","2_24"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-596_0","argument":"避難場所の確認や地域での防災訓練を実施すべき","x":2.7053041,"y":-1.3976182,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-596_1","argument":"学校との連携による防災教育を行うべき","x":2.196339,"y":0.35446715,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-597_0","argument":"2025品川区民まつり＆防災訓練のようなイベントを通じて、若い世代から高齢者まで様々な人々が参加したくなるような機運を高め、防災意識を向上させるべき","x":3.0413394,"y":0.46050146,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-598_0","argument":"学校との連携による防災訓練を実施すべき","x":2.204974,"y":0.26052874,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-598_1","argument":"古くなった防災備蓄品（水・乾パン）を町会員に配布し、避難所を再確認すべき","x":3.6771712,"y":-1.2515157,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-599_0","argument":"大々的防災訓練を地域毎に実施すべき","x":2.1814148,"y":-0.7486661,"p":0,"cluster_ids":["0","1_6","2_15"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-599_1","argument":"コロナ以降防災訓練を経験していない若い方やお子さん達に経験の機会を提供し、防災意識を高めるべき","x":2.2477286,"y":-0.18935789,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-600_0","argument":"町会に加入してもらいたい。区には、町会加入を強制的にするくらいの姿勢がほしい。","x":3.1373422,"y":3.7400477,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-600_1","argument":"平常時はコミュニティに属さなくても生活できるが、いざという時にご近所や町会などのコミュニティがあることがありがたい。","x":3.6029346,"y":3.9300292,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-600_2","argument":"『いざという時のために町会に入って、あなたのまちをみんなでまもろう！助け合おう！』というメッセージを伝えるべき。","x":3.2552664,"y":3.6485302,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-601_0","argument":"地域防災拠点の周知を徹底すべき","x":3.3737352,"y":0.9443019,"p":0,"cluster_ids":["0","1_5","2_10"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-601_1","argument":"家具等の転倒防止対策を重要な場所で徹底すべき","x":5.382949,"y":-2.9153776,"p":0,"cluster_ids":["0","1_1","2_21"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-601_2","argument":"食料と水の備蓄を最低3日～1週間分準備すべき","x":7.4110675,"y":-2.8041074,"p":0,"cluster_ids":["0","1_1","2_9"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-601_3","argument":"防災に関する啓発活動を行うべき","x":3.4570081,"y":-0.8093632,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-604_0","argument":"まずは身の安全確保、火災の防止、トイレの確保が重要である","x":6.2906785,"y":-3.0765111,"p":0,"cluster_ids":["0","1_1","2_0"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-604_1","argument":"日々の情報交換ライン掲示板による広報活動が必要である","x":1.8567928,"y":2.2922592,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-605_0","argument":"合同避難所訓練や町会の防災イベント、各種行事を通じて、防災に対する意識付けと啓発を行うべき","x":3.1438868,"y":-0.8923322,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-606_0","argument":"防災訓練や町会開催の消火訓練に積極的に参加すべき","x":2.4894962,"y":-0.8881899,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-607_0","argument":"避難所の確認や防災訓練を行うべき","x":2.682478,"y":-1.5229006,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-608_0","argument":"区として防災アテンダントを組織し、防災活動に対処することで、防災を新しく分かりやすく楽しく意識してもらうべき","x":3.4107208,"y":-0.8314376,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-611_0","argument":"SNSを活用して行政から定期的に情報を発信すべき","x":1.5823675,"y":2.5117657,"p":0,"cluster_ids":["0","1_4","2_23"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-612_0","argument":"防災意識を高めるために、四半期ごとに防災行事を実施すべき","x":3.2265203,"y":-1.0891918,"p":0,"cluster_ids":["0","1_6","2_3"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-612_1","argument":"若い世代が参加できるように、学校を利用した保護者と生徒の合同訓練を行うべき","x":2.012123,"y":0.038709823,"p":0,"cluster_ids":["0","1_6","2_11"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-613_0","argument":"教育・体験・交流・デジタル・生活習慣化を組み合わせることが有効である","x":2.4512022,"y":1.4962426,"p":0,"cluster_ids":["0","1_4","2_25"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-613_1","argument":"楽しく学べる仕掛けと地域のつながりを強化することが重要である","x":3.7231817,"y":2.8021138,"p":0,"cluster_ids":["0","1_3","2_33"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-614_0","argument":"自分の事は自分で対処し、駄目な場合はすぐ相談すべき","x":5.9176245,"y":-0.063803405,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-615_0","argument":"町会の班長さんは防災区民組織のメンバーとして訓練に参加すべき","x":2.9226794,"y":-0.6359717,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-616_0","argument":"防災訓練を繰り返し行うことで、地域住民間のコミュニケーションが生まれ、協力体制が強化される。","x":2.703804,"y":-0.42697322,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-616_1","argument":"防災訓練の回数を増やすことで、防災意識が高まる。","x":2.5068262,"y":-0.66163605,"p":0,"cluster_ids":["0","1_6","2_27"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-617_0","argument":"地域や防災に関する情報をイベントなどで発信すべき","x":3.2321494,"y":1.2592667,"p":0,"cluster_ids":["0","1_5","2_35"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-618_0","argument":"挨拶や声掛けを通じて人柄を知ることができる","x":4.599779,"y":3.947709,"p":0,"cluster_ids":["0","1_3","2_4"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-619_0","argument":"町会活動の理解を高め、参加を促進する必要がある","x":3.2081976,"y":3.684724,"p":0,"cluster_ids":["0","1_3","2_12"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-619_1","argument":"町会単位の活動を活発化し、防災用品購入の補助を増額して活動しやすい環境を整えるべき","x":3.4317393,"y":-0.07597444,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-620_0","argument":"過去の災害での教訓を教宣すべき","x":1.8035866,"y":0.044285618,"p":0,"cluster_ids":["0","1_6","2_32"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-621_0","argument":"高齢者集団の老々介護のような避難状態を避けるために、地域連携を拡大する方法を協議すべき","x":4.5812726,"y":1.9785466,"p":0,"cluster_ids":["0","1_3","2_17"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-621_1","argument":"自分の命は自分で守るという意識を徹底すべき","x":5.8263674,"y":-0.16043107,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-621_2","argument":"救助を望まない場合の意思表明（例：ドアに救助不要と表示）を周知すべき","x":5.506869,"y":0.74081206,"p":0,"cluster_ids":["0","1_2","2_34"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-621_3","argument":"自宅避難と救援無用の考え方を周知し、他の命を救うことに繋げるべき","x":6.0150466,"y":0.14924231,"p":0,"cluster_ids":["0","1_2","2_5"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null},{"arg_id":"Acsv-622_0","argument":"区役所や区長、区議会議員が協力して防災イベントを計画し、区民全員が参加するような規模のイベントを目指すべき","x":3.0832174,"y":-0.17581195,"p":0,"cluster_ids":["0","1_5","2_6"],"attributes":{"author":"防災区民組織","Theme":"３　しながわ防災区民憲章を次世代に継承し、広めていくために"},"url":null}],"clusters":[{"level":0,"id":"0","label":"全体","takeaway":"","value":748,"parent":"","density_rank_percentile":0},{"level":1,"id":"1_2","label":"地域連携と防災意識の向上による災害対応力の強化","takeaway":"災害時における迅速かつ安全な避難を実現するためには、地域コミュニティの強化と住民同士の協力体制が不可欠です。避難場所や経路の確認、家族や近隣住民との情報共有、備蓄の管理など、具体的な行動準備が求められます。また、日常的な地域活動への参加や交流を通じて信頼関係を築くことが、災害時の共助を促進します。さらに、個々人が防災意識を高め、具体的な備えを行うことで、地域全体の災害対応力が強化されます。","value":111,"parent":"0","density_rank_percentile":0.8333333333333334},{"level":1,"id":"1_5","label":"地域特性を活かした防災イベントとコミュニティ参加の促進","takeaway":"品川区における防災対策は、地域特性を活かしたイベントの開催や住民の防災意識向上に重点を置いています。町会やマンション理事会を通じたコミュニティ活動の活性化、行政との協力による大規模イベントの企画、子供も参加しやすい防災教育の推進が行われています。これにより、地域全体での防災意識の向上と、災害時の迅速な対応が期待されています。また、SNSを活用した情報共有や誤情報の防止、地域掲示板での情報提供など、情報伝達の強化も重要視されています。","value":76,"parent":"0","density_rank_percentile":0.3333333333333333},{"level":1,"id":"1_1","label":"災害時の生活維持と安全確保のための備蓄と防災対策の強化","takeaway":"災害時におけるトイレや水、食料の備蓄の重要性が強調されており、特に衛生環境の確保や生活の維持に不可欠な要素として位置づけられています。家庭内での備蓄管理や防災意識の向上が求められ、具体的な対策として簡易トイレの備えや水の常備、非常用リュックの準備が挙げられています。また、行政による支援や情報提供の重要性も指摘され、個人や地域社会全体での防災力向上が目指されています。","value":155,"parent":"0","density_rank_percentile":0.6666666666666666},{"level":1,"id":"1_4","label":"多様な手法とメディアを活用した防災意識の向上と知識普及","takeaway":"しながわ防災区民憲章の普及を目指し、教育や体験を通じて子供や外国人にもわかりやすく伝えることが重要視されています。ゲームやデジタルツール、音楽やリズム、アニメーションなど多様なメディアを活用し、楽しみながら学べる環境を提供します。また、SNSや広報誌を通じた情報発信、学校での教育、イベントでの配布など、多様な手段を組み合わせることで、憲章の認知度を高め、区民にとって身近で重要な存在とすることを目指しています。","value":92,"parent":"0","density_rank_percentile":0.5},{"level":1,"id":"1_3","label":"地域コミュニケーションの強化と防災・共助体制の構築","takeaway":"地域社会における日常的なコミュニケーションの強化を通じて、住民同士のつながりを深め、災害時や緊急時における迅速な対応と共助体制の構築を目指します。町会や地域イベントを活用し、住民が顔を合わせる機会を増やし、外国人を含む多様な住民との交流を促進します。これにより、地域全体の防災力を高め、安心して暮らせる環境を作ることが期待されています。","value":199,"parent":"0","density_rank_percentile":1},{"level":1,"id":"1_6","label":"地域全体での防災訓練と教育の強化による災害対応力の向上","takeaway":"地域社会における防災意識を高めるため、防災訓練や教育活動を通じて住民の参加を促進し、災害時の対応力を強化することが求められています。具体的には、学校での防災教育や地域での訓練を充実させ、若者や要援護者を含む多様な住民が参加しやすい環境を整えることが重要です。また、既存の行事に防災要素を取り入れることで、負担を軽減しつつ効果的に防災意識を浸透させる方法も提案されています。これにより、地域全体での協力体制が強化され、災害時における迅速かつ効果的な対応が期待されています。","value":115,"parent":"0","density_rank_percentile":0.1666666666666666},{"level":2,"id":"2_5","label":"緊急時の自己防衛意識と行動準備の重要性","takeaway":"この意見グループは、緊急時における自己防衛意識の重要性と、事前の備えや行動準備の必要性に焦点を当てています。自分の安全を最優先に考え、必要な知識や準備を整えることが、他者の救助や地域の安全にも繋がるという考えが共通しています。具体的には、自己の安全確保、生命を守る知識の習得、緊急時の行動計画の策定、そして地域の状況把握といった点が強調されています。","value":12,"parent":"1_2","density_rank_percentile":0.5},{"level":2,"id":"2_14","label":"品川区における地域特性を活かした防災対策と住民意識の向上","takeaway":"この意見グループは、品川区における防災対策の重要性とその地域特性に基づく施策の必要性に焦点を当てています。品川区は防災イベントが多く、住民の防災意識が高いと評価されており、他県の住民からも羨ましがられるほどです。また、地域ごとの特性に応じた防災施策の必要性や、近所付き合いの重要性、マンション会社の防災意識の向上など、具体的な防災対策の強化が求められています。さらに、防災食やライフラインの確保、地震時の具体的な行動学習の重要性も指摘されています。","value":21,"parent":"1_5","density_rank_percentile":0.9166666666666666},{"level":2,"id":"2_0","label":"災害時におけるトイレの重要性とその備え","takeaway":"この意見グループは、災害時におけるトイレの確保とその重要性に焦点を当てています。特に、トイレは衛生管理の観点から非常に重要であり、都市部ではその整備が求められています。意見の中では、簡易トイレや携帯トイレの備えが強調されており、各地区での備蓄や情報の周知が有効であるとされています。また、トイレの不足がもたらす困難を避けるための具体的な対策が提案されています。","value":12,"parent":"1_1","density_rank_percentile":0.1111111111111111},{"level":2,"id":"2_8","label":"防災準備と情報提供の重要性","takeaway":"この意見グループは、防災に関する準備と情報提供の重要性に焦点を当てています。具体的には、防災グッズやリュックの準備、定期的な見直し、情報提供の必要性が強調されています。また、災害時の迅速な対応を可能にするための体制整備や、日常生活の中で防災意識を高めるための工夫についても言及されています。これにより、個人や地域社会全体の防災力を向上させることが目的とされています。","value":31,"parent":"1_1","density_rank_percentile":0.3055555555555556},{"level":2,"id":"2_9","label":"災害時の備蓄管理と意識向上の重要性","takeaway":"この意見グループは、災害時に備えた備蓄の重要性とその管理方法に焦点を当てています。具体的には、食料や水、医療品、モバイルバッテリーなどの備蓄品を定期的に更新し、賞味期限や保管場所を把握することの重要性が強調されています。また、備蓄に関する意識向上のための説明会や情報提供の必要性も指摘されており、個人や家庭が災害に備えるための具体的な行動が求められています。","value":40,"parent":"1_1","density_rank_percentile":0.9722222222222222},{"level":2,"id":"2_25","label":"教育とコミュニケーションの多様化による知識普及と意識向上","takeaway":"この意見グループは、教育や体験を通じて知識を共有し、特に子供や外国人に対してわかりやすく伝えることの重要性を強調しています。ゲームやデジタルツールを活用して楽しみながら学ぶことや、やさしい日本語・英語を用いたコミュニケーションの促進、学校や家庭での周知活動を通じて、知識の普及と意識の向上を図ることが有効であるとしています。","value":18,"parent":"1_4","density_rank_percentile":0.75},{"level":2,"id":"2_29","label":"避難計画と地域連携の重要性","takeaway":"この意見グループは、災害時の避難に関する計画と準備の重要性を強調しています。具体的には、避難場所や経路の確認、家族や近隣住民との情報共有、備蓄の管理、そして高齢者や障害者への配慮が含まれています。また、避難所の整備や地域との連携強化が地域の安全性を高めるために不可欠であることが指摘されています。これらの意見は、災害時に迅速かつ安全に避難するための具体的な行動と準備の必要性を示しています。","value":29,"parent":"1_2","density_rank_percentile":0.4722222222222222},{"level":2,"id":"2_13","label":"防災対策と安全確認の重要性","takeaway":"この意見グループは、災害時の安全確保と日常的な防災対策の重要性に焦点を当てています。具体的には、消火器や消火栓の点検、避難経路や非常口の確認、備蓄品の管理、火元の確認など、災害に備えた準備と安全確認の必要性が強調されています。また、地図やハザードマップの確認、避難器具の使い方の確認など、事前の情報収集と訓練の重要性も含まれています。これらの意見は、日常生活における防災意識の向上と、緊急時の迅速な対応を可能にするための具体的な行動を提案しています。","value":19,"parent":"1_2","density_rank_percentile":1},{"level":2,"id":"2_33","label":"地域社会の活性化と多文化共生の推進","takeaway":"この意見グループは、地域社会の活性化と多文化共生を推進するための具体的な方策に焦点を当てています。書道をはじめとする伝統文化の推進や、地域住民と外国人とのコミュニケーション強化、企業と地域の連携、地域イベントの開催などを通じて、地域のつながりを強化し、個人主義が進む中での共同体意識の再構築を目指しています。特に、外国人との交流や地域住民同士のコミュニケーションの重要性が強調されています。","value":19,"parent":"1_3","density_rank_percentile":0.1388888888888889},{"level":2,"id":"2_12","label":"町会を通じた地域コミュニティの活性化と組織化の重要性","takeaway":"この意見グループは、町会を通じて地域コミュニティを活性化し、住民同士の交流を深めることの重要性を強調しています。町会の存在を行政から認められることや、町会活動を通じて住民が顔を合わせる機会を増やすこと、若い世代の参加を促進すること、そしていざという時に備えたコミュニティの構築が求められています。また、町会を公的な組織として位置づけ、全住民が参加することの重要性も指摘されています。これにより、地域のつながりを強化し、住民が安心して暮らせる環境を作ることが目指されています。","value":29,"parent":"1_3","density_rank_percentile":0.3611111111111111},{"level":2,"id":"2_2","label":"災害時の連絡手段と共助の重要性","takeaway":"この意見グループは、災害時や緊急時における連絡手段の確保と、地域や家族間での共助の重要性に焦点を当てています。具体的には、祖父母や隣近所との連絡を密にすること、緊急時の連絡手段の不足、Wi-fiや電話の重要性、子供たちへの連絡先の教育、公衆電話の場所の把握など、災害時に備えた具体的な行動や情報の必要性が強調されています。また、共助の概念を広めるための教育の必要性も指摘されています。","value":18,"parent":"1_3","density_rank_percentile":0.3888888888888889},{"level":2,"id":"2_22","label":"災害時のための水と食料の備蓄の重要性","takeaway":"この意見グループは、災害や緊急時に備えて水や食料を備蓄することの重要性を強調しています。特に水の備蓄に関する意見が多く、定期的な入れ替えや常備の必要性が指摘されています。また、停電時や水道が止まった場合の対策として、ウォーターサーバーの設置やふろ水の活用など具体的な方法も提案されています。これらの意見は、災害時の生活の維持における水と食料の確保の重要性を示しています。","value":31,"parent":"1_1","density_rank_percentile":0.1944444444444444},{"level":2,"id":"2_1","label":"多様なメディアと手法を活用した効果的な情報伝達と共有","takeaway":"この意見グループは、情報を効果的に伝達し共有するために、イラストやアニメ、シュールな動画、電車内広告など多様なメディアや手法を活用することの重要性を強調しています。また、情報の定期的な更新や、世代を超えたイベント、意見交換アプリの利用など、情報の受け手に応じた柔軟なアプローチを提案しています。これにより、視聴者や参加者に新しい視点を提供し、情報の理解を深めることが可能となります。","value":14,"parent":"1_4","density_rank_percentile":0.6388888888888888},{"level":2,"id":"2_20","label":"地域コミュニケーションと防災連携の強化","takeaway":"この意見グループは、地域社会におけるコミュニケーションの重要性と、それが防災活動や避難支援において果たす役割に焦点を当てています。外国人や要支援者を含む多様な住民との日常的なコミュニケーションの強化が、災害時の迅速かつ効果的な対応に繋がるとされています。また、町会やマンション管理組合、福祉関係者、消防団などとの連携を強化し、情報共有を円滑にすることが、地域全体の防災力を高めるために不可欠であると強調されています。","value":16,"parent":"1_3","density_rank_percentile":0.7777777777777778},{"level":2,"id":"2_3","label":"地域社会における防災意識向上と活動推進の重要性","takeaway":"この意見グループは、地域社会全体で防災意識を高めることの重要性を強調しています。具体的には、防災訓練や啓発活動、避難所の確認、備蓄品の配布などを通じて、住民や関係者が防災に対する意識を高め、積極的に参加することが求められています。また、既存の行事に防災要素を取り入れることで、負担を軽減しつつ効果的に防災意識を浸透させる方法も提案されています。これにより、地域全体での防災対応力の向上が期待されています。","value":22,"parent":"1_6","density_rank_percentile":0.8611111111111112},{"level":2,"id":"2_11","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":24,"parent":"1_6","density_rank_percentile":0.6666666666666666},{"level":2,"id":"2_15","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":29,"parent":"1_6","density_rank_percentile":0.4444444444444444},{"level":2,"id":"2_21","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":17,"parent":"1_1","density_rank_percentile":0.1666666666666666},{"level":2,"id":"2_24","label":"家庭内防災備蓄と意識向上の重要性","takeaway":"この意見グループは、災害時に備えた家庭内での備蓄の重要性と、それに伴う防災意識の向上を強調しています。具体的には、ローリングストックや非常用リュックの準備、応急手当の習得、家具の転倒防止、非常電源の確保など、日常生活の中での防災対策の実践が挙げられています。また、行政による備蓄品の助成制度の提案や、東日本大震災からの教訓を活かした具体的な備蓄内容の例示も含まれています。これらの意見は、災害時における生活の維持と安全確保のための準備の重要性を訴えています。","value":24,"parent":"1_1","density_rank_percentile":0.8888888888888888},{"level":2,"id":"2_17","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":13,"parent":"1_3","density_rank_percentile":0.8055555555555556},{"level":2,"id":"2_30","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":25,"parent":"1_3","density_rank_percentile":0.8333333333333334},{"level":2,"id":"2_4","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":27,"parent":"1_3","density_rank_percentile":0.6944444444444444},{"level":2,"id":"2_10","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":21,"parent":"1_5","density_rank_percentile":0.5555555555555556},{"level":2,"id":"2_19","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":35,"parent":"1_3","density_rank_percentile":0.9444444444444444},{"level":2,"id":"2_34","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":11,"parent":"1_2","density_rank_percentile":0.5833333333333334},{"level":2,"id":"2_28","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":13,"parent":"1_4","density_rank_percentile":0.0833333333333333},{"level":2,"id":"2_32","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":12,"parent":"1_6","density_rank_percentile":0.2777777777777778},{"level":2,"id":"2_31","label":"地域コミュニティの活性化と住民交流促進イベント","takeaway":"この意見グループは、地域の特性を活かしたイベントやキャンペーンを通じて、住民同士の交流を促進し、地域コミュニティを活性化することの重要性を強調しています。特に、子供向けイベントや地域特性を考慮した情報発信、参加者に特典を提供することで参加を促す方法、地域行事の回数を増やすことなど、具体的な施策が提案されています。これにより、地域住民のつながりを強化し、地域全体の一体感を高めることが期待されています。","value":17,"parent":"1_3","density_rank_percentile":0.4166666666666667},{"level":2,"id":"2_23","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":27,"parent":"1_4","density_rank_percentile":0.7222222222222222},{"level":2,"id":"2_35","label":"エラーでラベル名が取得できませんでした","takeaway":"エラーで解説が取得できませんでした","value":16,"parent":"1_5","density_rank_percentile":0.25},{"level":2,"id":"2_18","label":"音楽とリズムを活用した教育・啓発活動の推進","takeaway":"この意見グループは、教育や啓発活動において音楽やリズムを活用することで、情報の伝達や記憶の定着を促進しようとする提案が中心です。具体的には、校歌のように歌にする、リズムを取り入れる、アーティストとのコラボレーション、ダンスを加えるなど、音楽的要素を取り入れることで、より親しみやすく、覚えやすい形での情報伝達を目指しています。","value":10,"parent":"1_4","density_rank_percentile":0.0555555555555555},{"level":2,"id":"2_7","label":"しながわ防災区民憲章の効果的な普及と認知向上戦略","takeaway":"この意見グループは、しながわ防災区民憲章をより多くの人々に認知してもらうための具体的な普及戦略に焦点を当てています。憲章を親しみやすく短くし、デザイン性を高めることで視覚的に訴求し、広報誌やSNSを活用した情報発信、チラシやイベントでの配布、学校での教育への取り入れなど、多様な手段を通じて憲章の認知度を向上させることが提案されています。これにより、区民にとって憲章が身近で重要な存在となることを目指しています。","value":10,"parent":"1_4","density_rank_percentile":0.0277777777777777},{"level":2,"id":"2_16","label":"地域コミュニティの強化と災害時の共助体制の構築","takeaway":"この意見グループは、災害時における住民同士の助け合いを促進するために、日常的な地域コミュニティの強化が重要であるという考えに基づいています。具体的には、挨拶や地域活動への参加、日常的な交流を通じて住民同士の信頼関係を築くことが、災害時の迅速な共助につながるとされています。また、多文化共生や転入者の増加により希薄になりがちな共同体意識を補完し、災害時の不安を軽減するための施策が求められています。","value":28,"parent":"1_2","density_rank_percentile":0.6111111111111112},{"level":2,"id":"2_26","label":"防災意識の向上と具体的な備えの必要性","takeaway":"この意見グループは、災害に対する意識の向上と具体的な備えの必要性を強調しています。特に、エリアごとの被災リスクを認識し、災害が必ず発生するという前提での意識改革が求められています。また、過去の災害経験を振り返り、次世代への知識継承や、個々人が具体的に何をすべきかを理解することが重要であるとされています。さらに、災害時に頼るべき場所や想定外の事態を減らすための努力が必要であることが指摘されています。","value":12,"parent":"1_2","density_rank_percentile":0.2222222222222222},{"level":2,"id":"2_27","label":"地域防災訓練の重要性と参加促進策","takeaway":"この意見グループは、地域の防災力を高めるために防災訓練の重要性を強調し、参加者を増やすための具体的な方策を提案しています。訓練を通じて地域住民間のコミュニケーションを促進し、協力体制を強化することが目的です。また、訓練の内容充実や参加しやすい環境作り、要援護者への配慮など、多角的なアプローチが求められています。","value":28,"parent":"1_6","density_rank_percentile":0.3333333333333333},{"level":2,"id":"2_6","label":"地域コミュニティを活用した防災意識向上と参加促進","takeaway":"この意見グループは、町会やマンションの理事会、区のイベントなど地域コミュニティを活用して防災意識を高めることの重要性を強調しています。具体的には、防災会議の設置や防災イベントの開催、非常時の備えの確保、子供や親が参加しやすいイベントの企画などを通じて、地域全体で防災意識を向上させることを目指しています。また、有名人の招致や町会活動の活発化、行政との協力を通じて、より多くの人々が参加しやすい環境を整えることが提案されています。","value":18,"parent":"1_5","density_rank_percentile":0.5277777777777778}],"comments":{},"propertyMap":{},"translations":{},"overview":"品川区では、地域特性を活かした防災対策が進められており、地域コミュニティの強化と住民の防災意識向上が重視されています。町会やマンション理事会を通じた活動や、行政との協力によるイベントの開催、SNSを活用した情報共有が行われています。また、備蓄管理や防災教育の推進、多様なメディアを活用した知識普及が進められ、地域全体での迅速な災害対応力の向上が期待されています。これにより、住民同士の信頼関係が深まり、安心して暮らせる環境が整備されています。","config":{"name":"shinagawa-bosai-charter-total","input":"shinagawa-bosai-charter-total","question":"しながわ防災区民憲章の策定に向けて寄せられた意見","intro":"しなトークをはじめ様々な方法で寄せられた意見を可視化。\n分析対象となったデータの件数は622件で、これらのデータに対してOpenAI API (gpt-4o)を用いて748件の意見（議論）を抽出し、クラスタリングを行った。\n","model":"gpt-4o","provider":"openai","is_pubcom":true,"is_embedded_at_local":false,"local_llm_address":null,"extraction":{"prompt":"あなたは防災分野の専門的なリサーチアシスタントです。与えられたテキストから、意見を抽出して整理してください。\n\n# 指示\n* 入出力の例に記載したような形式で文字列のリストを返してください\n* 東京都品川区の地域特性を踏まえてください\n* 必要な場合は2つの別個の意見に分割してください。多くの場合は1つの議論にまとめる方が望ましいです。\n* 整理した意見は日本語で出力してください\n\n## 入出力の例\n/human\n\nAIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\"\n  ]\n}\n\n/human\n\nAIの能力、限界、倫理的考慮事項について、市民を教育する必要がある。また、教育できる人材を養成する必要がある。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIの能力、限界、倫理的考慮事項について、市民を教育すべき\",\n    \"AIに関する教育をできる人材を養成すべき\"\n  ]\n}\n\n/human\n\nAIはエネルギーグリッドを最適化し、無駄や炭素排出を削減できます。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIはエネルギーグリッドを最適化して炭素排出を削減できる\"\n  ]\n}\n","workers":15,"limit":622,"properties":[],"categories":{},"category_batch_size":5,"source_code":"$17","model":"gpt-4o"},"hierarchical_clustering":{"cluster_nums":[6,36],"source_code":"$18"},"hierarchical_initial_labelling":{"prompt":"あなたはKJ法が得意なデータ分析者です。userのinputはグループに集まったラベルです。なぜそのラベルが一つのグループであるか解説し、表札（label）をつけてください。\n表札については、グループ内の具体的な論点や特徴を反映した、具体性の高い名称を考案してください。\n出力はJSONとし、フォーマットは以下のサンプルを参考にしてください。\n\n\n# サンプルの入出力\n## 入力例\n- 手作業での意見分析は時間がかかりすぎる。AIで効率化できると嬉しい\n- 今のやり方だと分析に工数がかかりすぎるけど、AIならコストをかけずに分析できそう\n- AIが自動で意見を整理してくれると楽になって嬉しい\n\n\n## 出力例\n{\n    \"label\": \"AIによる業務効率の大幅向上とコスト効率化\",\n    \"description\": \"この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\"\n}\n","sampling_num":30,"workers":15,"source_code":"$19","model":"gpt-4o"},"hierarchical_merge_labelling":{"prompt":"あなたはデータ分析のエキスパートです。\n現在、テキストデータの階層クラスタリングを行っています。\n下層のクラスタ（意見グループ）のタイトルと説明、およびそれらのクラスタが所属する上層のクラスタのテキストのサンプルを与えるので、上層のクラスタのタイトルと説明を作成してください。\n\n# 指示\n- 統合後のクラスタ名は、統合前のクラスタ名称をそのまま引用せず、内容に基づいた新たな名称にしてください。\n- タイトルには、具体的な事象・行動（例：地域ごとの迅速対応、復興計画の着実な進展、効果的な情報共有・地域協力など）を含めてください\n  - 可能な限り具体的な表現を用いるようにし、抽象的な表現は避けてください\n    - 「多様な意見」などの抽象的な表現は避けてください\n- 出力例に示したJSON形式で出力してください\n\n\n# サンプルの入出力\n## 入力例\n- 「顧客フィードバックの自動集約」: この意見グループは、SNSやオンラインレビューなどから集めた大量の意見をAIが瞬時に解析し、企業が市場のトレンドや顧客の要望を即時に把握できる点についての期待を示しています。\n- 「AIによる業務効率の大幅向上とコスト効率化」: この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\n\n## 出力例\n{\n    \"label\": \"AI技術の導入による意見分析の効率化への期待\",\n    \"description\": \"大量の意見やフィードバックから迅速に洞察を抽出できるため、企業や自治体が消費者や市民の声を的確に把握し、戦略的な意思決定やサービス改善が可能になります。また、従来の手法と比べて作業負荷が軽減され、業務効率の向上やコスト削減といった実際の便益が得られると期待されています。\"\n}\n","sampling_num":30,"workers":15,"source_code":"$1a","model":"gpt-4o"},"hierarchical_overview":{"prompt":"/system \n\nあなたはシンクタンクで働く専門のリサーチアシスタントです。\nチームは特定のテーマに関してパブリック・コンサルテーションを実施し、異なる選択肢の意見グループを分析し始めています。\nこれから意見グループのリストとその簡単な分析が提供されます。\nあなたの仕事は、調査結果の簡潔な要約を返すことです。要約は非常に簡潔に（最大で1段落、最大4文）まとめ、無意味な言葉を避けてください。東京都品川区の地域特性を踏まえてください。\n出力は日本語で行ってください。\n","source_code":"$1b","model":"gpt-4o"},"hierarchical_aggregation":{"sampling_num":15,"hidden_properties":{},"source_code":"$1c"},"enable_source_link":false,"output_dir":"shinagawa-bosai-charter-total","skip-interaction":true,"without-html":true,"previous":{"name":"shinagawa-bosai-charter-total","input":"shinagawa-bosai-charter-total","question":"しながわ防災区民憲章の策定に向けて寄せられた意見","intro":"しなトークをはじめ様々な手段で寄せられた意見を可視化したもの。","model":"gpt-4o","provider":"openai","is_pubcom":true,"is_embedded_at_local":false,"local_llm_address":null,"extraction":{"prompt":"あなたは防災に関する専門的なリサーチアシスタントです。与えられたテキストから、意見を抽出して整理してください。\n\n# 指示\n* 入出力の例に記載したような形式で文字列のリストを返してください\n* 東京都品川区の地域特性を踏まえて分析してください\n* 必要な場合は2つの別個の意見に分割してください。多くの場合は1つの議論にまとめる方が望ましいです。\n* 整理した意見は日本語で出力してください\n\n## 入出力の例\n/human\n\nAIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\"\n  ]\n}\n\n/human\n\nAIの能力、限界、倫理的考慮事項について、市民を教育する必要がある。また、教育できる人材を養成する必要がある。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIの能力、限界、倫理的考慮事項について、市民を教育すべき\",\n    \"AIに関する教育をできる人材を養成すべき\"\n  ]\n}\n\n/human\n\nAIはエネルギーグリッドを最適化し、無駄や炭素排出を削減できます。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIはエネルギーグリッドを最適化して炭素排出を削減できる\"\n  ]\n}\n","workers":10,"limit":622,"properties":[],"categories":{},"category_batch_size":5,"source_code":"$1d","model":"gpt-4o"},"hierarchical_clustering":{"cluster_nums":[9,81],"source_code":"$1e"},"hierarchical_initial_labelling":{"prompt":"あなたはKJ法が得意なデータ分析者です。userのinputはグループに集まったラベルです。なぜそのラベルが一つのグループであるか解説し、表札（label）をつけてください。\n表札については、グループ内の具体的な論点や特徴を反映した、具体性の高い名称を考案してください。\n出力はJSONとし、フォーマットは以下のサンプルを参考にしてください。\n\n\n# サンプルの入出力\n## 入力例\n- 手作業での意見分析は時間がかかりすぎる。AIで効率化できると嬉しい\n- 今のやり方だと分析に工数がかかりすぎるけど、AIならコストをかけずに分析できそう\n- AIが自動で意見を整理してくれると楽になって嬉しい\n\n\n## 出力例\n{\n    \"label\": \"AIによる業務効率の大幅向上とコスト効率化\",\n    \"description\": \"この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\"\n}\n","sampling_num":30,"workers":10,"source_code":"$1f","model":"gpt-4o"},"hierarchical_merge_labelling":{"prompt":"あなたはデータ分析のエキスパートです。\n現在、テキストデータの階層クラスタリングを行っています。\n下層のクラスタ（意見グループ）のタイトルと説明、およびそれらのクラスタが所属する上層のクラスタのテキストのサンプルを与えるので、上層のクラスタのタイトルと説明を作成してください。\n\n# 指示\n- 統合後のクラスタ名は、統合前のクラスタ名称をそのまま引用せず、内容に基づいた新たな名称にしてください。\n- タイトルには、具体的な事象・行動（例：地域ごとの迅速対応、復興計画の着実な進展、効果的な情報共有・地域協力など）を含めてください\n  - 可能な限り具体的な表現を用いるようにし、抽象的な表現は避けてください\n    - 「多様な意見」などの抽象的な表現は避けてください\n- 出力例に示したJSON形式で出力してください\n\n\n# サンプルの入出力\n## 入力例\n- 「顧客フィードバックの自動集約」: この意見グループは、SNSやオンラインレビューなどから集めた大量の意見をAIが瞬時に解析し、企業が市場のトレンドや顧客の要望を即時に把握できる点についての期待を示しています。\n- 「AIによる業務効率の大幅向上とコスト効率化」: この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\n\n## 出力例\n{\n    \"label\": \"AI技術の導入による意見分析の効率化への期待\",\n    \"description\": \"大量の意見やフィードバックから迅速に洞察を抽出できるため、企業や自治体が消費者や市民の声を的確に把握し、戦略的な意思決定やサービス改善が可能になります。また、従来の手法と比べて作業負荷が軽減され、業務効率の向上やコスト削減といった実際の便益が得られると期待されています。\"\n}\n","sampling_num":30,"workers":10,"source_code":"$20","model":"gpt-4o"},"hierarchical_overview":{"prompt":"/system \n\nあなたはシンクタンクで働く専門のリサーチアシスタントです。\nチームは特定のテーマに関してパブリック・コンサルテーションを実施し、異なる選択肢の意見グループを分析し始めています。\nこれから意見グループのリストとその簡単な分析が提供されます。\nあなたの仕事は、調査結果の簡潔な要約を返すことです。要約は非常に簡潔に（最大で1段落、最大4文）まとめ、無意味な言葉を避けてください。\n出力は日本語で行ってください。\n","source_code":"$21","model":"gpt-4o"},"hierarchical_aggregation":{"sampling_num":10,"hidden_properties":{},"source_code":"$22"},"enable_source_link":false,"output_dir":"shinagawa-bosai-charter-total","skip-interaction":true,"without-html":true,"embedding":{"model":"text-embedding-3-small","source_code":"$23"},"hierarchical_visualization":{"replacements":[],"source_code":"import subprocess\n\n\ndef hierarchical_visualization(config):\n    output_dir = config[\"output_dir\"]\n    cwd = \"../report\"\n    command = f\"REPORT={output_dir} npm run build\"\n\n    try:\n        process = subprocess.Popen(\n            command,\n            shell=True,\n            cwd=cwd,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            universal_newlines=True,\n        )\n        while True:\n            output_line = process.stdout.readline()\n            if output_line == \"\" and process.poll() is not None:\n                break\n            if output_line:\n                print(output_line.strip())\n        process.wait()\n        errors = process.stderr.read()\n        if errors:\n            print(\"Errors:\")\n            print(errors)\n    except subprocess.CalledProcessError as e:\n        print(\"Error: \", e)\n"},"plan":[{"step":"extraction","run":true,"reason":"not trace of previous run"},{"step":"embedding","run":true,"reason":"not trace of previous run"},{"step":"hierarchical_clustering","run":true,"reason":"not trace of previous run"},{"step":"hierarchical_initial_labelling","run":true,"reason":"not trace of previous run"},{"step":"hierarchical_merge_labelling","run":true,"reason":"not trace of previous run"},{"step":"hierarchical_overview","run":true,"reason":"not trace of previous run"},{"step":"hierarchical_aggregation","run":true,"reason":"not trace of previous run"},{"step":"hierarchical_visualization","run":false,"reason":"skipping html output"}],"status":"completed","start_time":"2025-12-25T14:51:30.929689","completed_jobs":[{"step":"extraction","completed":"2025-12-25T15:02:39.488894","duration":668.555924,"params":{"prompt":"あなたは防災に関する専門的なリサーチアシスタントです。与えられたテキストから、意見を抽出して整理してください。\n\n# 指示\n* 入出力の例に記載したような形式で文字列のリストを返してください\n* 東京都品川区の地域特性を踏まえて分析してください\n* 必要な場合は2つの別個の意見に分割してください。多くの場合は1つの議論にまとめる方が望ましいです。\n* 整理した意見は日本語で出力してください\n\n## 入出力の例\n/human\n\nAIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\"\n  ]\n}\n\n/human\n\nAIの能力、限界、倫理的考慮事項について、市民を教育する必要がある。また、教育できる人材を養成する必要がある。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIの能力、限界、倫理的考慮事項について、市民を教育すべき\",\n    \"AIに関する教育をできる人材を養成すべき\"\n  ]\n}\n\n/human\n\nAIはエネルギーグリッドを最適化し、無駄や炭素排出を削減できます。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIはエネルギーグリッドを最適化して炭素排出を削減できる\"\n  ]\n}\n","workers":10,"limit":622,"properties":[],"categories":{},"category_batch_size":5,"source_code":"$24","model":"gpt-4o"},"token_usage":363828},{"step":"embedding","completed":"2025-12-25T15:02:43.779247","duration":4.287799,"params":{"model":"text-embedding-3-small","source_code":"$25"},"token_usage":0},{"step":"hierarchical_clustering","completed":"2025-12-25T15:02:52.552131","duration":8.769463,"params":{"cluster_nums":[9,81],"source_code":"$26"},"token_usage":0},{"step":"hierarchical_initial_labelling","completed":"2025-12-25T15:04:32.512895","duration":99.958545,"params":{"prompt":"あなたはKJ法が得意なデータ分析者です。userのinputはグループに集まったラベルです。なぜそのラベルが一つのグループであるか解説し、表札（label）をつけてください。\n表札については、グループ内の具体的な論点や特徴を反映した、具体性の高い名称を考案してください。\n出力はJSONとし、フォーマットは以下のサンプルを参考にしてください。\n\n\n# サンプルの入出力\n## 入力例\n- 手作業での意見分析は時間がかかりすぎる。AIで効率化できると嬉しい\n- 今のやり方だと分析に工数がかかりすぎるけど、AIならコストをかけずに分析できそう\n- AIが自動で意見を整理してくれると楽になって嬉しい\n\n\n## 出力例\n{\n    \"label\": \"AIによる業務効率の大幅向上とコスト効率化\",\n    \"description\": \"この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\"\n}\n","sampling_num":30,"workers":10,"source_code":"$27","model":"gpt-4o"},"token_usage":56395},{"step":"hierarchical_merge_labelling","completed":"2025-12-25T15:05:13.724444","duration":41.209253,"params":{"prompt":"あなたはデータ分析のエキスパートです。\n現在、テキストデータの階層クラスタリングを行っています。\n下層のクラスタ（意見グループ）のタイトルと説明、およびそれらのクラスタが所属する上層のクラスタのテキストのサンプルを与えるので、上層のクラスタのタイトルと説明を作成してください。\n\n# 指示\n- 統合後のクラスタ名は、統合前のクラスタ名称をそのまま引用せず、内容に基づいた新たな名称にしてください。\n- タイトルには、具体的な事象・行動（例：地域ごとの迅速対応、復興計画の着実な進展、効果的な情報共有・地域協力など）を含めてください\n  - 可能な限り具体的な表現を用いるようにし、抽象的な表現は避けてください\n    - 「多様な意見」などの抽象的な表現は避けてください\n- 出力例に示したJSON形式で出力してください\n\n\n# サンプルの入出力\n## 入力例\n- 「顧客フィードバックの自動集約」: この意見グループは、SNSやオンラインレビューなどから集めた大量の意見をAIが瞬時に解析し、企業が市場のトレンドや顧客の要望を即時に把握できる点についての期待を示しています。\n- 「AIによる業務効率の大幅向上とコスト効率化」: この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\n\n## 出力例\n{\n    \"label\": \"AI技術の導入による意見分析の効率化への期待\",\n    \"description\": \"大量の意見やフィードバックから迅速に洞察を抽出できるため、企業や自治体が消費者や市民の声を的確に把握し、戦略的な意思決定やサービス改善が可能になります。また、従来の手法と比べて作業負荷が軽減され、業務効率の向上やコスト削減といった実際の便益が得られると期待されています。\"\n}\n","sampling_num":30,"workers":10,"source_code":"$28","model":"gpt-4o"},"token_usage":22774},{"step":"hierarchical_overview","completed":"2025-12-25T15:05:23.321345","duration":9.594629,"params":{"prompt":"/system \n\nあなたはシンクタンクで働く専門のリサーチアシスタントです。\nチームは特定のテーマに関してパブリック・コンサルテーションを実施し、異なる選択肢の意見グループを分析し始めています。\nこれから意見グループのリストとその簡単な分析が提供されます。\nあなたの仕事は、調査結果の簡潔な要約を返すことです。要約は非常に簡潔に（最大で1段落、最大4文）まとめ、無意味な言葉を避けてください。\n出力は日本語で行ってください。\n","source_code":"$29","model":"gpt-4o"},"token_usage":2045},{"step":"hierarchical_aggregation","completed":"2025-12-25T15:05:23.554247","duration":0.229966,"params":{"sampling_num":10,"hidden_properties":{},"source_code":"$2a"},"token_usage":0}],"total_token_usage":445042,"token_usage_input":409355,"token_usage_output":35687,"lock_until":"2025-12-25T15:10:23.557471","current_job":"hierarchical_aggregation","current_job_started":"2025-12-25T15:05:23.324287","estimated_cost":1.3802575000000001,"end_time":"2025-12-25T15:05:23.557466"},"embedding":{"model":"text-embedding-3-small","source_code":"$2b"},"hierarchical_visualization":{"replacements":[],"source_code":"import subprocess\n\n\ndef hierarchical_visualization(config):\n    output_dir = config[\"output_dir\"]\n    cwd = \"../report\"\n    command = f\"REPORT={output_dir} npm run build\"\n\n    try:\n        process = subprocess.Popen(\n            command,\n            shell=True,\n            cwd=cwd,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            universal_newlines=True,\n        )\n        while True:\n            output_line = process.stdout.readline()\n            if output_line == \"\" and process.poll() is not None:\n                break\n            if output_line:\n                print(output_line.strip())\n        process.wait()\n        errors = process.stderr.read()\n        if errors:\n            print(\"Errors:\")\n            print(errors)\n    except subprocess.CalledProcessError as e:\n        print(\"Error: \", e)\n"},"plan":[{"step":"extraction","run":true,"reason":"some parameters changed: prompt"},{"step":"embedding","run":true,"reason":"some dependent steps will re-run: extraction"},{"step":"hierarchical_clustering","run":true,"reason":"some dependent steps will re-run: embedding"},{"step":"hierarchical_initial_labelling","run":true,"reason":"some dependent steps will re-run: hierarchical_clustering"},{"step":"hierarchical_merge_labelling","run":true,"reason":"some dependent steps will re-run: hierarchical_initial_labelling"},{"step":"hierarchical_overview","run":true,"reason":"some dependent steps will re-run: hierarchical_merge_labelling"},{"step":"hierarchical_aggregation","run":true,"reason":"some dependent steps will re-run: extraction, hierarchical_clustering, hierarchical_initial_labelling, hierarchical_merge_labelling, hierarchical_overview"},{"step":"hierarchical_visualization","run":false,"reason":"skipping html output"}],"status":"running","start_time":"2025-12-25T15:08:24.014673","completed_jobs":[{"step":"extraction","completed":"2025-12-25T15:18:55.196832","duration":631.179889,"params":{"prompt":"あなたは防災分野の専門的なリサーチアシスタントです。与えられたテキストから、意見を抽出して整理してください。\n\n# 指示\n* 入出力の例に記載したような形式で文字列のリストを返してください\n* 東京都品川区の地域特性を踏まえてください\n* 必要な場合は2つの別個の意見に分割してください。多くの場合は1つの議論にまとめる方が望ましいです。\n* 整理した意見は日本語で出力してください\n\n## 入出力の例\n/human\n\nAIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\"\n  ]\n}\n\n/human\n\nAIの能力、限界、倫理的考慮事項について、市民を教育する必要がある。また、教育できる人材を養成する必要がある。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIの能力、限界、倫理的考慮事項について、市民を教育すべき\",\n    \"AIに関する教育をできる人材を養成すべき\"\n  ]\n}\n\n/human\n\nAIはエネルギーグリッドを最適化し、無駄や炭素排出を削減できます。\n\n/ai\n\n{\n  \"extractedOpinionList\": [\n    \"AIはエネルギーグリッドを最適化して炭素排出を削減できる\"\n  ]\n}\n","workers":15,"limit":622,"properties":[],"categories":{},"category_batch_size":5,"source_code":"$2c","model":"gpt-4o"},"token_usage":344590},{"step":"embedding","completed":"2025-12-25T15:18:58.547813","duration":3.347121,"params":{"model":"text-embedding-3-small","source_code":"$2d"},"token_usage":0},{"step":"hierarchical_clustering","completed":"2025-12-25T15:19:06.390885","duration":7.838109,"params":{"cluster_nums":[6,36],"source_code":"$2e"},"token_usage":0},{"step":"hierarchical_initial_labelling","completed":"2025-12-25T15:19:50.164929","duration":43.767597,"params":{"prompt":"あなたはKJ法が得意なデータ分析者です。userのinputはグループに集まったラベルです。なぜそのラベルが一つのグループであるか解説し、表札（label）をつけてください。\n表札については、グループ内の具体的な論点や特徴を反映した、具体性の高い名称を考案してください。\n出力はJSONとし、フォーマットは以下のサンプルを参考にしてください。\n\n\n# サンプルの入出力\n## 入力例\n- 手作業での意見分析は時間がかかりすぎる。AIで効率化できると嬉しい\n- 今のやり方だと分析に工数がかかりすぎるけど、AIならコストをかけずに分析できそう\n- AIが自動で意見を整理してくれると楽になって嬉しい\n\n\n## 出力例\n{\n    \"label\": \"AIによる業務効率の大幅向上とコスト効率化\",\n    \"description\": \"この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\"\n}\n","sampling_num":30,"workers":15,"source_code":"$2f","model":"gpt-4o"},"token_usage":27053},{"step":"hierarchical_merge_labelling","completed":"2025-12-25T15:20:15.321222","duration":25.151022,"params":{"prompt":"あなたはデータ分析のエキスパートです。\n現在、テキストデータの階層クラスタリングを行っています。\n下層のクラスタ（意見グループ）のタイトルと説明、およびそれらのクラスタが所属する上層のクラスタのテキストのサンプルを与えるので、上層のクラスタのタイトルと説明を作成してください。\n\n# 指示\n- 統合後のクラスタ名は、統合前のクラスタ名称をそのまま引用せず、内容に基づいた新たな名称にしてください。\n- タイトルには、具体的な事象・行動（例：地域ごとの迅速対応、復興計画の着実な進展、効果的な情報共有・地域協力など）を含めてください\n  - 可能な限り具体的な表現を用いるようにし、抽象的な表現は避けてください\n    - 「多様な意見」などの抽象的な表現は避けてください\n- 出力例に示したJSON形式で出力してください\n\n\n# サンプルの入出力\n## 入力例\n- 「顧客フィードバックの自動集約」: この意見グループは、SNSやオンラインレビューなどから集めた大量の意見をAIが瞬時に解析し、企業が市場のトレンドや顧客の要望を即時に把握できる点についての期待を示しています。\n- 「AIによる業務効率の大幅向上とコスト効率化」: この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\n\n## 出力例\n{\n    \"label\": \"AI技術の導入による意見分析の効率化への期待\",\n    \"description\": \"大量の意見やフィードバックから迅速に洞察を抽出できるため、企業や自治体が消費者や市民の声を的確に把握し、戦略的な意思決定やサービス改善が可能になります。また、従来の手法と比べて作業負荷が軽減され、業務効率の向上やコスト削減といった実際の便益が得られると期待されています。\"\n}\n","sampling_num":30,"workers":15,"source_code":"$30","model":"gpt-4o"},"token_usage":14307},{"step":"hierarchical_overview","completed":"2025-12-25T15:20:22.476501","duration":7.151806,"params":{"prompt":"/system \n\nあなたはシンクタンクで働く専門のリサーチアシスタントです。\nチームは特定のテーマに関してパブリック・コンサルテーションを実施し、異なる選択肢の意見グループを分析し始めています。\nこれから意見グループのリストとその簡単な分析が提供されます。\nあなたの仕事は、調査結果の簡潔な要約を返すことです。要約は非常に簡潔に（最大で1段落、最大4文）まとめ、無意味な言葉を避けてください。東京都品川区の地域特性を踏まえてください。\n出力は日本語で行ってください。\n","source_code":"$31","model":"gpt-4o"},"token_usage":1605}],"total_token_usage":387555,"token_usage_input":360564,"token_usage_output":26991,"lock_until":"2025-12-25T15:25:22.482874","current_job":"hierarchical_aggregation","current_job_started":"2025-12-25T15:20:22.482867","estimated_cost":1.1713200000000001,"current_job_progress":null,"current_jop_tasks":null},"comment_num":622,"visibility":"public"}}],["$","$L32",null,{"result":"$8:1:props:children:1:props:result"}],["$","$L12",null,{"w":"fit-content","mx":"auto","children":["$","$L6",null,{"href":"/","children":["$","$L7",null,{"variant":"outline","size":"md","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-chevron-left","children":[["$","path","1wnfg3",{"d":"m15 18-6-6 6-6"}],"$undefined"]}],"一覧へ戻る"]}]}]}],["$","$L33",null,{"my":12,"maxW":"750px","mx":"auto"}],["$","$L12",null,{"maxW":"750px","mx":"auto","mb":24,"children":"$L34"}]]}],["$","$L35",null,{"meta":{"reporter":"一般社団法人コード・フォー・ジャパン","message":"ともに考え、ともにつくる社会をビジョンに、Decidimの日本での活用などデジタル民主主義を推進しています。","webLink":"https://www.code4japan.org/","privacyLink":"https://www.code4japan.org/privacy-policy","termsLink":null,"brandColor":"#2577B1","isDefault":false}}]]
b:null
f:[["$","title","0",{"children":"しながわ防災区民憲章の策定に向けて寄せられた意見 - 一般社団法人コード・フォー・ジャパン"}],["$","meta","1",{"name":"description","content":"品川区では、地域特性を活かした防災対策が進められており、地域コミュニティの強化と住民の防災意識向上が重視されています。町会やマンション理事会を通じた活動や、行政との協力によるイベントの開催、SNSを活用した情報共有が行われています。また、備蓄管理や防災教育の推進、多様なメディアを活用した知識普及が進められ、地域全体での迅速な災害対応力の向上が期待されています。これにより、住民同士の信頼関係が深まり、安心して暮らせる環境が整備されています。"}],["$","meta","2",{"property":"og:title","content":"しながわ防災区民憲章の策定に向けて寄せられた意見 - 一般社団法人コード・フォー・ジャパン"}],["$","meta","3",{"property":"og:description","content":"品川区では、地域特性を活かした防災対策が進められており、地域コミュニティの強化と住民の防災意識向上が重視されています。町会やマンション理事会を通じた活動や、行政との協力によるイベントの開催、SNSを活用した情報共有が行われています。また、備蓄管理や防災教育の推進、多様なメディアを活用した知識普及が進められ、地域全体での迅速な災害対応力の向上が期待されています。これにより、住民同士の信頼関係が深まり、安心して暮らせる環境が整備されています。"}],["$","meta","4",{"property":"og:image","content":"http://localhost:3000/shinagawa-bosai-charter-total/opengraph-image.png"}],["$","meta","5",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","6",{"name":"twitter:title","content":"しながわ防災区民憲章の策定に向けて寄せられた意見 - 一般社団法人コード・フォー・ジャパン"}],["$","meta","7",{"name":"twitter:description","content":"品川区では、地域特性を活かした防災対策が進められており、地域コミュニティの強化と住民の防災意識向上が重視されています。町会やマンション理事会を通じた活動や、行政との協力によるイベントの開催、SNSを活用した情報共有が行われています。また、備蓄管理や防災教育の推進、多様なメディアを活用した知識普及が進められ、地域全体での迅速な災害対応力の向上が期待されています。これにより、住民同士の信頼関係が深まり、安心して暮らせる環境が整備されています。"}],["$","meta","8",{"name":"twitter:image","content":"http://localhost:3000/shinagawa-bosai-charter-total/opengraph-image.png"}]]
36:I[81499,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"ReporterContent"]
34:["$","$L36",null,{"meta":"$8:2:props:meta","children":"$L37"}]
38:I[89248,["150","static/chunks/59650de3-481cc0c44db376d7.js","315","static/chunks/315-19ca0205aa2fdd55.js","567","static/chunks/567-13e48369edb584ec.js","458","static/chunks/458-4db2abcd82f4c9c6.js","874","static/chunks/874-e31c245f344a6bb3.js","261","static/chunks/261-dd24fe22c839e0ae.js","124","static/chunks/124-8b6d8ff5759d10e8.js","116","static/chunks/116-746bc821fa46af6a.js","49","static/chunks/49-b1e59d6cd5c08cd8.js","347","static/chunks/347-1fc22e09a7c5e141.js","182","static/chunks/app/%5Bslug%5D/page-a97111f7f2c073a4.js"],"Image"]
37:["$","$L38",null,{"src":"/meta/reporter.png","alt":"一般社団法人コード・フォー・ジャパン","maxW":"150px"}]
